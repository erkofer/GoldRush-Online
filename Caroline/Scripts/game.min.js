var Utils;
(function(a){a.addEvent=function(a,g,e){null!=a&&"undefined"!=typeof a&&(a.addEventListener?a.addEventListener(g,e,!1):a.attachEvent?a.attachEvent("on"+g,e):a["on"+g]=e)};a.cssSwap=function(a,g,e){a.classList.contains(g)&&a.classList.remove(g);a.classList.add(e)};a.cssifyName=function(a){return a.split(" ").join("_")};a.ifNotDefault=function(a,g){-100!=a&&g()};a.createButton=function(a,g){var e,l;e=document.createElement("div");l=document.createElement("div");l.textContent=a;g&&(l.id=g);e.classList.add("button");
e.appendChild(l);return e};a.isNumber=function(a){return!isNaN(parseFloat(a))};a.formatNumber=function(a){return a?999999999999999<a?(a/1E15).toFixed(3)+"Qa":999999999999<a?(a/1E12).toFixed(3)+"T":999999999<a?(a/1E9).toFixed(3)+"B":999999<a?(a/1E6).toFixed(3)+"M":a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","):"0"};a.convertServerTimeToLocal=function(a){var g=+a.split(":")[0],e=+a.split(":")[1].split(" ")[0];"PM"==a.split(":")[1].split(" ")[1]&&(g+=12);a=(new Date).getTimezoneOffset();g-=a/60-a%
60;e-=a%60;0>g&&(g=24-g);0>e&&(e=60-e,g--);23<g&&(g-=24);59<e&&(e-=60,g++);return(10>g?"0":"")+g+":"+(10>e?"0":"")+e}})(Utils||(Utils={}));var modal;
(function(a){function m(){a.activeWindow&&a.activeWindow.hide();a.activeWindow=null}function g(){if(a.activeWindow){var d=a.activeWindow.container.getBoundingClientRect();a.activeWindow.container.style.left=window.innerWidth/2-(d.right-d.left)/2+"px";a.activeWindow.container.style.top=window.innerHeight/2-(d.bottom-d.top)/2+"px"}else clearInterval(a.intervalIdentifier)}var e=0,l;a.activeWindow;a.intervalIdentifier;a.hide=m;a.close=function(){if(a.activeWindow){var d=a.activeWindow;m();d.container.parentNode.removeChild(d.container)}};
var h=function(){function d(){this.container=document.createElement("div");this.container.addEventListener("click",function(b){b.stopPropagation()},!1);this.container.classList.add("modal-window");if(!l){var d=document.createElement("div");l=d;d.classList.add("modal-wrapper");d.addEventListener("click",function(b){b.stopPropagation();3E3<Date.now()-e&&a.close()},!1);document.body.appendChild(d)}l.appendChild(this.container);this.titleEl=document.createElement("div");this.titleEl.classList.add("modal-header");
this.bodyEl=document.createElement("div");this.container.appendChild(this.titleEl);this.container.appendChild(this.bodyEl)}Object.defineProperty(d.prototype,"title",{get:function(){return this._title},set:function(d){this._title=d;this.titleEl.textContent=this._title},enumerable:!0,configurable:!0});d.prototype.addElement=function(d){this.bodyEl.appendChild(d)};d.prototype.addOption=function(d){this.options||(this.options=document.createElement("div"),this.options.classList.add("modal-options"),this.container.appendChild(this.options));
var b=document.createElement("span");b.classList.add("modal-option");var a=document.createElement("span");a.textContent=d;b.appendChild(a);this.options.appendChild(b);return b};d.prototype.addAffirmativeOption=function(d){d=this.addOption(d);d.classList.add("affirmative");return d};d.prototype.addNegativeOption=function(d){d=this.addOption(d);d.classList.add("negative");return d};d.prototype.show=function(){this.container.classList.contains("opened")||this.container.classList.add("opened");l.classList.contains("opened")||
l.classList.add("opened");a.activeWindow=this;g();a.intervalIdentifier=setInterval(g,100);e=Date.now()};d.prototype.hide=function(){this.container.classList.contains("opened")&&this.container.classList.remove("opened");l.classList.contains("opened")&&l.classList.remove("opened")};return d}();a.Window=h})(modal||(modal={}));var Objects;
(function(a){var m=[],g=function(){return function(){this.quantity=0}}();a.register=function(a,l){if(!m[a]){var h=new g;h.name=l;m[a]=h}};a.lookupName=function(a){return m[a].name};a.setQuantity=function(a,g){m[a].quantity=g};a.getQuantity=function(a){return m[a].quantity};a.setLifeTimeTotal=function(a,g){m[a].lifeTimeTotal=g};a.getLifeTimeTotal=function(a){return m[a].lifeTimeTotal}})(Objects||(Objects={}));var Account;
(function(a){function m(){b.classList.contains("closed")||b.classList.add("closed")}function g(){var b=new modal.Window,d=document.createElement("DIV");d.style.width="400px";var a=document.createElement("DIV");a.style.marginBottom="5px";var f=document.createElement("INPUT");f.type="TEXT";f.maxLength=16;f.placeholder="Username";a.appendChild(f);var c=document.createElement("DIV");c.style.marginBottom="5px";var n=document.createElement("INPUT");n.type="PASSWORD";n.pattern=".{6,}";n.placeholder="Password";
c.appendChild(n);var k=document.createElement("DIV");k.style.marginBottom="5px";var p=document.createElement("INPUT");p.type="CHECKBOX";p.placeholder="Stay logged in on this computer?";k.appendChild(p);d.appendChild(a);d.appendChild(c);d.appendChild(k);b.title="Log in";b.addElement(d);b.addNegativeOption("Cancel").addEventListener("click",function(){modal.close()},!1);b.addAffirmativeOption("Submit").addEventListener("click",function(){h(f.value,n.value,p.checked);modal.close()},!1);b.show()}function e(){var b=
new modal.Window,d=document.createElement("DIV");d.style.width="400px";var a=document.createElement("DIV");a.style.marginBottom="5px";var f=document.createElement("INPUT");f.type="TEXT";f.maxLength=16;f.placeholder="Username";a.appendChild(f);var c=document.createElement("DIV");c.style.marginBottom="5px";var n=document.createElement("INPUT");n.type="EMAIL";n.placeholder="Email";c.appendChild(n);var k=document.createElement("DIV");k.style.marginBottom="5px";var p=document.createElement("INPUT");p.type=
"PASSWORD";p.pattern=".{6,}";p.placeholder="Password";k.appendChild(p);var x=document.createElement("DIV");x.style.marginBottom="5px";var v=document.createElement("INPUT");v.type="PASSWORD";v.pattern=".{6,}";v.placeholder="Confirm password";x.appendChild(v);v.onblur=function(){p.value!=v.value&&v.setCustomValidity("Passwords are not the same.")};v.onfocus=function(){v.setCustomValidity("")};d.appendChild(a);d.appendChild(c);d.appendChild(k);d.appendChild(x);b.addElement(d);b.title="Register";b.addNegativeOption("Cancel").addEventListener("click",
function(){modal.close()},!1);b.addAffirmativeOption("Submit").addEventListener("click",function(){l(n.value,f.value,p.value,v.value);modal.close()},!1);b.show()}function l(b,d,a,f){$.ajax({type:"POST",url:"/Api/Account/Register",data:$.param({Email:b,UserName:d,Password:a,ConfirmPassword:f}),headers:{"Content-Type":"application/x-www-form-urlencoded"},success:function(b){console.log(b.responseText);Connection.restart();c()}})}function h(b,d,a){$.ajax({type:"POST",url:"/Api/Account/Login",data:$.param({UserName:b,
Password:d,RememberMe:a}),headers:{"Content-Type":"application/x-www-form-urlencoded"},success:function(b){console.log(b);Connection.restart();c()}})}function d(){$.ajax({type:"POST",url:"/Api/Account/LogOff",headers:{"Content-Type":"application/x-www-form-urlencoded"},success:function(b){console.log(b);Connection.restart();c();location.reload()}})}function c(){$.ajax({type:"POST",url:"/Api/Account/Info",headers:{"Content-Type":"application/x-www-form-urlencoded"},success:function(d){console.log(d);
d=JSON.parse(d);var a=d.Anonymous;k.textContent=a?"Guest":d.UserName;Utils.cssSwap(b,a?"registered":"anonymous",a?"anonymous":"registered")}})}var b,f,k,q;(function(){b=document.createElement("DIV");b.classList.add("account-manager");b.classList.add("closed");b.onmouseenter=function(){clearTimeout(q)};b.onmouseleave=function(){q=setTimeout(m,250)};var a=document.createElement("DIV");a.textContent="Sign in";a.classList.add("account-option");a.classList.add("anonymous-account-option");a.addEventListener("click",
function(){g()});b.appendChild(a);a=document.createElement("DIV");a.textContent="Register";a.classList.add("account-option");a.classList.add("anonymous-account-option");a.addEventListener("click",function(){e()});b.appendChild(a);a=document.createElement("DIV");a.textContent="Options";a.classList.add("account-option");a.classList.add("registered-account-option");b.appendChild(a);a=document.createElement("DIV");a.textContent="Sign out";a.classList.add("account-option");a.classList.add("registered-account-option");
a.addEventListener("click",function(){d()});b.appendChild(a);f=document.createElement("DIV");f.classList.add("account-user");k=document.createElement("SPAN");f.appendChild(k);b.appendChild(f);document.body.appendChild(b);f.addEventListener("click",function(){b.classList.contains("closed")?b.classList.remove("closed"):b.classList.add("closed")});c()})();a.info=c})(Account||(Account={}));var Rock;
(function(a){function m(b,a){var d=b.getBoundingClientRect();return{x:a.clientX-d.left,y:a.clientY-d.top}}function g(b,a){b>k&&b<k+64&&a>q&&a<q+64?(u?l(k+2,q+2,60,60):l(k-2,q-2,68,68),r=!0):r&&(l(k,q,64,64),r=!1)}function e(b,a){b!=k&&a!=q&&(k=b,q=a,f?l(b,a,64,64):setTimeout(function(){e(b,a)},10))}function l(a,f,k,n){d.clearRect(0,0,250,250);d.drawImage(c,0,0);d.drawImage(b,a,f,k,n)}var h=document.getElementById("rock"),d=h.getContext("2d"),c=new Image,b=new Image(16,16),f=!1,k=0,q=0,r=!1,u=!1;a.moveRock=
e;(function(){c.onload=function(){d.drawImage(c,0,0);console.log("rock loaded")};c.src="/Content/Rock.png";b.onload=function(){f=!0};b.src="/Content/Stone.png";h.addEventListener("mousemove",function(b){b=m(h,b);g(b.x,b.y)},!1);h.addEventListener("mousedown",function(b){b=m(h,b);u=!0;g(b.x,b.y);Connection.mine(b.x,b.y)},!1);h.addEventListener("mouseup",function(b){b=m(h,b);u=!1;g(b.x,b.y)},!1);h.addEventListener("mouseleave",function(b){b=m(h,b);u=!1;g(b.x,b.y)},!1)})()})(Rock||(Rock={}));var Tabs;
(function(a){function m(){if(h){var b=h.scrollHeight;b>window.innerHeight-a.bottomPadding&&(b=window.innerHeight-a.bottomPadding);e.style.minHeight=b+"px";e.style.maxHeight=b+"px";e.style.overflowY=b>=window.innerHeight-a.bottomPadding?"scroll":"hidden"}}var g=0,e=document.getElementById("paneContainer");a.bottomPadding=200;var l=[],h,d=new (function(){function b(b){this.container=b;this.tabs=[];this.lowestId=0;this.id=g++;l.push(this)}b.prototype.newTab=function(b){var d=new c;d.pane=b;b=document.createElement("DIV");
b.classList.add("tab-button");this.container.appendChild(b);d.button=b;0==this.lowestId?d.activate():d.deactivate();var e=this.lowestId++,g=this.id;b.addEventListener("click",function(){a.activateTab(g,e)});this.tabs.push(d);this.container.appendChild(b);return this.lowestId-1};b.prototype.activate=function(b){for(var a=0;a<this.tabs.length;a++)this.tabs[a].deactivate();this.tabs[b].activate()};b.prototype.css=function(b,a){this.tabs[b].button.classList.add(a)};return b}())(document.getElementById("tabContainer"));
a.registerGameTab=function(b,a){var c=d.newTab(b);a&&d.css(c,a)};a.updateGameTabs=m;Utils.addEvent(window,"resize",a.updateGameTabs);setInterval(m,20);a.activateTab=function(b,a){l[b].activate(a);m()};var c=function(){function b(){}b.prototype.deactivate=function(){Utils.cssSwap(this.button,"active","inactive");this.pane.style.display="none";this.pane.style.overflow="hidden"};b.prototype.activate=function(){Utils.cssSwap(this.button,"inactive","active");this.pane.style.display="block";this.pane.style.overflow=
"visible";h=this.pane};return b}()})(Tabs||(Tabs={}));var Chat;
(function(a){function m(){if(!e){e=document.createElement("DIV");e.style.transition="all 0.2s";e.id="chatWindow";e.style.position="fixed";e.style.bottom="0px";e.style.left="0px";e.style.minWidth="400px";e.style.width="40%";e.style.backgroundColor="#ebebeb";e.style.border="1px solid #adadad";e.style.height="280px";e.style.boxShadow="1px -1px 2px rgb(200,200,200)";var a=document.createElement("DIV");a.style.position="relative";a.style.height="30px";a.style.backgroundColor="rgb(160, 160, 160)";e.appendChild(a);
var c=document.createElement("DIV");c.textContent="Collapse";c.style.position="absolute";c.style.top="0";c.style.right="0";c.addEventListener("click",function(){var b=document.getElementById("chatWindow");b.style.bottom="0px"==b.style.bottom?"-251px":"0px"});a.appendChild(c);c=document.createElement("DIV");c.style.color="white";c.style.fontSize="18px";c.style.height="30px";c.style.display="inline-block";c.textContent="General";c.style.padding="3px 10px";c.addEventListener("click",function(){document.getElementById("debugpane").style.display=
"none";document.getElementById("chatpane").style.display="block"});a.appendChild(c);c=document.createElement("DIV");c.style.color="white";c.id="debugtab";c.style.fontSize="18px";c.style.height="30px";c.style.display="inline-block";c.textContent=">Dev";c.style.padding="3px 10px";c.addEventListener("click",function(){document.getElementById("debugpane").style.display="block";document.getElementById("chatpane").style.display="none"});c.style.display="none";a.appendChild(c);h=document.createElement("DIV");
h.id="debugpane";h.style.width="100%";h.style.height="230px";h.style.display="none";h.style.position="relative";e.appendChild(h);l=document.createElement("DIV");l.id="chatpane";l.style.width="100%";l.style.height="230px";l.style.position="relative";e.appendChild(l);a=document.createElement("DIV");a.id="debuglog";a.style.position="absolute";a.style.bottom="0px";a.style.maxHeight="230px";a.style.width="100%";a.style.overflow="auto";h.appendChild(a);a=document.createElement("DIV");a.id="chatlog";a.style.position=
"absolute";a.style.bottom="0px";a.style.maxHeight="230px";a.style.width="100%";a.style.overflow="auto";l.appendChild(a);a=document.createElement("INPUT");a.setAttribute("TYPE","TEXT");a.style.width="100%";a.style.maxWidth="none";a.style.height="20px";a.style.border="none";a.style.borderTop="1px solid #adadad";a.style.width="85%";a.setAttribute("maxlength","220");a.addEventListener("keydown",function(b){13==b.keyCode&&g();68==b.keyCode&&b.altKey&&(document.getElementById("debugtab").style.display=
"inline-block")});a.id="chattext";e.appendChild(a);a=document.createElement("INPUT");a.setAttribute("TYPE","BUTTON");a.setAttribute("VALUE","SEND");a.style.height="20px";a.style.width="15%";a.style.fontSize="13px";a.style.border="none";a.style.borderTop="1px solid #adadad";a.style.borderLeft="1px solid #adadad";a.addEventListener("click",function(){g()});e.appendChild(a);document.body.appendChild(e)}}function g(){Connection.sendGlobalMessage(document.getElementById("chattext").value);document.getElementById("chattext").value=
""}var e,l,h;a.initialize=m;m();a.log=function(a){var c=document.getElementById("debuglog"),b=document.createElement("DIV");b.textContent=a;c.appendChild(b)};a.receiveGlobalMessage=function(a,c,b,f){var k=document.getElementById("chatlog"),e=document.createElement("DIV");e.classList.add("chat-msg");f&&""!=f&&e.classList.add("chat-"+f);f=document.createElement("SPAN");f.textContent="["+Utils.convertServerTimeToLocal(b)+"] ";b=document.createElement("SPAN");b.textContent=a;b.classList.add("chat-sender");
a=document.createElement("SPAN");a.textContent=c;a.classList.add("chat-text");c=document.createElement("SPAN");c.textContent=": ";e.appendChild(f);e.appendChild(b);e.appendChild(c);e.appendChild(a);k.appendChild(e)}})(Chat||(Chat={}));var tooltip;
(function(a){function m(a,d){var c=b.getBoundingClientRect(),f=c.right-c.left,c=c.bottom-c.top;b.style.left=f+(a+15)>window.innerWidth?a-f-15+"px":a+15+"px";b.style.top=0<d-c?d-c+"px":d+5+"px"}function g(){b&&b.parentElement.removeChild(b);c=b=null}function e(a,b,c){var f=new t;l(a);c&&(f.header=c);f.content=b;d.push(f);a.dataset?a.dataset.tooltip=h:a.setAttribute("data-tooltip",h.toString());h++}function l(a){a.onmouseenter=function(a){var n=+a.target.getAttribute("data-tooltip");u!==a.target&&(f=
setInterval(function(){k+=.01;if(.25<=k){var a=q,e=r,x=d[n];c!==n&&g();c=n;b=x.html;document.body.appendChild(b);m(a,e);k=0;clearInterval(f);f=null}},10));u=a.target};a.onmousemove=function(a){a=a.pageX||a.pageY?{x:a.pageX,y:a.pageY}:a.clientX||a.clientY?{x:a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,y:a.clientY+document.body.scrollTop+document.documentElement.scrollTop}:void 0;f||m(a.x,a.y);q=a.x;r=a.y};a.onmouseleave=function(a){u=null;clearInterval(f);k=0;g()}}var h=
0,d=[],c,b,f,k=0,q,r,u,t=function(){function a(){this.html=document.createElement("div");this.html.classList.add("tooltip-wrapper")}Object.defineProperty(a.prototype,"header",{get:function(){return this.html.getElementsByClassName("tooltip-header")[0]},set:function(a){a.classList.add("tooltip-header");this.html.appendChild(a)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"content",{get:function(){return this.html.getElementsByClassName("tooltip-content")[0]},set:function(a){a.classList.add("tooltip-content");
this.html.appendChild(a)},enumerable:!0,configurable:!0});return a}();a.complexModify=function(a,b,c){a=d[a];c&&(a.header.parentElement.removeChild(a.header),a.header=c);a.content.parentElement.removeChild(a.content);a.content=b};a.modify=function(a,b,c){a=d[a];c&&(a.header.textContent=c);a.content.textContent=b};a.retrieveContent=function(a){return d[a].content};a.complexCreate=e;a.create=function(a,b,d){var c=document.createElement("div");c.textContent=b;d?(b=document.createElement("div"),b.textContent=
d,e(a,c,b)):e(a,c)}})(tooltip||(tooltip={}));var Inventory;
(function(a){function m(a){Connection.sellItem(k.id,a?a:1)}function g(){var b=document.getElementById("selecteditemquantity"),d=+b.value;Utils.isNumber(d)&&d>a.getSelectedItemQuantity()&&(b.value=a.getSelectedItemQuantity().toString())}function e(){d=document.createElement("DIV");document.getElementById("paneContainer").appendChild(d);b=document.createElement("DIV");b.classList.add("selected-item");b.style.display="none";var n=document.createElement("SPAN");n.textContent="x";n.style.top="0px";n.style.right=
"3px";n.style.position="absolute";n.addEventListener("click",function(){a.selectItem()});b.appendChild(n);f=document.createElement("DIV");f.classList.add("selected-item-image");n=document.createElement("INPUT");n.id="selecteditemquantity";n.type="text";n.style.height="18px";n.classList.add("selected-item-quantity");n.addEventListener("input",function(){g()});var e=Utils.createButton("Sell","");e.classList.add("selected-item-quantity");e.addEventListener("click",function(){var b=+document.getElementById("selecteditemquantity").value;
Utils.isNumber(b)&&a.sellSelectedItem(b);g()});var p=Utils.createButton("Sell all","");p.classList.add("selected-item-quantity");p.addEventListener("click",function(){a.sellAllSelectedItem();g()});b.appendChild(f);b.appendChild(p);b.appendChild(e);b.appendChild(n);d.appendChild(b);n=document.createElement("DIV");n.style.textAlign="center";e=document.createElement("DIV");e.style.display="inline-block";p=Utils.createButton("Sell (...)","");p.addEventListener("click",function(){Connection.sellAllItems()});
var x=Utils.createButton("...","");x.addEventListener("click",function(){a.toggleConfig()});e.appendChild(p);e.appendChild(x);n.appendChild(e);d.appendChild(n);r=document.createElement("DIV");r.classList.add("config-container");r.classList.add("closed");n=document.createElement("TABLE");n.classList.add("config-table");r.appendChild(n);p=n.createTHead();e=p.insertRow(0);p=p.insertRow(0);p.classList.add("table-header");p=p.insertCell(0);p.textContent="Inventory Configuration";p.setAttribute("colspan",
"10");e.classList.add("table-subheader");for(var v in w)0<=parseInt(v,10)&&"NFS"!=w[v]&&(e.insertCell(e.cells.length).classList.add("config-cell-check"),p=e.insertCell(e.cells.length),p.classList.add("config-cell-name"),p.textContent=w[v]);q=n.createTBody();c=document.createElement("DIV");c.style.position="relative";c.appendChild(r);d.appendChild(c);Tabs.registerGameTab(d,"Inventory")}function l(a){var b=document.createElement("DIV");a.container=b;b.classList.add("header-item");var d=document.createElement("DIV");
d.style.width="32px";d.style.height="32px";d.style.position="relative";d.style.margin="0 auto";var c=document.createElement("DIV");c.classList.add("Half-"+a.name.replace(" ","_"));d.appendChild(c);b.appendChild(d);d=document.createElement("DIV");a.quantityElm=d;d.classList.add("item-text");d.textContent=Utils.formatNumber(0);b.appendChild(d);d=document.createElement("DIV");d.style.display="none";a.worthElm=d;b.appendChild(d);return b}function h(b){if(0==b.category||null==b.category)return l(b);var d=
document.createElement("DIV");b.container=d;d.classList.add("item");d.addEventListener("click",function(){a.selectItem(b.id)});tooltip.create(d,b.name);var c=document.createElement("DIV");c.classList.add("item-text");var f=document.createElement("DIV");f.style.verticalAlign="top";f.style.display="inline-block";f.textContent=Utils.formatNumber(b.worth);b.worthElm=f;var e=document.createElement("DIV");e.classList.add("Quarter-Coins");e.style.display="inline-block";c.appendChild(e);c.appendChild(f);
d.appendChild(c);f=document.createElement("DIV");f.style.width="64px";f.style.height="64px";f.style.position="relative";f.style.margin="0 auto";c=document.createElement("DIV");c.classList.add(b.name.replace(" ","_"));f.appendChild(c);d.appendChild(f);c=document.createElement("DIV");b.quantityElm=c;c.classList.add("item-text");c.textContent=Utils.formatNumber(0);d.appendChild(c);if(null!=b.category){var y,k,f=q.rows.length,c=b.category,c=2*c;c--;for(e=0;e<f;e++){var g=q.rows[e].cells[c];if(g&&0==g.childElementCount){y=
q.rows[e].cells[c];k=q.rows[e].cells[c-1];break}}if(!y){k=q.insertRow(q.rows.length);k.classList.add("table-row");for(var s in w)0<=parseInt(s,10)&&"NFS"!=w[s]&&(k.insertCell(k.cells.length).classList.add("config-cell-check"),k.insertCell(k.cells.length).classList.add("config-cell-name"));y=k.cells[c];k=k.cells[c-1]}s=document.createElement("DIV");s.classList.add("item-text");f=document.createElement("SPAN");f.style.verticalAlign="top";c=document.createElement("DIV");c.classList.add("Third-"+Utils.cssifyName(b.name));
c.style.display="inline-block";t[b.id]=c;f.textContent=b.name;u[b.id]=f;s.appendChild(c);s.appendChild(f);y.appendChild(s);y=document.createElement("INPUT");y.type="CHECKBOX";var h=b.id;a.configClickers[h]=y;y.addEventListener("change",function(b){Connection.configureItem(h,a.configClickers[h].checked)});k.appendChild(y)}return d}a.items=[];a.configClickers=[];var d,c,b,f,k,q,r,u=[],t=[];console.log("Typescript is still compiling. WTF?");var z=function(){return function(a,b,d,c){this.id=a;this.name=
b;this.worth=d;this.category=c}}();a.Item=z;(function(a){a[a.NFS=0]="NFS";a[a.ORE=1]="ORE";a[a.GEM=2]="GEM";a[a.INGREDIENT=3]="INGREDIENT";a[a.CRAFTING=4]="CRAFTING";a[a.POTION=5]="POTION"})(a.Category||(a.Category={}));var w=a.Category;a.getSelectedItemQuantity=function(){return k?k.quantity:0};a.selectItem=function(d){d?(null!=k&&f.classList.remove(Utils.cssifyName(k.name)),k=a.items[d],f.classList.add(Utils.cssifyName(k.name)),g()):(f.classList.remove(Utils.cssifyName(k.name)),k=null);b.style.display=
null==k?"none":"block"};a.sellSelectedItem=m;a.sellAllSelectedItem=function(){m(k.quantity)};a.modifyConfig=function(b,d){a.configClickers[b]||console.log(b);a.configClickers[b].checked=d};a.toggleConfig=function(){r.classList.contains("closed")?r.classList.remove("closed"):r.classList.add("closed")};a.addItem=function(b,f,k,x){a.items[b]||(b=new z(b,f,k,x),a.items[b.id]=b,Objects.register(b.id,b.name),d||e(),0!=b.category&&null!=b.category?c.appendChild(h(b)):document.getElementById("headerInventory").appendChild(h(b)))};
a.changeQuantity=function(b,d){Utils.ifNotDefault(d,function(){Objects.setQuantity(b,d);Crafting.update();a.items[b].quantityElm.textContent=Utils.formatNumber(d);a.items[b].quantity=d;a.items[b].container.style.display=0!=a.items[b].category&&null!=a.items[b].category?0==d?"none":"inline-block":0==Objects.getLifeTimeTotal(b)?"none":"inline-block";g()})};a.update=function(){0>=u.length||a.items.forEach(function(a){var b=Objects.getLifeTimeTotal(a.id);u[a.id]&&(u[a.id].textContent=0<b?a.name:"???");
t[a.id]&&(t[a.id].style.display=0<b?"inline-block":"none")})}})(Inventory||(Inventory={}));var Connection;
(function(a){function m(){console.log("Connection opened");var a=h.encode64();g(a);h=new Komodo.ClientActions;l=setInterval(function(){var a=h.encode64();g(a);h=new Komodo.ClientActions},1E3)}function g(a){if(a.encode64){var c=a.encode64();Chat.log("Sent "+e(c)+" bytes to komodo.");Chat.log("Decoded: ");Chat.log(JSON.stringify(a));Chat.log("Encoded: ");Chat.log(a.encode64());Komodo.send(a.encode64())}else Chat.log("Sent "+e(a)+" bytes to komodo."),Komodo.send(a)}function e(a){var c=[];a=[a];for(var b=
0;a.length;){var f=a.pop();if("boolean"===typeof f)b+=4;else if("string"===typeof f)b+=2*f.length;else if("number"===typeof f)b+=8;else if("object"===typeof f&&-1===c.indexOf(f)){c.push(f);for(var e in f)a.push(f[e])}}return b}var l;Komodo.connection.received(function(a){Chat.log("Recieved "+e(a)+" bytes from komodo.");Chat.log("Encoded: ");Chat.log(a);Chat.log("Decoded: ");Chat.log(JSON.stringify(Komodo.decode(a)));Chat.log(e(JSON.stringify(Komodo.decode(a)))-e(a)+" bytes saved.");a=Komodo.decode(a);
if(null!=a.Messages)for(var c=a.Messages,b=0;b<c.length;b++){var f=c[b];Chat.receiveGlobalMessage(f.Sender,f.Text,f.Time,f.Permissions)}if(null!=a.GameSchema){c=a.GameSchema;if(c.Items)for(b=0;b<c.Items.length;b++)Inventory.addItem(c.Items[b].Id,c.Items[b].Name,c.Items[b].Worth,c.Items[b].Category),Statistics.addItem(c.Items[b].Id,c.Items[b].Name);if(c.StoreItems)for(b=0;b<c.StoreItems.length;b++)f=c.StoreItems[b],Store.addItem(f.Id,f.Category,f.Price,f.Factor,f.Name,f.MaxQuantity);if(c.Processors)for(b=
0;b<c.Processors.length;b++){f=c.Processors[b];Crafting.addProcessor(f.Id,f.Name);for(var k=0;k<f.Recipes.length;k++)Crafting.addProcessorRecipe(f.Id,f.Recipes[k].Ingredients,f.Recipes[k].Resultants)}if(c.CraftingItems)for(b=0;b<c.CraftingItems.length;b++)f=c.CraftingItems[b],Crafting.addRecipe(f.Id,f.Ingredients,f.Resultants,f.IsItem)}if(null!=a.Items)for(c=a.Items,b=0;b<c.length;b++)Inventory.changeQuantity(c[b].Id,c[b].Quantity);if(null!=a.StoreItemsUpdate)for(c=a.StoreItemsUpdate,b=0;b<c.length;b++)Store.changeQuantity(c[b].Id,
c[b].Quantity,c[b].MaxQuantity,c[b].Price);if(null!=a.StatItemsUpdate)for(c=a.StatItemsUpdate,b=0;b<c.length;b++)Statistics.changeStats(c[b].Id,c[b].PrestigeQuantity,c[b].LifeTimeQuantity);if(null!=a.ConfigItems)for(c=a.ConfigItems,b=0;b<c.length;b++)Inventory.modifyConfig(c[b].Id,c[b].Enabled);if(null!=a.Processors)for(c=a.Processors,b=0;b<c.length;b++)f=c[b],Crafting.updateProcessor(f.Id,f.SelectedRecipe,f.OperationDuration,f.CompletedOperations,f.TotalOperations,f.Capacity);null!=a.AntiCheatCoordinates&&
(a=a.AntiCheatCoordinates,Rock.moveRock(a.X,a.Y))});a.restart=function(){Komodo.restart()};var h=new Komodo.ClientActions;Komodo.connection.stateChanged(function(a){a.newState===$.signalR.connectionState.connected&&m();a.newState===$.signalR.connectionState.disconnected&&clearInterval(l)});a.mine=function(a,c){var b=new Komodo.ClientActions.MiningAction;b.X=a;b.Y=c;h.MiningActions.push(b)};a.sellItem=function(a,c){var b=new Komodo.ClientActions.InventoryAction,f=new Komodo.ClientActions.InventoryAction.SellAction;
f.Id=a;f.Quantity=c;b.Sell=f;h.InventoryActions.push(b)};a.configureItem=function(a,c){var b=new Komodo.ClientActions.InventoryAction,f=new Komodo.ClientActions.InventoryAction.ConfigAction;f.Id=a;f.Enabled=c;b.Config=f;h.InventoryActions.push(b)};a.purchaseItem=function(a,c){var b=new Komodo.ClientActions.StoreAction,f=new Komodo.ClientActions.StoreAction.PurchaseAction;f.Id=a;f.Quantity=c?c:1;b.Purchase=f;h.StoreActions.push(b)};a.sellAllItems=function(){var a=new Komodo.ClientActions.InventoryAction;
a.SellAll=!0;h.InventoryActions.push(a)};a.craftRecipe=function(a,c){var b=new Komodo.ClientActions.CraftingAction;b.Id=a;b.Quantity=c;h.CraftingActions.push(b)};a.processRecipe=function(a,c,b){var f=new Komodo.ClientActions.ProcessingAction;f.Id=a;f.RecipeIndex=c;f.Iterations=b;h.ProcessingActions.push(f)};a.sendGlobalMessage=function(a){var c=new Komodo.ClientActions.SocialAction,b=new Komodo.ClientActions.SocialAction.ChatAction;b.GlobalMessage=a;c.Chat=b;h.SocialActions.push(c)};a.send=g})(Connection||
(Connection={}));var Store;
(function(a){function m(){e=document.createElement("div");document.getElementById("paneContainer").appendChild(e);Tabs.registerGameTab(e,"Store");for(var a in d)if(0<=parseInt(a,10)){var c=d[a];if("CRAFTING"!=c){var k=document.createElement("div");k.classList.add("store-category");h[c]=k;var g=document.createElement("div");g.textContent=c;g.classList.add("store-category-header");k.appendChild(g);e.appendChild(k)}}}function g(a){var c=document.createElement("div");c.classList.add("store-item");a.container=
c;var d=document.createElement("div");d.classList.add("store-item-header");var e=document.createElement("div");e.classList.add("store-item-header-text");e.textContent=a.name;d.appendChild(e);var g=document.createElement("div");g.classList.add("store-item-header-quantity-container");var h=document.createElement("span");h.classList.add("store-item-header-quantity");var l=document.createElement("span");l.classList.add("store-item-header-quantity");var m=document.createElement("span");m.classList.add("store-item-header-quantity");
m.textContent="/";1<a.maxQuantity&&(g.appendChild(l),g.appendChild(m),g.appendChild(h));d.appendChild(g);a.maxQuantityElm=h;a.quantityElm=l;a.nameElm=e;c.appendChild(d);d=document.createElement("DIV");d.style.width="64px";d.style.height="64px";d.style.position="relative";d.style.margin="0 auto";e=document.createElement("DIV");e.classList.add(Utils.cssifyName(a.name));d.appendChild(e);c.appendChild(d);d=document.createElement("div");d.classList.add("store-item-footer");e=document.createElement("div");
e.classList.add("item-text");g=document.createElement("div");g.textContent=Utils.formatNumber(a.price);g.style.display="inline-block";g.style.verticalAlign="top";a.priceElm=g;h=document.createElement("div");h.classList.add("Quarter-Coins");h.style.display="inline-block";e.appendChild(h);e.appendChild(g);var g=document.createElement("div"),h=Utils.createButton("Buy",""),w=a.id;if(5!=a.category)h.addEventListener("click",function(){Connection.purchaseItem(w)});else{var n=document.createElement("INPUT");
n.type="TEXT";n.style.width="40px";n.style.height="15px";g.appendChild(n);h.addEventListener("click",function(){Utils.isNumber(n.value)&&Connection.purchaseItem(w,+n.value)})}g.appendChild(h);d.appendChild(g);d.appendChild(e);c.appendChild(d);return c}var e,l=[],h=[];(function(a){a[a.MINING=1]="MINING";a[a.MACHINES=2]="MACHINES";a[a.GATHERING=3]="GATHERING";a[a.PROCESSING=4]="PROCESSING";a[a.ITEMS=5]="ITEMS";a[a.CRAFTING=6]="CRAFTING"})(a.Category||(a.Category={}));var d=a.Category,c=function(){return function(){}}();
a.tempFix=function(){m()};a.addItem=function(a,f,k,q,r,u){e||m();if(!l[a]){var t=new c;t.id=a;t.category=f;t.price=k;t.factor=q;t.name=r;t.maxQuantity=u?u:0;Objects.register(t.id,t.name);f=h[d[f]];null==f&&(f=h.MINING);6!=t.category&&f.appendChild(g(t));l[a]=t}};a.changeQuantity=function(a,c,d,e){var g=l[a];Utils.ifNotDefault(d,function(){if(0!=d)try{g.maxQuantity=d,g.maxQuantityElm.textContent=d.toString()}catch(c){console.log(a)}});Utils.ifNotDefault(c,function(){Objects.setQuantity(a,c);g.quantity=
c;Crafting.update();0!=d&&6!=g.category&&(g.container.style.display=-1>=g.quantity||g.quantity>=g.maxQuantity&&0<g.maxQuantity?"none":"inline-block",g.maxQuantity&&1<g.maxQuantity&&(g.quantityElm.textContent=c.toString()))});Utils.ifNotDefault(e,function(){g.priceElm&&(g.price=e,g.priceElm.textContent=Utils.formatNumber(e))})}})(Store||(Store={}));var Statistics;
(function(a){function m(){var a=document.createElement("TABLE"),c=a.createTHead(),b=c.insertRow(0);b.classList.add("table-header");b=b.insertCell(0);b.textContent="Item Statistics";b.setAttribute("colspan","3");c=c.insertRow(1);c.classList.add("table-subheader");b=c.insertCell(0);b.textContent="Lifetime Quantity";b.style.width="40%";b=c.insertCell(0);b.textContent="Prestige Quantity";b.style.width="40%";c=c.insertCell(0);c.textContent="Item";c.style.width="20%";e=a.createTBody();return a}var g,e,
l=[],h=function(){return function(){}}();a.changeStats=function(a,c,b){var f=l[a];Utils.ifNotDefault(c,function(){f.prestigeQuantity=c;f.prestigeRow.textContent=Utils.formatNumber(c)});Utils.ifNotDefault(b,function(){f.lifetimeQuantity=b;Objects.setLifeTimeTotal(a,b);f.alltimeRow.textContent=Utils.formatNumber(b)})};a.addItem=function(a,c){g||(g=document.createElement("DIV"),document.getElementById("paneContainer").appendChild(g),Tabs.registerGameTab(g,"Statistics"),g.appendChild(m()));if(!l[a]){var b=
new h;l[a]=b;var f=e.insertRow(e.rows.length);f.classList.add("table-row");b.alltimeRow=f.insertCell(0);b.alltimeRow.style.width="40%";b.prestigeRow=f.insertCell(0);b.prestigeRow.style.width="40%";b=f.insertCell(0);b.style.width="20%";f=document.createElement("DIV");f.classList.add("Third-"+Utils.cssifyName(c));f.style.display="inline-block";b.appendChild(f)}}})(Statistics||(Statistics={}));var Crafting;
(function(a){function m(){h=document.createElement("DIV");document.getElementById("paneContainer").appendChild(h);Tabs.registerGameTab(h,"Crafting");d=document.createElement("DIV");h.appendChild(d);c=document.createElement("DIV");h.appendChild(c);b=document.createElement("TABLE");b.classList.add("block-table");var a=b.createTHead(),e=a.insertRow(0);e.classList.add("table-subheader");a=a.insertRow(0);a.classList.add("table-header");a=a.insertCell(0);a.colSpan=f.length;a.textContent="Crafting Table";
for(a=0;a<f.length;a++){var g=e.insertCell(0);g.style.width=k[a];g.textContent=f[a];"0"!=q[a]&&(g.style.minWidth=q[a])}e=b.insertRow(2);e.classList.add("table-subheader");e=e.insertCell(0);e.colSpan=f.length;e.textContent="Items";e=b.insertRow(3);e.classList.add("table-subheader");e=e.insertCell(0);e.colSpan=f.length;e.textContent="Upgrades";c.appendChild(b)}function g(b,c){var d=a.processors[b];if(d){var f=d._recipes[c];for(d.selectedRecipe=c;d.recipeList.lastChild;)d.recipeList.removeChild(d.recipeList.lastChild);
for(var e=0;e<f.ingredients.length;e++){var g=document.createElement("DIV");g.classList.add("item-text");g.style.height="30px";var h=document.createElement("DIV");h.style.display="inline-block";var k=document.createElement("DIV");f.ingredients[e].quantityDiv=k;k.style.display="inline-block";k.style.verticalAlign="super";k.style.color=f.ingredients[e].quantity<=Objects.getQuantity(f.ingredients[e].id)?"darkgreen":"darkred";k.textContent=Utils.formatNumber(f.ingredients[e].quantity);h.classList.add("Half-"+
Utils.cssifyName(Objects.lookupName(f.ingredients[e].id)));g.appendChild(h);g.appendChild(k);d.recipeList.appendChild(g)}}}function e(a){var b=document.createElement("TABLE");b.classList.add("block-table");var c=b.createTHead(),e=c.insertRow(0);e.classList.add("table-subheader");c=c.insertRow(0);c.classList.add("table-header");c=c.insertCell(0);c.colSpan=f.length;c.textContent=a.name;for(c=0;c<f.length;c++){var h=e.insertCell(0);h.style.width=u[c];h.textContent=r[c];"0"!=u[c]&&(h.style.minWidth=t[c])}c=
b.insertRow(2);c.classList.add("table-row");c=c.insertCell(0);c.colSpan=r.length;h=document.createElement("DIV");h.classList.add("progress-bar-container");e=document.createElement("DIV");e.classList.add("progress-bar");var s=document.createElement("DIV");s.classList.add("progress-bar-text-container");var l=document.createElement("DIV");l.classList.add("progress-bar-text");s.appendChild(l);h.appendChild(s);a.progressBar=e;a.progressText=l;h.appendChild(e);c.appendChild(h);e=b.insertRow(3);e.classList.add("table-row");
for(c=0;c<r.length;c++){h=e.insertCell(0);h.style.width=k[c];h.style.height="75px";"0"!=t[c]&&(h.style.minWidth=t[c]);"Image"==r[c]&&(s=document.createElement("DIV"),s.classList.add(Utils.cssifyName(a.name)),s.style.margin="0 auto",h.appendChild(s));"Capacity"==r[c]&&(h.textContent="0",a.capacityElm=h);"Input"==r[c]&&(a.recipeList=h);if("Output"==r[c]){s=Utils.createButton("Max","");h.appendChild(s);s=document.createElement("INPUT");s.type="TEXT";s.style.width="35px";a.quantityTextbox=s;h.appendChild(s);
var n=a.id,m=document.createElement("SELECT");m.addEventListener("change",function(a){g(n,m.selectedIndex)});a.recipeSelector=m;h.appendChild(m)}"Action"==r[c]&&(s=Utils.createButton("Activate",""),s.addEventListener("click",function(){Utils.isNumber(a.quantityTextbox.value)&&Connection.processRecipe(a.id,a.recipeSelector.selectedIndex,+a.quantityTextbox.value)},!1),h.appendChild(s))}d.appendChild(b)}function l(a,c){var d=b.rows.length;c&&(d=z,z++);d=b.insertRow(d);d.classList.add("table-row");a.row=
d;for(var e=0;e<f.length;e++){var g=d.insertCell(0);g.style.width=k[e];"0"!=q[e]&&(g.style.minWidth=q[e]);"Name"==f[e]&&(g.textContent=Objects.lookupName(a.id));if("Input"==f[e])for(var h=0;h<a.ingredients.length;h++){var l=document.createElement("DIV");l.classList.add("item-text");l.style.height="22px";var n=document.createElement("DIV");n.style.display="inline-block";var m=document.createElement("DIV");a.ingredients[h].quantityDiv=m;m.style.display="inline-block";m.style.verticalAlign="super";m.textContent=
Utils.formatNumber(a.ingredients[h].quantity);n.classList.add("Third-"+Utils.cssifyName(Objects.lookupName(a.ingredients[h].id)));l.appendChild(n);l.appendChild(m);g.appendChild(l)}if("Output"==f[e])for(h=0;h<a.resultants.length;h++)l=document.createElement("DIV"),l.classList.add("item-text"),l.style.height="22px",n=document.createElement("DIV"),n.style.display="inline-block",m=document.createElement("DIV"),m.style.display="inline-block",m.style.verticalAlign="super",m.textContent=Utils.formatNumber(a.resultants[h].quantity),
n.classList.add("Third-"+Utils.cssifyName(Objects.lookupName(a.resultants[h].id))),l.appendChild(n),a.isItem&&l.appendChild(m),g.appendChild(l);if("Action"==f[e]&&(h=Utils.createButton("Craft",""),h.addEventListener("click",function(){Connection.craftRecipe(a.id,1)},!1),g.appendChild(h),a.isItem)){var p=document.createElement("INPUT");p.type="TEXT";p.style.width="30px";h=Utils.createButton("Craft-x","");h.addEventListener("click",function(){Connection.craftRecipe(a.id,+p.value)},!1);g.appendChild(h);
g.appendChild(p)}}}var h,d,c,b,f=["Action","Description","Input","Output","Name"],k=["10%","50%","15%","15%","10%"],q=["170px","0","0","0","0"],r=["Action","Output","Input","Capacity","Image"],u=["10%","30%","20%","20%","20%"],t=["170px","0","0","0","0"],z=3,w=[];a.processors=[];var n=function(){function a(){this._recipes=[]}a.prototype.addRecipe=function(a){this._recipes.push(a);this.selectedRecipe||(this.selectedRecipe=0)};return a}();a.Processor=n;var A=function(){function a(){this.ingredients=
[];this.resultants=[]}a.prototype.addIngredient=function(a){this.ingredients.push(a)};a.prototype.addResultant=function(a){this.resultants.push(a)};return a}();a.Recipe=A;var p=function(){return function(a,b){this.id=a;this.quantity=b}}();a.Ingredient=p;a.addRecipe=function(a,b,c,d){h||m();if(!w[a]){var e=new A;e.id=a;e.isItem=d;w[a]=e;for(a=0;a<b.length;a++)e.addIngredient(new p(b[a].Id,b[a].Quantity));for(a=0;a<c.length;a++)e.addResultant(new p(c[a].Id,c[a].Quantity));l(e,d)}};a.addProcessor=function(b,
c){h||m();if(!a.processors[b]){var d=new n;d.id=b;d.name=c;a.processors[b]=d;e(d)}};a.addProcessorRecipe=function(b,c,d){if(a.processors[b]){var e=a.processors[b],f;a:if(a.processors[b]){f=a.processors[b];for(var h=0;h<f._recipes.length;h++)if(d[0].Id==f._recipes[h].resultants[0].id){f=!0;break a}f=!1}else f=void 0;if(!f){f=new A;for(h=0;h<c.length;h++)f.addIngredient(new p(c[h].Id,c[h].Quantity));for(h=0;h<d.length;h++)f.addResultant(new p(d[h].Id,d[h].Quantity));e.addRecipe(f);c=document.createElement("OPTION");
c.textContent=Objects.lookupName(d[0].Id);e.recipeSelector.appendChild(c);1==e._recipes.length&&g(b,0)}}};a.updateProcessor=function(b,c,d,e,f,h){var g=a.processors[b];if(g){var k=!1;Utils.ifNotDefault(c,function(){g.selectedRecipe=c});Utils.ifNotDefault(f,function(){g.totalOperations=f;k=!0});Utils.ifNotDefault(d,function(){g.operationDuration=d});Utils.ifNotDefault(h,function(){g.capacityElm.textContent=h.toString()});Utils.ifNotDefault(e,function(){g.completedOperations=e;k=!0});if(k){if(0>=g.totalOperations||
g.completedOperations==g.totalOperations)return;g.operationStartTime=Date.now();g.operationCompletionTime=g.operationStartTime+1E3*g.operationDuration;console.log("Start: "+g.operationStartTime+" End: "+g.operationCompletionTime)}if(-1<g.selectedRecipe)try{g.progressText.textContent=Objects.lookupName(g._recipes[g.selectedRecipe].resultants[0].id)+" ("+g.completedOperations+"/"+g.totalOperations+")"}catch(l){console.log("invalid processor recipe "+g.selectedRecipe)}else g.progressText.textContent=
""}};setInterval(function(){a.processors.forEach(function(a){if(0>=a.operationDuration)a.progressBar.style.width="0%";else if(a.completedOperations!=a.totalOperations&&0<a.totalOperations){var b=a.operationCompletionTime-Date.now(),b=b/1E3/a.operationDuration,b=100-100*b;a.progressBar.style.width=b+"%"}})},10);a.update=function(){h&&(w.forEach(function(a){var b=Objects.getQuantity(a.id);a.row.style.display=-1==b||!a.isItem&&0<b?"none":"";a.ingredients.forEach(function(a){var b=Objects.getQuantity(a.id);
a.quantityDiv.style.color=b>=a.quantity?"darkgreen":"darkred"})}),a.processors.forEach(function(a){g(a.id,a.recipeSelector.selectedIndex)}))}})(Crafting||(Crafting={}));
