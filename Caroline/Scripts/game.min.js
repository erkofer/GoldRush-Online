var Chat;
(function(e){function f(){if(!d){d=document.createElement("DIV");d.style.position="fixed";d.style.bottom="0";d.style.left="0";d.style.minWidth="400px";d.style.width="40%";d.style.backgroundColor="#ebebeb";d.style.border="1px solid #adadad";d.style.height="280px";d.style.boxShadow="1px -1px 2px rgb(200,200,200)";var a=document.createElement("DIV");a.style.height="30px";a.style.backgroundColor="rgb(160, 160, 160)";d.appendChild(a);var c=document.createElement("DIV");c.style.color="white";c.style.fontSize="18px";
c.style.height="30px";c.style.display="inline-block";c.textContent="General";c.style.padding="3px 10px";c.addEventListener("click",function(){document.getElementById("debugpane").style.display="none";document.getElementById("chatpane").style.display="block"});a.appendChild(c);c=document.createElement("DIV");c.style.color="white";c.id="debugtab";c.style.fontSize="18px";c.style.height="30px";c.style.display="inline-block";c.textContent=">Dev";c.style.padding="3px 10px";c.addEventListener("click",function(){document.getElementById("debugpane").style.display=
"block";document.getElementById("chatpane").style.display="none"});c.style.display="none";a.appendChild(c);g=document.createElement("DIV");g.id="debugpane";g.style.width="100%";g.style.height="230px";g.style.display="none";g.style.position="relative";d.appendChild(g);b=document.createElement("DIV");b.id="chatpane";b.style.width="100%";b.style.height="230px";b.style.position="relative";d.appendChild(b);a=document.createElement("DIV");a.id="debuglog";a.style.position="absolute";a.style.bottom="0px";
a.style.maxHeight="230px";a.style.width="100%";a.style.overflow="auto";g.appendChild(a);a=document.createElement("DIV");a.id="chatlog";a.style.position="absolute";a.style.bottom="0px";a.style.maxHeight="230px";a.style.width="100%";a.style.overflow="auto";b.appendChild(a);a=document.createElement("INPUT");a.setAttribute("TYPE","TEXT");a.style.width="100%";a.style.maxWidth="none";a.style.height="20px";a.style.border="none";a.style.borderTop="1px solid #adadad";a.style.width="85%";a.setAttribute("maxlength",
"220");a.addEventListener("keydown",function(a){13==a.keyCode&&k();68==a.keyCode&&a.altKey&&(document.getElementById("debugtab").style.display="inline-block")});a.id="chattext";d.appendChild(a);a=document.createElement("INPUT");a.setAttribute("TYPE","BUTTON");a.setAttribute("VALUE","SEND");a.style.height="20px";a.style.width="15%";a.style.fontSize="13px";a.style.border="none";a.style.borderTop="1px solid #adadad";a.style.borderLeft="1px solid #adadad";a.addEventListener("click",function(){k()});d.appendChild(a);
document.body.appendChild(d)}}function k(){Connection.sendGlobalMessage(document.getElementById("chattext").value);document.getElementById("chattext").value=""}var d,b,g;e.initialize=f;f();e.log=function(a){var c=document.getElementById("debuglog"),b=document.createElement("DIV");b.textContent=a;c.appendChild(b)};e.receiveGlobalMessage=function(a,b,g,d){var f=document.getElementById("chatlog"),h=document.createElement("DIV");h.classList.add("chat-msg");d&&""!=d&&h.classList.add("chat-"+d);d=document.createElement("SPAN");
d.textContent="["+Utils.convertServerTimeToLocal(g)+"] ";g=document.createElement("SPAN");g.textContent=a;g.classList.add("chat-sender");a=document.createElement("SPAN");a.textContent=b;a.classList.add("chat-text");b=document.createElement("SPAN");b.textContent=": ";h.appendChild(d);h.appendChild(g);h.appendChild(b);h.appendChild(a);f.appendChild(h)}})(Chat||(Chat={}));var Utils;
(function(e){e.cssifyName=function(f){return f.split(" ").join("_")};e.isNumber=function(f){return!isNaN(parseFloat(f))};e.formatNumber=function(f){return f?999999999999999<f?(f/1E15).toFixed(3)+"Qa":999999999999<f?(f/1E12).toFixed(3)+"T":999999999<f?(f/1E9).toFixed(3)+"B":999999<f?(f/1E6).toFixed(3)+"M":f.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","):"0"};e.convertServerTimeToLocal=function(f){var e=+f.split(":")[0],d=+f.split(":")[1].split(" ")[0];"PM"==f.split(":")[1].split(" ")[1]&&(e+=12);
f=(new Date).getTimezoneOffset();e-=f/60-f%60;d-=f%60;0>e&&(e=24-e);0>d&&(d=60-d,e--);return(10>e?"0":"")+e+":"+(10>d?"0":"")+d}})(Utils||(Utils={}));var tooltip;
(function(e){function f(a,b){var c=l.getBoundingClientRect(),h=c.right-c.left,c=c.bottom-c.top;l.style.left=h+(a+15)>window.innerWidth?a-h-15+"px":a+15+"px";l.style.top=0<b-c?b-c+"px":b+5+"px"}function k(){l&&l.parentElement.removeChild(l);c=l=null}function d(c,h,d){var e=new r;b(c);d&&(e.header=d);e.content=h;a.push(e);c.dataset?c.dataset.tooltip=g:c.setAttribute("data-tooltip",g.toString());g++}function b(b){b.onmouseenter=function(b){var e=+b.target.getAttribute("data-tooltip");p!==b.target&&(m=
setInterval(function(){n+=.01;if(.25<=n){var b=h,d=q,g=a[e];c!==e&&k();c=e;l=g.html;document.body.appendChild(l);f(b,d);n=0;clearInterval(m);m=null}},10));p=b.target};b.onmousemove=function(a){a=a.pageX||a.pageY?{x:a.pageX,y:a.pageY}:a.clientX||a.clientY?{x:a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,y:a.clientY+document.body.scrollTop+document.documentElement.scrollTop}:void 0;m||f(a.x,a.y);h=a.x;q=a.y};b.onmouseleave=function(a){p=null;clearInterval(m);n=0;k()}}var g=
0,a=[],c,l,m,n=0,h,q,p,r=function(){function a(){this.html=document.createElement("div");this.html.classList.add("tooltip-wrapper")}Object.defineProperty(a.prototype,"header",{get:function(){return this.html.getElementsByClassName("tooltip-header")[0]},set:function(a){a.classList.add("tooltip-header");this.html.appendChild(a)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"content",{get:function(){return this.html.getElementsByClassName("tooltip-content")[0]},set:function(a){a.classList.add("tooltip-content");
this.html.appendChild(a)},enumerable:!0,configurable:!0});return a}();e.complexModify=function(b,c,h){b=a[b];h&&(b.header.parentElement.removeChild(b.header),b.header=h);b.content.parentElement.removeChild(b.content);b.content=c};e.modify=function(b,c,h){b=a[b];h&&(b.header.textContent=h);b.content.textContent=c};e.retrieveContent=function(b){return a[b].content};e.complexCreate=d;e.create=function(a,b,c){var h=document.createElement("div");h.textContent=b;c?(b=document.createElement("div"),b.textContent=
c,d(a,h,b)):d(a,h)}})(tooltip||(tooltip={}));var Inventory;
(function(e){function f(a){Connection.sellItem(m.id,a?a:1)}function k(){var a=document.getElementById("selecteditemquantity"),b=+a.value;Utils.isNumber(b)&&b>e.getSelectedItemQuantity()&&(a.value=e.getSelectedItemQuantity().toString())}function d(){a=document.createElement("DIV");document.getElementById("paneContainer").appendChild(a);c=document.createElement("DIV");c.classList.add("selected-item");l=document.createElement("DIV");l.classList.add("selected-item-image");var b=document.createElement("INPUT");
b.id="selecteditemquantity";b.type="text";b.classList.add("selected-item-quantity");b.addEventListener("input",function(){k()});var d=document.createElement("INPUT");d.type="button";d.classList.add("selected-item-quantity");d.value="Sell";d.addEventListener("click",function(){var a=+document.getElementById("selecteditemquantity").value;Utils.isNumber(a)&&e.sellSelectedItem(a);k()});var g=document.createElement("INPUT");g.type="button";g.classList.add("selected-item-quantity");g.value="Sell all";g.addEventListener("click",
function(){e.sellAllSelectedItem();k()});c.appendChild(l);c.appendChild(g);c.appendChild(d);c.appendChild(b);a.appendChild(c)}function b(a){var b=document.createElement("DIV");a.container=b;b.classList.add("item");b.addEventListener("click",function(){e.selectItem(a.id)});tooltip.create(b,a.name);var c=document.createElement("DIV");c.classList.add("item-text");var d=document.createElement("DIV");d.style.verticalAlign="top";d.style.display="inline-block";d.textContent=Utils.formatNumber(a.worth);a.worthElm=
d;var g=document.createElement("DIV");g.classList.add("Third-Coins");g.style.display="inline-block";c.appendChild(g);c.appendChild(d);b.appendChild(c);c=document.createElement("DIV");c.style.width="64px";c.style.height="64px";c.style.position="relative";c.style.margin="0 auto";d=document.createElement("DIV");d.classList.add(a.name.replace(" ","_"));c.appendChild(d);b.appendChild(c);c=document.createElement("DIV");a.quantityElm=c;c.classList.add("item-text");c.textContent=Utils.formatNumber(0);b.appendChild(c);
return b}var g=[],a,c,l,m,n=function(){return function(a,b,c){this.id=a;this.name=b;this.worth=c}}();e.getSelectedItemQuantity=function(){return m?m.quantity:0};e.selectItem=function(a){a?(null!=m&&l.classList.remove(Utils.cssifyName(m.name)),m=g[a],l.classList.add(Utils.cssifyName(m.name)),c.style.display="block",k()):(l.classList.remove(Utils.cssifyName(m.name)),m=null,c.style.display="none")};e.sellSelectedItem=f;e.sellAllSelectedItem=function(){f(m.quantity)};e.addItem=function(c,e,f){g[c]||(c=
new n(c,e,f),g[c.id]=c,a||d(),a.appendChild(b(c)))};e.changeQuantity=function(a,b){g[a].quantityElm.textContent=Utils.formatNumber(b);g[a].quantity=b;g[a].container.style.display=0==b?"none":"inline-block";k()}})(Inventory||(Inventory={}));var Connection;
(function(e){function f(b){if(b.encode64){var d=b.encode64();Chat.log("Sent "+k(d)+" bytes to komodo.");Chat.log("Decoded: ");Chat.log(JSON.stringify(b));Chat.log("Encoded: ");Chat.log(b.encode64());Komodo.send(b.encode64())}else Chat.log("Sent "+k(b)+" bytes to komodo."),Komodo.send(b)}function k(b){var d=[];b=[b];for(var a=0;b.length;){var c=b.pop();if("boolean"===typeof c)a+=4;else if("string"===typeof c)a+=2*c.length;else if("number"===typeof c)a+=8;else if("object"===typeof c&&-1===d.indexOf(c)){d.push(c);
for(var e in c)b.push(c[e])}}return a}Komodo.connection.received(function(b){Chat.log("Recieved "+k(b)+" bytes from komodo.");Chat.log("Encoded: ");Chat.log(b);Chat.log("Decoded: ");Chat.log(JSON.stringify(Komodo.decode(b)));Chat.log(k(JSON.stringify(Komodo.decode(b)))-k(b)+" bytes saved.");b=Komodo.decode(b);null!=b.Message&&Chat.receiveGlobalMessage(b.Message.Sender,b.Message.Text,b.Message.Time,b.Message.Permissions);if(null!=b.GameSchema)for(var d=b.GameSchema,a=0;a<d.Items.length;a++)Inventory.addItem(d.Items[a].Id,
d.Items[a].Name,d.Items[a].Worth);if(null!=b.Items)for(b=b.Items,d=0;d<b.length;d++)Inventory.changeQuantity(b[d].Id,b[d].Quantity)});var d=new Komodo.ClientActions;setInterval(function(){var b=d.encode64();""!=b&&f(b);d=new Komodo.ClientActions},1E3);e.sellItem=function(b,e){var a=new Komodo.ClientActions.InventoryAction,c=new Komodo.ClientActions.InventoryAction.SellAction;c.Id=b;c.Quantity=e;a.Sell=c;d.InventoryActions.push(a)};e.sellAllItems=function(){};e.sendGlobalMessage=function(b){var e=
new Komodo.ClientActions.SocialAction,a=new Komodo.ClientActions.SocialAction.ChatAction;a.GlobalMessage=b;e.Chat=a;d.SocialActions.push(e)};e.send=f})(Connection||(Connection={}));
