var Utils;
(function(b){b.cssSwap=function(b,f,d){b.classList.contains(f)&&b.classList.remove(f);b.classList.add(d)};b.cssifyName=function(b){return b.split(" ").join("_")};b.createButton=function(b,f){var d,e;d=document.createElement("div");e=document.createElement("div");e.textContent=b;f&&(e.id=f);d.classList.add("button");d.appendChild(e);return d};b.isNumber=function(b){return!isNaN(parseFloat(b))};b.formatNumber=function(b){return b?999999999999999<b?(b/1E15).toFixed(3)+"Qa":999999999999<b?(b/1E12).toFixed(3)+
"T":999999999<b?(b/1E9).toFixed(3)+"B":999999<b?(b/1E6).toFixed(3)+"M":b.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","):"0"};b.convertServerTimeToLocal=function(b){var f=+b.split(":")[0],d=+b.split(":")[1].split(" ")[0];"PM"==b.split(":")[1].split(" ")[1]&&(f+=12);b=(new Date).getTimezoneOffset();f-=b/60-b%60;d-=b%60;0>f&&(f=24-f);0>d&&(d=60-d,f--);23<f&&(f-=24);59<d&&(d-=60,f++);return(10>f?"0":"")+f+":"+(10>d?"0":"")+d}})(Utils||(Utils={}));var Tabs;
(function(b){var h=0,f=[],d=new (function(){function g(c){this.container=c;this.tabs=[];this.lowestId=0;this.id=h++;f.push(this)}g.prototype.newTab=function(c){var a=new e;a.pane=c;c=document.createElement("DIV");c.classList.add("tab-button");this.container.appendChild(c);a.button=c;0==this.lowestId?a.button.classList.add("active"):(a.button.classList.add("inactive"),a.pane.style.display="none");var g=this.lowestId++,d=this.id;c.addEventListener("click",function(){b.activateTab(d,g)});this.tabs.push(a);
this.container.appendChild(c);return this.lowestId-1};g.prototype.activate=function(c){for(var a=0;a<this.tabs.length;a++)this.tabs[a].deactivate();this.tabs[c].activate()};g.prototype.css=function(c,a){this.tabs[c].button.classList.add(a)};return g}())(document.getElementById("tabContainer"));b.registerGameTab=function(b,c){var a=d.newTab(b);c&&d.css(a,c)};b.activateTab=function(b,c){f[b].activate(c)};var e=function(){function b(){}b.prototype.deactivate=function(){Utils.cssSwap(this.button,"active",
"inactive");this.pane.style.display="none"};b.prototype.activate=function(){Utils.cssSwap(this.button,"inactive","active");this.pane.style.display="block"};return b}()})(Tabs||(Tabs={}));var Chat;
(function(b){function h(){if(!d){d=document.createElement("DIV");d.style.position="fixed";d.style.bottom="0";d.style.left="0";d.style.minWidth="400px";d.style.width="40%";d.style.backgroundColor="#ebebeb";d.style.border="1px solid #adadad";d.style.height="280px";d.style.boxShadow="1px -1px 2px rgb(200,200,200)";var c=document.createElement("DIV");c.style.height="30px";c.style.backgroundColor="rgb(160, 160, 160)";d.appendChild(c);var a=document.createElement("DIV");a.style.color="white";a.style.fontSize=
"18px";a.style.height="30px";a.style.display="inline-block";a.textContent="General";a.style.padding="3px 10px";a.addEventListener("click",function(){document.getElementById("debugpane").style.display="none";document.getElementById("chatpane").style.display="block"});c.appendChild(a);a=document.createElement("DIV");a.style.color="white";a.id="debugtab";a.style.fontSize="18px";a.style.height="30px";a.style.display="inline-block";a.textContent=">Dev";a.style.padding="3px 10px";a.addEventListener("click",
function(){document.getElementById("debugpane").style.display="block";document.getElementById("chatpane").style.display="none"});a.style.display="none";c.appendChild(a);g=document.createElement("DIV");g.id="debugpane";g.style.width="100%";g.style.height="230px";g.style.display="none";g.style.position="relative";d.appendChild(g);e=document.createElement("DIV");e.id="chatpane";e.style.width="100%";e.style.height="230px";e.style.position="relative";d.appendChild(e);c=document.createElement("DIV");c.id=
"debuglog";c.style.position="absolute";c.style.bottom="0px";c.style.maxHeight="230px";c.style.width="100%";c.style.overflow="auto";g.appendChild(c);c=document.createElement("DIV");c.id="chatlog";c.style.position="absolute";c.style.bottom="0px";c.style.maxHeight="230px";c.style.width="100%";c.style.overflow="auto";e.appendChild(c);c=document.createElement("INPUT");c.setAttribute("TYPE","TEXT");c.style.width="100%";c.style.maxWidth="none";c.style.height="20px";c.style.border="none";c.style.borderTop=
"1px solid #adadad";c.style.width="85%";c.setAttribute("maxlength","220");c.addEventListener("keydown",function(c){13==c.keyCode&&f();68==c.keyCode&&c.altKey&&(document.getElementById("debugtab").style.display="inline-block")});c.id="chattext";d.appendChild(c);c=document.createElement("INPUT");c.setAttribute("TYPE","BUTTON");c.setAttribute("VALUE","SEND");c.style.height="20px";c.style.width="15%";c.style.fontSize="13px";c.style.border="none";c.style.borderTop="1px solid #adadad";c.style.borderLeft=
"1px solid #adadad";c.addEventListener("click",function(){f()});d.appendChild(c);document.body.appendChild(d)}}function f(){Connection.sendGlobalMessage(document.getElementById("chattext").value);document.getElementById("chattext").value=""}var d,e,g;b.initialize=h;h();b.log=function(c){var a=document.getElementById("debuglog"),b=document.createElement("DIV");b.textContent=c;a.appendChild(b)};b.receiveGlobalMessage=function(c,a,b,e){var d=document.getElementById("chatlog"),m=document.createElement("DIV");
m.classList.add("chat-msg");e&&""!=e&&m.classList.add("chat-"+e);e=document.createElement("SPAN");e.textContent="["+Utils.convertServerTimeToLocal(b)+"] ";b=document.createElement("SPAN");b.textContent=c;b.classList.add("chat-sender");c=document.createElement("SPAN");c.textContent=a;c.classList.add("chat-text");a=document.createElement("SPAN");a.textContent=": ";m.appendChild(e);m.appendChild(b);m.appendChild(a);m.appendChild(c);d.appendChild(m)}})(Chat||(Chat={}));var tooltip;
(function(b){function h(c,a){var b=k.getBoundingClientRect(),e=b.right-b.left,b=b.bottom-b.top;k.style.left=e+(c+15)>window.innerWidth?c-e-15+"px":c+15+"px";k.style.top=0<a-b?a-b+"px":a+5+"px"}function f(){k&&k.parentElement.removeChild(k);a=k=null}function d(a,b,d){var m=new r;e(a);d&&(m.header=d);m.content=b;c.push(m);a.dataset?a.dataset.tooltip=g:a.setAttribute("data-tooltip",g.toString());g++}function e(b){b.onmouseenter=function(b){var e=+b.target.getAttribute("data-tooltip");n!==b.target&&(l=
setInterval(function(){p+=.01;if(.25<=p){var b=m,d=q,g=c[e];a!==e&&f();a=e;k=g.html;document.body.appendChild(k);h(b,d);p=0;clearInterval(l);l=null}},10));n=b.target};b.onmousemove=function(a){a=a.pageX||a.pageY?{x:a.pageX,y:a.pageY}:a.clientX||a.clientY?{x:a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,y:a.clientY+document.body.scrollTop+document.documentElement.scrollTop}:void 0;l||h(a.x,a.y);m=a.x;q=a.y};b.onmouseleave=function(a){n=null;clearInterval(l);p=0;f()}}var g=
0,c=[],a,k,l,p=0,m,q,n,r=function(){function a(){this.html=document.createElement("div");this.html.classList.add("tooltip-wrapper")}Object.defineProperty(a.prototype,"header",{get:function(){return this.html.getElementsByClassName("tooltip-header")[0]},set:function(a){a.classList.add("tooltip-header");this.html.appendChild(a)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"content",{get:function(){return this.html.getElementsByClassName("tooltip-content")[0]},set:function(a){a.classList.add("tooltip-content");
this.html.appendChild(a)},enumerable:!0,configurable:!0});return a}();b.complexModify=function(a,b,e){a=c[a];e&&(a.header.parentElement.removeChild(a.header),a.header=e);a.content.parentElement.removeChild(a.content);a.content=b};b.modify=function(a,b,e){a=c[a];e&&(a.header.textContent=e);a.content.textContent=b};b.retrieveContent=function(a){return c[a].content};b.complexCreate=d;b.create=function(a,c,b){var e=document.createElement("div");e.textContent=c;b?(c=document.createElement("div"),c.textContent=
b,d(a,e,c)):d(a,e)}})(tooltip||(tooltip={}));var Inventory;
(function(b){function h(a){Connection.sellItem(l.id,a?a:1)}function f(){var a=document.getElementById("selecteditemquantity"),c=+a.value;Utils.isNumber(c)&&c>b.getSelectedItemQuantity()&&(a.value=b.getSelectedItemQuantity().toString())}function d(){c=document.createElement("DIV");document.getElementById("paneContainer").appendChild(c);a=document.createElement("DIV");a.classList.add("selected-item");k=document.createElement("DIV");k.classList.add("selected-item-image");var e=document.createElement("INPUT");
e.id="selecteditemquantity";e.type="text";e.classList.add("selected-item-quantity");e.addEventListener("input",function(){f()});var d=document.createElement("INPUT");d.type="button";d.classList.add("selected-item-quantity");d.value="Sell";d.addEventListener("click",function(){var a=+document.getElementById("selecteditemquantity").value;Utils.isNumber(a)&&b.sellSelectedItem(a);f()});var g=document.createElement("INPUT");g.type="button";g.classList.add("selected-item-quantity");g.value="Sell all";g.addEventListener("click",
function(){b.sellAllSelectedItem();f()});a.appendChild(k);a.appendChild(g);a.appendChild(d);a.appendChild(e);c.appendChild(a);Tabs.registerGameTab(c,"Inventory")}function e(a){var c=document.createElement("DIV");a.container=c;c.classList.add("item");c.addEventListener("click",function(){b.selectItem(a.id)});tooltip.create(c,a.name);var e=document.createElement("DIV");e.classList.add("item-text");var d=document.createElement("DIV");d.style.verticalAlign="top";d.style.display="inline-block";d.textContent=
Utils.formatNumber(a.worth);a.worthElm=d;var g=document.createElement("DIV");g.classList.add("Third-Coins");g.style.display="inline-block";e.appendChild(g);e.appendChild(d);c.appendChild(e);e=document.createElement("DIV");e.style.width="64px";e.style.height="64px";e.style.position="relative";e.style.margin="0 auto";d=document.createElement("DIV");d.classList.add(a.name.replace(" ","_"));e.appendChild(d);c.appendChild(e);e=document.createElement("DIV");a.quantityElm=e;e.classList.add("item-text");
e.textContent=Utils.formatNumber(0);c.appendChild(e);return c}var g=[],c,a,k,l,p=function(){return function(a,c,b){this.id=a;this.name=c;this.worth=b}}();b.getSelectedItemQuantity=function(){return l?l.quantity:0};b.selectItem=function(c){c?(null!=l&&k.classList.remove(Utils.cssifyName(l.name)),l=g[c],k.classList.add(Utils.cssifyName(l.name)),a.style.display="block",f()):(k.classList.remove(Utils.cssifyName(l.name)),l=null,a.style.display="none")};b.sellSelectedItem=h;b.sellAllSelectedItem=function(){h(l.quantity)};
b.addItem=function(a,b,f){g[a]||(a=new p(a,b,f),g[a.id]=a,c||d(),c.appendChild(e(a)))};b.changeQuantity=function(a,c){g[a].quantityElm.textContent=Utils.formatNumber(c);g[a].quantity=c;g[a].container.style.display=0==c?"none":"inline-block";f()}})(Inventory||(Inventory={}));var Connection;
(function(b){function h(b){if(b.encode64){var d=b.encode64();Chat.log("Sent "+f(d)+" bytes to komodo.");Chat.log("Decoded: ");Chat.log(JSON.stringify(b));Chat.log("Encoded: ");Chat.log(b.encode64());Komodo.send(b.encode64())}else Chat.log("Sent "+f(b)+" bytes to komodo."),Komodo.send(b)}function f(b){var d=[];b=[b];for(var c=0;b.length;){var a=b.pop();if("boolean"===typeof a)c+=4;else if("string"===typeof a)c+=2*a.length;else if("number"===typeof a)c+=8;else if("object"===typeof a&&-1===d.indexOf(a)){d.push(a);
for(var f in a)b.push(a[f])}}return c}Komodo.connection.received(function(b){Chat.log("Recieved "+f(b)+" bytes from komodo.");Chat.log("Encoded: ");Chat.log(b);Chat.log("Decoded: ");Chat.log(JSON.stringify(Komodo.decode(b)));Chat.log(f(JSON.stringify(Komodo.decode(b)))-f(b)+" bytes saved.");b=Komodo.decode(b);null!=b.Message&&Chat.receiveGlobalMessage(b.Message.Sender,b.Message.Text,b.Message.Time,b.Message.Permissions);if(null!=b.GameSchema){for(var d=b.GameSchema,c=0;c<d.Items.length;c++)Inventory.addItem(d.Items[c].Id,
d.Items[c].Name,d.Items[c].Worth);for(c=0;c<d.StoreItems.length;c++){var a=d.StoreItems[c];console.log(a);Store.addItem(a.Id,a.Category,a.Price,a.Factor,a.Name,a.maxQuantity)}}if(null!=b.Items)for(b=b.Items,d=0;d<b.length;d++)Inventory.changeQuantity(b[d].Id,b[d].Quantity)});var d=new Komodo.ClientActions;setInterval(function(){var b=d.encode64();h(b);d=new Komodo.ClientActions},1E3);b.sellItem=function(b,g){var c=new Komodo.ClientActions.InventoryAction,a=new Komodo.ClientActions.InventoryAction.SellAction;
a.Id=b;a.Quantity=g;c.Sell=a;d.InventoryActions.push(c)};b.purchaseItem=function(b,g){var c=new Komodo.ClientActions.StoreAction,a=new Komodo.ClientActions.StoreAction.PurchaseAction;a.Id=b;a.Quantity=g?g:1;c.Purchase=a;d.StoreActions.push(c)};b.sellAllItems=function(){};b.sendGlobalMessage=function(b){var g=new Komodo.ClientActions.SocialAction,c=new Komodo.ClientActions.SocialAction.ChatAction;c.GlobalMessage=b;g.Chat=c;d.SocialActions.push(g)};b.send=h})(Connection||(Connection={}));var Store;
(function(b){function h(){d=document.createElement("div");document.getElementById("paneContainer").appendChild(d);Tabs.registerGameTab(d,"Store");for(var a in g)if(0<=parseInt(a,10)){var c=g[a];if("CRAFTING"!=c){var e=document.createElement("div");e.classList.add("store-category");b.categories[c]=e;var f=document.createElement("div");f.textContent=c;f.classList.add("store-category-header");e.appendChild(f);d.appendChild(e)}}}function f(a){var b=document.createElement("div");b.classList.add("store-item");
var c=document.createElement("div");c.classList.add("store-item-header");c.textContent=1>a.maxQuantity?a.name:a.name+" ("+a.quantity+"/"+a.maxQuantity+")";a.nameElm=c;b.appendChild(c);c=document.createElement("DIV");c.style.width="64px";c.style.height="64px";c.style.position="relative";c.style.margin="0 auto";var d=document.createElement("DIV");d.classList.add(Utils.cssifyName(a.name));c.appendChild(d);b.appendChild(c);c=document.createElement("div");c.classList.add("store-item-footer");d=document.createElement("div");
d.classList.add("item-text");var e=document.createElement("div");e.textContent=Utils.formatNumber(a.price);e.style.display="inline-block";e.style.verticalAlign="top";a.priceElm=e;var f=document.createElement("div");f.classList.add("Third-Coins");f.style.display="inline-block";d.appendChild(f);d.appendChild(e);var e=document.createElement("div"),f=Utils.createButton("Buy",""),g=a.id;if(5!=a.category)f.addEventListener("click",function(){Connection.purchaseItem(g)});else{var h=document.createElement("INPUT");
h.type="TEXT";h.style.width="40px";h.style.height="21px";e.appendChild(h);f.addEventListener("click",function(){Utils.isNumber(h.value)&&Connection.purchaseItem(g,+h.value)})}e.appendChild(f);c.appendChild(e);c.appendChild(d);b.appendChild(c);return b}var d,e=[];b.categories=[];(function(a){a[a.MINING=1]="MINING";a[a.MACHINES=2]="MACHINES";a[a.GATHERING=3]="GATHERING";a[a.PROCESSING=4]="PROCESSING";a[a.ITEMS=5]="ITEMS";a[a.CRAFTING=6]="CRAFTING"})(b.Category||(b.Category={}));var g=b.Category,c=function(){return function(){}}();
b.tempFix=function(){h()};b.addItem=function(a,k,l,p,m,q){d||h();if(!e[a]){var n=new c;n.id=a;n.category=k;n.price=l;n.factor=p;n.name=m;n.maxQuantity=q;b.categories[g[k]].appendChild(f(n));e[a]=n}}})(Store||(Store={}));
