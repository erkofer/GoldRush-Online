var Utils;
(function(b){b.addEvent=function(b,f,d){null!=b&&"undefined"!=typeof b&&(b.addEventListener?b.addEventListener(f,d,!1):b.attachEvent?b.attachEvent("on"+f,d):b["on"+f]=d)};b.cssSwap=function(b,f,d){b.classList.contains(f)&&b.classList.remove(f);b.classList.add(d)};b.cssifyName=function(b){return b.split(" ").join("_")};b.createButton=function(b,f){var d,k;d=document.createElement("div");k=document.createElement("div");k.textContent=b;f&&(k.id=f);d.classList.add("button");d.appendChild(k);return d};
b.isNumber=function(b){return!isNaN(parseFloat(b))};b.formatNumber=function(b){return b?999999999999999<b?(b/1E15).toFixed(3)+"Qa":999999999999<b?(b/1E12).toFixed(3)+"T":999999999<b?(b/1E9).toFixed(3)+"B":999999<b?(b/1E6).toFixed(3)+"M":b.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","):"0"};b.convertServerTimeToLocal=function(b){var f=+b.split(":")[0],d=+b.split(":")[1].split(" ")[0];"PM"==b.split(":")[1].split(" ")[1]&&(f+=12);b=(new Date).getTimezoneOffset();f-=b/60-b%60;d-=b%60;0>f&&(f=24-f);0>
d&&(d=60-d,f--);23<f&&(f-=24);59<d&&(d-=60,f++);return(10>f?"0":"")+f+":"+(10>d?"0":"")+d}})(Utils||(Utils={}));var modal;
(function(b){function m(){b.activeWindow&&b.activeWindow.hide();b.activeWindow=null}function f(){if(b.activeWindow){var a=b.activeWindow.container.getBoundingClientRect();b.activeWindow.container.style.left=window.innerWidth/2-(a.right-a.left)/2+"px";b.activeWindow.container.style.top=window.innerHeight/2-(a.bottom-a.top)/2+"px"}else clearInterval(b.intervalIdentifier)}var d=0,k;b.activeWindow;b.intervalIdentifier;b.hide=m;b.close=function(){if(b.activeWindow){var a=b.activeWindow;m();a.container.parentNode.removeChild(a.container)}};
var h=function(){function a(){this.container=document.createElement("div");this.container.addEventListener("click",function(c){c.stopPropagation()},!1);this.container.classList.add("modal-window");if(!k){var a=document.createElement("div");k=a;a.classList.add("modal-wrapper");a.addEventListener("click",function(c){c.stopPropagation();3E3<Date.now()-d&&b.close()},!1);document.body.appendChild(a)}k.appendChild(this.container);this.titleEl=document.createElement("div");this.titleEl.classList.add("modal-header");
this.bodyEl=document.createElement("div");this.container.appendChild(this.titleEl);this.container.appendChild(this.bodyEl)}Object.defineProperty(a.prototype,"title",{get:function(){return this._title},set:function(a){this._title=a;this.titleEl.textContent=this._title},enumerable:!0,configurable:!0});a.prototype.addElement=function(a){this.bodyEl.appendChild(a)};a.prototype.addOption=function(a){this.options||(this.options=document.createElement("div"),this.options.classList.add("modal-options"),this.container.appendChild(this.options));
var c=document.createElement("span");c.classList.add("modal-option");var b=document.createElement("span");b.textContent=a;c.appendChild(b);this.options.appendChild(c);return c};a.prototype.addAffirmativeOption=function(a){a=this.addOption(a);a.classList.add("affirmative");return a};a.prototype.addNegativeOption=function(a){a=this.addOption(a);a.classList.add("negative");return a};a.prototype.show=function(){this.container.classList.contains("opened")||this.container.classList.add("opened");k.classList.contains("opened")||
k.classList.add("opened");b.activeWindow=this;f();b.intervalIdentifier=setInterval(f,100);d=Date.now()};a.prototype.hide=function(){this.container.classList.contains("opened")&&this.container.classList.remove("opened");k.classList.contains("opened")&&k.classList.remove("opened")};return a}();b.Window=h})(modal||(modal={}));var Account;
(function(b){function m(){c.classList.contains("closed")||c.classList.add("closed")}function f(){var a=new modal.Window,c=document.createElement("DIV");c.style.width="400px";var b=document.createElement("DIV");b.style.marginBottom="5px";var g=document.createElement("INPUT");g.type="TEXT";g.maxLength=16;g.placeholder="Username";b.appendChild(g);var e=document.createElement("DIV");e.style.marginBottom="5px";var n=document.createElement("INPUT");n.type="PASSWORD";n.pattern=".{6,}";n.placeholder="Password";
e.appendChild(n);var d=document.createElement("DIV");d.style.marginBottom="5px";var f=document.createElement("INPUT");f.type="CHECKBOX";f.placeholder="Stay logged in on this computer?";d.appendChild(f);c.appendChild(b);c.appendChild(e);c.appendChild(d);a.title="Log in";a.addElement(c);a.addNegativeOption("Cancel").addEventListener("click",function(){modal.close()},!1);a.addAffirmativeOption("Submit").addEventListener("click",function(){h(g.value,n.value,f.checked);modal.close()},!1);a.show()}function d(){var a=
new modal.Window,c=document.createElement("DIV");c.style.width="400px";var b=document.createElement("DIV");b.style.marginBottom="5px";var g=document.createElement("INPUT");g.type="TEXT";g.maxLength=16;g.placeholder="Username";b.appendChild(g);var e=document.createElement("DIV");e.style.marginBottom="5px";var n=document.createElement("INPUT");n.type="EMAIL";n.placeholder="Email";e.appendChild(n);var d=document.createElement("DIV");d.style.marginBottom="5px";var f=document.createElement("INPUT");f.type=
"PASSWORD";f.pattern=".{6,}";f.placeholder="Password";d.appendChild(f);var h=document.createElement("DIV");h.style.marginBottom="5px";var l=document.createElement("INPUT");l.type="PASSWORD";l.pattern=".{6,}";l.placeholder="Confirm password";h.appendChild(l);l.onblur=function(){f.value!=l.value&&l.setCustomValidity("Passwords are not the same.")};l.onfocus=function(){l.setCustomValidity("")};c.appendChild(b);c.appendChild(e);c.appendChild(d);c.appendChild(h);a.addElement(c);a.title="Register";a.addNegativeOption("Cancel").addEventListener("click",
function(){modal.close()},!1);a.addAffirmativeOption("Submit").addEventListener("click",function(){k(n.value,g.value,f.value,l.value);modal.close()},!1);a.show()}function k(a,c,b,e){$.ajax({type:"POST",url:"/Api/Account/Register",data:$.param({Email:a,UserName:c,Password:b,ConfirmPassword:e}),headers:{"Content-Type":"application/x-www-form-urlencoded"},success:function(a){console.log(a.responseText);Connection.restart();g()}})}function h(a,c,b){$.ajax({type:"POST",url:"/Api/Account/Login",data:$.param({UserName:a,
Password:c,RememberMe:b}),headers:{"Content-Type":"application/x-www-form-urlencoded"},success:function(a){console.log(a);Connection.restart();g()}})}function a(){$.ajax({type:"POST",url:"/Api/Account/LogOff",headers:{"Content-Type":"application/x-www-form-urlencoded"},success:function(a){console.log(a);Connection.restart();g();location.reload()}})}function g(){$.ajax({type:"POST",url:"/Api/Account/Info",headers:{"Content-Type":"application/x-www-form-urlencoded"},success:function(a){console.log(a);
a=JSON.parse(a);var b=a.Anonymous;n.textContent=b?"Guest":a.UserName;Utils.cssSwap(c,b?"registered":"anonymous",b?"anonymous":"registered")}})}var c,e,n,l;(function(){c=document.createElement("DIV");c.classList.add("account-manager");c.classList.add("closed");c.onmouseenter=function(){clearTimeout(l)};c.onmouseleave=function(){l=setTimeout(m,250)};var b=document.createElement("DIV");b.textContent="Sign in";b.classList.add("account-option");b.classList.add("anonymous-account-option");b.addEventListener("click",
function(){f()});c.appendChild(b);b=document.createElement("DIV");b.textContent="Register";b.classList.add("account-option");b.classList.add("anonymous-account-option");b.addEventListener("click",function(){d()});c.appendChild(b);b=document.createElement("DIV");b.textContent="Options";b.classList.add("account-option");b.classList.add("registered-account-option");c.appendChild(b);b=document.createElement("DIV");b.textContent="Sign out";b.classList.add("account-option");b.classList.add("registered-account-option");
b.addEventListener("click",function(){a()});c.appendChild(b);e=document.createElement("DIV");e.classList.add("account-user");n=document.createElement("SPAN");e.appendChild(n);c.appendChild(e);document.body.appendChild(c);e.addEventListener("click",function(){c.classList.contains("closed")?c.classList.remove("closed"):c.classList.add("closed")});g()})();b.info=g})(Account||(Account={}));var Tabs;
(function(b){function m(){if(h){var a=h.scrollHeight;a>window.innerHeight-b.bottomPadding&&(a=window.innerHeight-b.bottomPadding);d.style.minHeight=a+"px";d.style.maxHeight=a+"px";d.style.overflowY=a>=window.innerHeight-b.bottomPadding?"scroll":"hidden"}}var f=0,d=document.getElementById("paneContainer");b.bottomPadding=200;var k=[],h,a=new (function(){function a(c){this.container=c;this.tabs=[];this.lowestId=0;this.id=f++;k.push(this)}a.prototype.newTab=function(a){var c=new g;c.pane=a;a=document.createElement("DIV");
a.classList.add("tab-button");this.container.appendChild(a);c.button=a;0==this.lowestId?c.activate():c.deactivate();var d=this.lowestId++,f=this.id;a.addEventListener("click",function(){b.activateTab(f,d)});this.tabs.push(c);this.container.appendChild(a);return this.lowestId-1};a.prototype.activate=function(a){for(var c=0;c<this.tabs.length;c++)this.tabs[c].deactivate();this.tabs[a].activate()};a.prototype.css=function(a,c){this.tabs[a].button.classList.add(c)};return a}())(document.getElementById("tabContainer"));
b.registerGameTab=function(c,b){var g=a.newTab(c);b&&a.css(g,b)};b.updateGameTabs=m;Utils.addEvent(window,"resize",b.updateGameTabs);setInterval(m,20);b.activateTab=function(a,b){k[a].activate(b);m()};var g=function(){function a(){}a.prototype.deactivate=function(){Utils.cssSwap(this.button,"active","inactive");this.pane.style.display="none";this.pane.style.overflow="hidden"};a.prototype.activate=function(){Utils.cssSwap(this.button,"inactive","active");this.pane.style.display="block";this.pane.style.overflow=
"visible";h=this.pane};return a}()})(Tabs||(Tabs={}));var Chat;
(function(b){function m(){if(!d){d=document.createElement("DIV");d.style.position="fixed";d.style.bottom="0";d.style.left="0";d.style.minWidth="400px";d.style.width="40%";d.style.backgroundColor="#ebebeb";d.style.border="1px solid #adadad";d.style.height="280px";d.style.boxShadow="1px -1px 2px rgb(200,200,200)";var a=document.createElement("DIV");a.style.height="30px";a.style.backgroundColor="rgb(160, 160, 160)";d.appendChild(a);var b=document.createElement("DIV");b.style.color="white";b.style.fontSize=
"18px";b.style.height="30px";b.style.display="inline-block";b.textContent="General";b.style.padding="3px 10px";b.addEventListener("click",function(){document.getElementById("debugpane").style.display="none";document.getElementById("chatpane").style.display="block"});a.appendChild(b);b=document.createElement("DIV");b.style.color="white";b.id="debugtab";b.style.fontSize="18px";b.style.height="30px";b.style.display="inline-block";b.textContent=">Dev";b.style.padding="3px 10px";b.addEventListener("click",
function(){document.getElementById("debugpane").style.display="block";document.getElementById("chatpane").style.display="none"});b.style.display="none";a.appendChild(b);h=document.createElement("DIV");h.id="debugpane";h.style.width="100%";h.style.height="230px";h.style.display="none";h.style.position="relative";d.appendChild(h);k=document.createElement("DIV");k.id="chatpane";k.style.width="100%";k.style.height="230px";k.style.position="relative";d.appendChild(k);a=document.createElement("DIV");a.id=
"debuglog";a.style.position="absolute";a.style.bottom="0px";a.style.maxHeight="230px";a.style.width="100%";a.style.overflow="auto";h.appendChild(a);a=document.createElement("DIV");a.id="chatlog";a.style.position="absolute";a.style.bottom="0px";a.style.maxHeight="230px";a.style.width="100%";a.style.overflow="auto";k.appendChild(a);a=document.createElement("INPUT");a.setAttribute("TYPE","TEXT");a.style.width="100%";a.style.maxWidth="none";a.style.height="20px";a.style.border="none";a.style.borderTop=
"1px solid #adadad";a.style.width="85%";a.setAttribute("maxlength","220");a.addEventListener("keydown",function(a){13==a.keyCode&&f();68==a.keyCode&&a.altKey&&(document.getElementById("debugtab").style.display="inline-block")});a.id="chattext";d.appendChild(a);a=document.createElement("INPUT");a.setAttribute("TYPE","BUTTON");a.setAttribute("VALUE","SEND");a.style.height="20px";a.style.width="15%";a.style.fontSize="13px";a.style.border="none";a.style.borderTop="1px solid #adadad";a.style.borderLeft=
"1px solid #adadad";a.addEventListener("click",function(){f()});d.appendChild(a);document.body.appendChild(d)}}function f(){Connection.sendGlobalMessage(document.getElementById("chattext").value);document.getElementById("chattext").value=""}var d,k,h;b.initialize=m;m();b.log=function(a){var b=document.getElementById("debuglog"),c=document.createElement("DIV");c.textContent=a;b.appendChild(c)};b.receiveGlobalMessage=function(a,b,c,e){var d=document.getElementById("chatlog"),f=document.createElement("DIV");
f.classList.add("chat-msg");e&&""!=e&&f.classList.add("chat-"+e);e=document.createElement("SPAN");e.textContent="["+Utils.convertServerTimeToLocal(c)+"] ";c=document.createElement("SPAN");c.textContent=a;c.classList.add("chat-sender");a=document.createElement("SPAN");a.textContent=b;a.classList.add("chat-text");b=document.createElement("SPAN");b.textContent=": ";f.appendChild(e);f.appendChild(c);f.appendChild(b);f.appendChild(a);d.appendChild(f)}})(Chat||(Chat={}));var tooltip;
(function(b){function m(a,b){var e=c.getBoundingClientRect(),g=e.right-e.left,e=e.bottom-e.top;c.style.left=g+(a+15)>window.innerWidth?a-g-15+"px":a+15+"px";c.style.top=0<b-e?b-e+"px":b+5+"px"}function f(){c&&c.parentElement.removeChild(c);g=c=null}function d(b,c,e){var g=new q;k(b);e&&(g.header=e);g.content=c;a.push(g);b.dataset?b.dataset.tooltip=h:b.setAttribute("data-tooltip",h.toString());h++}function k(b){b.onmouseenter=function(b){var q=+b.target.getAttribute("data-tooltip");r!==b.target&&(e=
setInterval(function(){n+=.01;if(.25<=n){var b=l,d=s,p=a[q];g!==q&&f();g=q;c=p.html;document.body.appendChild(c);m(b,d);n=0;clearInterval(e);e=null}},10));r=b.target};b.onmousemove=function(a){a=a.pageX||a.pageY?{x:a.pageX,y:a.pageY}:a.clientX||a.clientY?{x:a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,y:a.clientY+document.body.scrollTop+document.documentElement.scrollTop}:void 0;e||m(a.x,a.y);l=a.x;s=a.y};b.onmouseleave=function(a){r=null;clearInterval(e);n=0;f()}}var h=
0,a=[],g,c,e,n=0,l,s,r,q=function(){function a(){this.html=document.createElement("div");this.html.classList.add("tooltip-wrapper")}Object.defineProperty(a.prototype,"header",{get:function(){return this.html.getElementsByClassName("tooltip-header")[0]},set:function(a){a.classList.add("tooltip-header");this.html.appendChild(a)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"content",{get:function(){return this.html.getElementsByClassName("tooltip-content")[0]},set:function(a){a.classList.add("tooltip-content");
this.html.appendChild(a)},enumerable:!0,configurable:!0});return a}();b.complexModify=function(b,c,e){b=a[b];e&&(b.header.parentElement.removeChild(b.header),b.header=e);b.content.parentElement.removeChild(b.content);b.content=c};b.modify=function(b,c,e){b=a[b];e&&(b.header.textContent=e);b.content.textContent=c};b.retrieveContent=function(b){return a[b].content};b.complexCreate=d;b.create=function(a,b,c){var e=document.createElement("div");e.textContent=b;c?(b=document.createElement("div"),b.textContent=
c,d(a,e,b)):d(a,e)}})(tooltip||(tooltip={}));var Inventory;
(function(b){function m(a){Connection.sellItem(e.id,a?a:1)}function f(){var a=document.getElementById("selecteditemquantity"),c=+a.value;Utils.isNumber(c)&&c>b.getSelectedItemQuantity()&&(a.value=b.getSelectedItemQuantity().toString())}function d(){h=document.createElement("DIV");document.getElementById("paneContainer").appendChild(h);g=document.createElement("DIV");g.classList.add("selected-item");g.style.display="none";var e=document.createElement("SPAN");e.textContent="x";e.style.top="0px";e.style.right=
"3px";e.style.position="absolute";e.addEventListener("click",function(){b.selectItem()});g.appendChild(e);c=document.createElement("DIV");c.classList.add("selected-item-image");e=document.createElement("INPUT");e.id="selecteditemquantity";e.type="text";e.style.height="18px";e.classList.add("selected-item-quantity");e.addEventListener("input",function(){f()});var d=Utils.createButton("Sell","");d.classList.add("selected-item-quantity");d.addEventListener("click",function(){var a=+document.getElementById("selecteditemquantity").value;
Utils.isNumber(a)&&b.sellSelectedItem(a);f()});var p=Utils.createButton("Sell all","");p.classList.add("selected-item-quantity");p.addEventListener("click",function(){b.sellAllSelectedItem();f()});g.appendChild(c);g.appendChild(p);g.appendChild(d);g.appendChild(e);h.appendChild(g);e=document.createElement("DIV");e.style.textAlign="center";d=document.createElement("DIV");d.style.display="inline-block";p=Utils.createButton("Sell (...)","");p.addEventListener("click",function(){Connection.sellAllItems()});
var k=Utils.createButton("...","");k.addEventListener("click",function(){console.log("why..");b.toggleConfig()});d.appendChild(p);d.appendChild(k);e.appendChild(d);h.appendChild(e);l=document.createElement("DIV");l.classList.add("config-container");l.classList.add("closed");e=document.createElement("TABLE");e.classList.add("config-table");l.appendChild(e);p=e.createTHead();d=p.insertRow(0);p=p.insertRow(0);p.classList.add("table-header");p=p.insertCell(0);p.textContent="Inventory Configuration";p.setAttribute("colspan",
"10");d.classList.add("table-subheader");for(var m in r)0<=parseInt(m,10)&&"NFS"!=r[m]&&(d.insertCell(d.cells.length).classList.add("config-cell-check"),p=d.insertCell(d.cells.length),p.classList.add("config-cell-name"),p.textContent=r[m]);n=e.createTBody();a=document.createElement("DIV");a.style.position="relative";a.appendChild(l);h.appendChild(a);Tabs.registerGameTab(h,"Inventory")}function k(a){var c=document.createElement("DIV");a.container=c;c.classList.add("item");c.addEventListener("click",
function(){b.selectItem(a.id)});tooltip.create(c,a.name);var e=document.createElement("DIV");e.classList.add("item-text");var d=document.createElement("DIV");d.style.verticalAlign="top";d.style.display="inline-block";d.textContent=Utils.formatNumber(a.worth);a.worthElm=d;var g=document.createElement("DIV");g.classList.add("Third-Coins");g.style.display="inline-block";e.appendChild(g);e.appendChild(d);c.appendChild(e);d=document.createElement("DIV");d.style.width="64px";d.style.height="64px";d.style.position=
"relative";d.style.margin="0 auto";e=document.createElement("DIV");e.classList.add(a.name.replace(" ","_"));d.appendChild(e);c.appendChild(d);e=document.createElement("DIV");a.quantityElm=e;e.classList.add("item-text");e.textContent=Utils.formatNumber(0);c.appendChild(e);if(null!=a.category){var f,h,e=n.rows.length,g=a.category,g=2*g;g--;for(d=0;d<e;d++){var k=n.rows[d].cells[g];if(k&&0==k.childElementCount){f=n.rows[d].cells[g];h=n.rows[d].cells[g-1];break}}if(!f){h=n.insertRow(n.rows.length);h.classList.add("table-row");
for(var l in r)0<=parseInt(l,10)&&"NFS"!=r[l]&&(h.insertCell(h.cells.length).classList.add("config-cell-check"),h.insertCell(h.cells.length).classList.add("config-cell-name"));f=h.cells[g];h=h.cells[g-1]}for(l=0;l<e;l++)for(g=n.rows[d].cells.length,k=0;k<g;k++);l=document.createElement("DIV");l.classList.add("item-text");d=document.createElement("SPAN");d.style.verticalAlign="top";e=document.createElement("DIV");e.classList.add("Third-"+Utils.cssifyName(a.name));e.style.display="inline-block";d.textContent=
a.name;l.appendChild(e);l.appendChild(d);f.appendChild(l);f=document.createElement("INPUT");f.type="CHECKBOX";h.appendChild(f)}return c}b.items=[];var h,a,g,c,e,n,l,s=function(){return function(a,b,c,e){this.id=a;this.name=b;this.worth=c;this.category=e}}();b.Item=s;(function(a){a[a.NFS=0]="NFS";a[a.ORE=1]="ORE";a[a.GEM=2]="GEM";a[a.INGREDIENT=3]="INGREDIENT";a[a.CRAFTING=4]="CRAFTING";a[a.POTION=5]="POTION"})(b.Category||(b.Category={}));var r=b.Category;b.getSelectedItemQuantity=function(){return e?
e.quantity:0};b.selectItem=function(a){a?(null!=e&&c.classList.remove(Utils.cssifyName(e.name)),e=b.items[a],c.classList.add(Utils.cssifyName(e.name)),f()):(c.classList.remove(Utils.cssifyName(e.name)),e=null);g.style.display=null==e?"none":"block"};b.sellSelectedItem=m;b.sellAllSelectedItem=function(){m(e.quantity)};b.toggleConfig=function(){l.classList.contains("closed")?l.classList.remove("closed"):l.classList.add("closed")};b.addItem=function(c,e,g,f){b.items[c]||(c=new s(c,e,g,f),b.items[c.id]=
c,h||d(),a.appendChild(k(c)))};b.changeQuantity=function(a,c){b.items[a].quantityElm.textContent=Utils.formatNumber(c);b.items[a].quantity=c;b.items[a].container.style.display=0==c?"none":"inline-block";f()}})(Inventory||(Inventory={}));var Connection;
(function(b){function m(){console.log("Connection opened");k=setInterval(function(){var a=h.encode64();f(a);h=new Komodo.ClientActions},1E3)}function f(a){if(a.encode64){var b=a.encode64();Chat.log("Sent "+d(b)+" bytes to komodo.");Chat.log("Decoded: ");Chat.log(JSON.stringify(a));Chat.log("Encoded: ");Chat.log(a.encode64());Komodo.send(a.encode64())}else Chat.log("Sent "+d(a)+" bytes to komodo."),Komodo.send(a)}function d(a){var b=[];a=[a];for(var c=0;a.length;){var e=a.pop();if("boolean"===typeof e)c+=
4;else if("string"===typeof e)c+=2*e.length;else if("number"===typeof e)c+=8;else if("object"===typeof e&&-1===b.indexOf(e)){b.push(e);for(var d in e)a.push(e[d])}}return c}var k;Komodo.connection.received(function(a){Chat.log("Recieved "+d(a)+" bytes from komodo.");Chat.log("Encoded: ");Chat.log(a);Chat.log("Decoded: ");Chat.log(JSON.stringify(Komodo.decode(a)));Chat.log(d(JSON.stringify(Komodo.decode(a)))-d(a)+" bytes saved.");a=Komodo.decode(a);null!=a.Message&&Chat.receiveGlobalMessage(a.Message.Sender,
a.Message.Text,a.Message.Time,a.Message.Permissions);if(null!=a.GameSchema){for(var b=a.GameSchema,c=0;c<b.Items.length;c++)Inventory.addItem(b.Items[c].Id,b.Items[c].Name,b.Items[c].Worth,b.Items[c].Category),Statistics.addItem(b.Items[c].Id,b.Items[c].Name);for(c=0;c<b.StoreItems.length;c++){var e=b.StoreItems[c];Store.addItem(e.Id,e.Category,e.Price,e.Factor,e.Name,e.MaxQuantity)}}if(null!=a.Items)for(b=a.Items,c=0;c<b.length;c++)Inventory.changeQuantity(b[c].Id,b[c].Quantity);if(null!=a.StoreItemsUpdate)for(b=
a.StoreItemsUpdate,c=0;c<b.length;c++)Store.changeQuantity(b[c].Id,b[c].Quantity);if(null!=a.StatItemsUpdate)for(a=a.StatItemsUpdate,b=0;b<a.length;b++)Statistics.changeStats(a[b].Id,a[b].PrestigeQuantity,a[b].LifeTimeQuantity)});b.restart=function(){Komodo.restart()};var h=new Komodo.ClientActions;Komodo.connection.stateChanged(function(a){a.newState===$.signalR.connectionState.connected&&m();a.newState===$.signalR.connectionState.disconnected&&clearInterval(k)});b.sellItem=function(a,b){var c=new Komodo.ClientActions.InventoryAction,
e=new Komodo.ClientActions.InventoryAction.SellAction;e.Id=a;e.Quantity=b;c.Sell=e;h.InventoryActions.push(c)};b.purchaseItem=function(a,b){var c=new Komodo.ClientActions.StoreAction,e=new Komodo.ClientActions.StoreAction.PurchaseAction;e.Id=a;e.Quantity=b?b:1;c.Purchase=e;h.StoreActions.push(c)};b.sellAllItems=function(){var a=new Komodo.ClientActions.InventoryAction;a.SellAll=!0;h.InventoryActions.push(a)};b.sendGlobalMessage=function(a){var b=new Komodo.ClientActions.SocialAction,c=new Komodo.ClientActions.SocialAction.ChatAction;
c.GlobalMessage=a;b.Chat=c;h.SocialActions.push(b)};b.send=f})(Connection||(Connection={}));var Store;
(function(b){function m(){d=document.createElement("div");document.getElementById("paneContainer").appendChild(d);Tabs.registerGameTab(d,"Store");for(var b in a)if(0<=parseInt(b,10)){var e=a[b];if("CRAFTING"!=e){var f=document.createElement("div");f.classList.add("store-category");h[e]=f;var g=document.createElement("div");g.textContent=e;g.classList.add("store-category-header");f.appendChild(g);d.appendChild(f)}}}function f(a){var b=document.createElement("div");b.classList.add("store-item");a.container=
b;var d=document.createElement("div");d.classList.add("store-item-header");d.textContent=1>=a.maxQuantity?a.name:a.name+" ("+a.quantity+"/"+a.maxQuantity+")";a.nameElm=d;b.appendChild(d);d=document.createElement("DIV");d.style.width="64px";d.style.height="64px";d.style.position="relative";d.style.margin="0 auto";var f=document.createElement("DIV");f.classList.add(Utils.cssifyName(a.name));d.appendChild(f);b.appendChild(d);d=document.createElement("div");d.classList.add("store-item-footer");f=document.createElement("div");
f.classList.add("item-text");var g=document.createElement("div");g.textContent=Utils.formatNumber(a.price);g.style.display="inline-block";g.style.verticalAlign="top";a.priceElm=g;var h=document.createElement("div");h.classList.add("Third-Coins");h.style.display="inline-block";f.appendChild(h);f.appendChild(g);var g=document.createElement("div"),h=Utils.createButton("Buy",""),k=a.id;if(5!=a.category)h.addEventListener("click",function(){Connection.purchaseItem(k)});else{var m=document.createElement("INPUT");
m.type="TEXT";m.style.width="40px";m.style.height="15px";g.appendChild(m);h.addEventListener("click",function(){Utils.isNumber(m.value)&&Connection.purchaseItem(k,+m.value)})}g.appendChild(h);d.appendChild(g);d.appendChild(f);b.appendChild(d);return b}var d,k=[],h=[];(function(a){a[a.MINING=1]="MINING";a[a.MACHINES=2]="MACHINES";a[a.GATHERING=3]="GATHERING";a[a.PROCESSING=4]="PROCESSING";a[a.ITEMS=5]="ITEMS";a[a.CRAFTING=6]="CRAFTING"})(b.Category||(b.Category={}));var a=b.Category,g=function(){return function(){}}();
b.tempFix=function(){m()};b.addItem=function(b,e,n,l,s,r){d||m();if(!k[b]){var q=new g;q.id=b;q.category=e;q.price=n;q.factor=l;q.name=s;q.maxQuantity=r?r:0;e=h[a[e]];null==e&&(e=h.MINING);e.appendChild(f(q));k[b]=q}};b.changeQuantity=function(a,b){var d=k[a];d.quantity=b;d.container.style.display=-1==d.quantity||d.quantity>=d.maxQuantity&&0<d.maxQuantity?"none":"inline-block";d.maxQuantity&&1<d.maxQuantity&&(d.nameElm.textContent=d.name+" ("+(d.quantity?d.quantity:0)+"/"+d.maxQuantity+")")}})(Store||
(Store={}));var Statistics;
(function(b){function m(){var a=document.createElement("TABLE"),b=a.createTHead(),c=b.insertRow(0);c.classList.add("table-header");c=c.insertCell(0);c.textContent="Item Statistics";c.setAttribute("colspan","3");b=b.insertRow(1);b.classList.add("table-subheader");c=b.insertCell(0);c.textContent="Lifetime Quantity";c.style.width="40%";c=b.insertCell(0);c.textContent="Prestige Quantity";c.style.width="40%";b=b.insertCell(0);b.textContent="Item";b.style.width="20%";d=a.createTBody();return a}var f,d,
k=[],h=function(){return function(){}}();b.changeStats=function(a,b,c){a=k[a];a.prestigeRow.textContent=b?Utils.formatNumber(b):"0";a.alltimeRow.textContent=c?Utils.formatNumber(c):"0"};b.addItem=function(a,b){f||(f=document.createElement("DIV"),document.getElementById("paneContainer").appendChild(f),Tabs.registerGameTab(f,"Statistics"),f.appendChild(m()));if(!k[a]){var c=new h;k[a]=c;var e=d.insertRow(d.rows.length);e.classList.add("table-row");c.alltimeRow=e.insertCell(0);c.alltimeRow.style.width=
"40%";c.prestigeRow=e.insertCell(0);c.prestigeRow.style.width="40%";c=e.insertCell(0);c.style.width="20%";e=document.createElement("DIV");e.classList.add("Third-"+Utils.cssifyName(b));e.style.display="inline-block";c.appendChild(e)}}})(Statistics||(Statistics={}));
