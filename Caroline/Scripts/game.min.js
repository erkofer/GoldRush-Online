var Utils;
(function(b){b.cssSwap=function(b,g,d){b.classList.contains(g)&&b.classList.remove(g);b.classList.add(d)};b.cssifyName=function(b){return b.split(" ").join("_")};b.isNumber=function(b){return!isNaN(parseFloat(b))};b.formatNumber=function(b){return b?999999999999999<b?(b/1E15).toFixed(3)+"Qa":999999999999<b?(b/1E12).toFixed(3)+"T":999999999<b?(b/1E9).toFixed(3)+"B":999999<b?(b/1E6).toFixed(3)+"M":b.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","):"0"};b.convertServerTimeToLocal=function(b){var g=+b.split(":")[0],
d=+b.split(":")[1].split(" ")[0];"PM"==b.split(":")[1].split(" ")[1]&&(g+=12);b=(new Date).getTimezoneOffset();g-=b/60-b%60;d-=b%60;0>g&&(g=24-g);0>d&&(d=60-d,g--);23<g&&(g-=24);59<d&&(d-=60,g++);return(10>g?"0":"")+g+":"+(10>d?"0":"")+d}})(Utils||(Utils={}));var Tabs;
(function(b){var m=0,g=[],d=new (function(){function f(a){this.container=a;this.tabs=[];this.lowestId=0;this.id=m++;g.push(this)}f.prototype.newTab=function(a){var c=new e;c.pane=a;a=document.createElement("DIV");a.classList.add("tab-button");this.container.appendChild(a);c.button=a;0==this.lowestId?c.button.classList.add("active"):(c.button.classList.add("inactive"),c.pane.style.display="none");var f=this.lowestId++,d=this.id;a.addEventListener("click",function(){b.activateTab(d,f)});this.tabs.push(c);
this.container.appendChild(a);return this.lowestId-1};f.prototype.activate=function(a){for(var c=0;c<this.tabs.length;c++)this.tabs[c].deactivate();this.tabs[a].activate()};f.prototype.css=function(a,c){this.tabs[a].button.classList.add(c)};return f}())(document.getElementById("tabContainer"));b.registerGameTab=function(b,a){var c=d.newTab(b);a&&d.css(c,a)};b.activateTab=function(b,a){g[b].activate(a)};var e=function(){function b(){}b.prototype.deactivate=function(){Utils.cssSwap(this.button,"active",
"inactive");this.pane.style.display="none"};b.prototype.activate=function(){Utils.cssSwap(this.button,"inactive","active");this.pane.style.display="block"};return b}()})(Tabs||(Tabs={}));var Chat;
(function(b){function m(){if(!d){d=document.createElement("DIV");d.style.position="fixed";d.style.bottom="0";d.style.left="0";d.style.minWidth="400px";d.style.width="40%";d.style.backgroundColor="#ebebeb";d.style.border="1px solid #adadad";d.style.height="280px";d.style.boxShadow="1px -1px 2px rgb(200,200,200)";var a=document.createElement("DIV");a.style.height="30px";a.style.backgroundColor="rgb(160, 160, 160)";d.appendChild(a);var c=document.createElement("DIV");c.style.color="white";c.style.fontSize=
"18px";c.style.height="30px";c.style.display="inline-block";c.textContent="General";c.style.padding="3px 10px";c.addEventListener("click",function(){document.getElementById("debugpane").style.display="none";document.getElementById("chatpane").style.display="block"});a.appendChild(c);c=document.createElement("DIV");c.style.color="white";c.id="debugtab";c.style.fontSize="18px";c.style.height="30px";c.style.display="inline-block";c.textContent=">Dev";c.style.padding="3px 10px";c.addEventListener("click",
function(){document.getElementById("debugpane").style.display="block";document.getElementById("chatpane").style.display="none"});c.style.display="none";a.appendChild(c);f=document.createElement("DIV");f.id="debugpane";f.style.width="100%";f.style.height="230px";f.style.display="none";f.style.position="relative";d.appendChild(f);e=document.createElement("DIV");e.id="chatpane";e.style.width="100%";e.style.height="230px";e.style.position="relative";d.appendChild(e);a=document.createElement("DIV");a.id=
"debuglog";a.style.position="absolute";a.style.bottom="0px";a.style.maxHeight="230px";a.style.width="100%";a.style.overflow="auto";f.appendChild(a);a=document.createElement("DIV");a.id="chatlog";a.style.position="absolute";a.style.bottom="0px";a.style.maxHeight="230px";a.style.width="100%";a.style.overflow="auto";e.appendChild(a);a=document.createElement("INPUT");a.setAttribute("TYPE","TEXT");a.style.width="100%";a.style.maxWidth="none";a.style.height="20px";a.style.border="none";a.style.borderTop=
"1px solid #adadad";a.style.width="85%";a.setAttribute("maxlength","220");a.addEventListener("keydown",function(a){13==a.keyCode&&g();68==a.keyCode&&a.altKey&&(document.getElementById("debugtab").style.display="inline-block")});a.id="chattext";d.appendChild(a);a=document.createElement("INPUT");a.setAttribute("TYPE","BUTTON");a.setAttribute("VALUE","SEND");a.style.height="20px";a.style.width="15%";a.style.fontSize="13px";a.style.border="none";a.style.borderTop="1px solid #adadad";a.style.borderLeft=
"1px solid #adadad";a.addEventListener("click",function(){g()});d.appendChild(a);document.body.appendChild(d)}}function g(){Connection.sendGlobalMessage(document.getElementById("chattext").value);document.getElementById("chattext").value=""}var d,e,f;b.initialize=m;m();b.log=function(a){var c=document.getElementById("debuglog"),b=document.createElement("DIV");b.textContent=a;c.appendChild(b)};b.receiveGlobalMessage=function(a,c,b,e){var d=document.getElementById("chatlog"),h=document.createElement("DIV");
h.classList.add("chat-msg");e&&""!=e&&h.classList.add("chat-"+e);e=document.createElement("SPAN");e.textContent="["+Utils.convertServerTimeToLocal(b)+"] ";b=document.createElement("SPAN");b.textContent=a;b.classList.add("chat-sender");a=document.createElement("SPAN");a.textContent=c;a.classList.add("chat-text");c=document.createElement("SPAN");c.textContent=": ";h.appendChild(e);h.appendChild(b);h.appendChild(c);h.appendChild(a);d.appendChild(h)}})(Chat||(Chat={}));var tooltip;
(function(b){function m(a,b){var c=k.getBoundingClientRect(),e=c.right-c.left,c=c.bottom-c.top;k.style.left=e+(a+15)>window.innerWidth?a-e-15+"px":a+15+"px";k.style.top=0<b-c?b-c+"px":b+5+"px"}function g(){k&&k.parentElement.removeChild(k);c=k=null}function d(c,b,d){var h=new r;e(c);d&&(h.header=d);h.content=b;a.push(h);c.dataset?c.dataset.tooltip=f:c.setAttribute("data-tooltip",f.toString());f++}function e(b){b.onmouseenter=function(b){var e=+b.target.getAttribute("data-tooltip");p!==b.target&&(l=
setInterval(function(){n+=.01;if(.25<=n){var b=h,d=q,f=a[e];c!==e&&g();c=e;k=f.html;document.body.appendChild(k);m(b,d);n=0;clearInterval(l);l=null}},10));p=b.target};b.onmousemove=function(a){a=a.pageX||a.pageY?{x:a.pageX,y:a.pageY}:a.clientX||a.clientY?{x:a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,y:a.clientY+document.body.scrollTop+document.documentElement.scrollTop}:void 0;l||m(a.x,a.y);h=a.x;q=a.y};b.onmouseleave=function(a){p=null;clearInterval(l);n=0;g()}}var f=
0,a=[],c,k,l,n=0,h,q,p,r=function(){function a(){this.html=document.createElement("div");this.html.classList.add("tooltip-wrapper")}Object.defineProperty(a.prototype,"header",{get:function(){return this.html.getElementsByClassName("tooltip-header")[0]},set:function(a){a.classList.add("tooltip-header");this.html.appendChild(a)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"content",{get:function(){return this.html.getElementsByClassName("tooltip-content")[0]},set:function(a){a.classList.add("tooltip-content");
this.html.appendChild(a)},enumerable:!0,configurable:!0});return a}();b.complexModify=function(b,c,e){b=a[b];e&&(b.header.parentElement.removeChild(b.header),b.header=e);b.content.parentElement.removeChild(b.content);b.content=c};b.modify=function(b,c,e){b=a[b];e&&(b.header.textContent=e);b.content.textContent=c};b.retrieveContent=function(b){return a[b].content};b.complexCreate=d;b.create=function(a,b,c){var e=document.createElement("div");e.textContent=b;c?(b=document.createElement("div"),b.textContent=
c,d(a,e,b)):d(a,e)}})(tooltip||(tooltip={}));var Inventory;
(function(b){function m(a){Connection.sellItem(l.id,a?a:1)}function g(){var a=document.getElementById("selecteditemquantity"),c=+a.value;Utils.isNumber(c)&&c>b.getSelectedItemQuantity()&&(a.value=b.getSelectedItemQuantity().toString())}function d(){a=document.createElement("DIV");document.getElementById("paneContainer").appendChild(a);c=document.createElement("DIV");c.classList.add("selected-item");k=document.createElement("DIV");k.classList.add("selected-item-image");var e=document.createElement("INPUT");
e.id="selecteditemquantity";e.type="text";e.classList.add("selected-item-quantity");e.addEventListener("input",function(){g()});var d=document.createElement("INPUT");d.type="button";d.classList.add("selected-item-quantity");d.value="Sell";d.addEventListener("click",function(){var a=+document.getElementById("selecteditemquantity").value;Utils.isNumber(a)&&b.sellSelectedItem(a);g()});var f=document.createElement("INPUT");f.type="button";f.classList.add("selected-item-quantity");f.value="Sell all";f.addEventListener("click",
function(){b.sellAllSelectedItem();g()});c.appendChild(k);c.appendChild(f);c.appendChild(d);c.appendChild(e);a.appendChild(c);Tabs.registerGameTab(a,"Inventory")}function e(a){var c=document.createElement("DIV");a.container=c;c.classList.add("item");c.addEventListener("click",function(){b.selectItem(a.id)});tooltip.create(c,a.name);var e=document.createElement("DIV");e.classList.add("item-text");var d=document.createElement("DIV");d.style.verticalAlign="top";d.style.display="inline-block";d.textContent=
Utils.formatNumber(a.worth);a.worthElm=d;var f=document.createElement("DIV");f.classList.add("Third-Coins");f.style.display="inline-block";e.appendChild(f);e.appendChild(d);c.appendChild(e);e=document.createElement("DIV");e.style.width="64px";e.style.height="64px";e.style.position="relative";e.style.margin="0 auto";d=document.createElement("DIV");d.classList.add(a.name.replace(" ","_"));e.appendChild(d);c.appendChild(e);e=document.createElement("DIV");a.quantityElm=e;e.classList.add("item-text");
e.textContent=Utils.formatNumber(0);c.appendChild(e);return c}var f=[],a,c,k,l,n=function(){return function(a,b,c){this.id=a;this.name=b;this.worth=c}}();b.getSelectedItemQuantity=function(){return l?l.quantity:0};b.selectItem=function(a){a?(null!=l&&k.classList.remove(Utils.cssifyName(l.name)),l=f[a],k.classList.add(Utils.cssifyName(l.name)),c.style.display="block",g()):(k.classList.remove(Utils.cssifyName(l.name)),l=null,c.style.display="none")};b.sellSelectedItem=m;b.sellAllSelectedItem=function(){m(l.quantity)};
b.addItem=function(b,c,g){f[b]||(b=new n(b,c,g),f[b.id]=b,a||d(),a.appendChild(e(b)))};b.changeQuantity=function(a,b){f[a].quantityElm.textContent=Utils.formatNumber(b);f[a].quantity=b;f[a].container.style.display=0==b?"none":"inline-block";g()}})(Inventory||(Inventory={}));var Connection;
(function(b){function m(b){if(b.encode64){var d=b.encode64();Chat.log("Sent "+g(d)+" bytes to komodo.");Chat.log("Decoded: ");Chat.log(JSON.stringify(b));Chat.log("Encoded: ");Chat.log(b.encode64());Komodo.send(b.encode64())}else Chat.log("Sent "+g(b)+" bytes to komodo."),Komodo.send(b)}function g(b){var d=[];b=[b];for(var a=0;b.length;){var c=b.pop();if("boolean"===typeof c)a+=4;else if("string"===typeof c)a+=2*c.length;else if("number"===typeof c)a+=8;else if("object"===typeof c&&-1===d.indexOf(c)){d.push(c);
for(var g in c)b.push(c[g])}}return a}Komodo.connection.received(function(b){Chat.log("Recieved "+g(b)+" bytes from komodo.");Chat.log("Encoded: ");Chat.log(b);Chat.log("Decoded: ");Chat.log(JSON.stringify(Komodo.decode(b)));Chat.log(g(JSON.stringify(Komodo.decode(b)))-g(b)+" bytes saved.");b=Komodo.decode(b);null!=b.Message&&Chat.receiveGlobalMessage(b.Message.Sender,b.Message.Text,b.Message.Time,b.Message.Permissions);if(null!=b.GameSchema){for(var d=b.GameSchema,a=0;a<d.Items.length;a++)Inventory.addItem(d.Items[a].Id,
d.Items[a].Name,d.Items[a].Worth);for(a=0;a<d.StoreItems.length;a++){var c=d.StoreItems[a];console.log(c);Store.addItem(c.Id,c.Category,c.BasePrice,c.Factor,c.Name)}}if(null!=b.Items)for(b=b.Items,d=0;d<b.length;d++)Inventory.changeQuantity(b[d].Id,b[d].Quantity)});var d=new Komodo.ClientActions;setInterval(function(){var b=d.encode64();""!=b&&m(b);d=new Komodo.ClientActions},1E3);b.sellItem=function(b,f){var a=new Komodo.ClientActions.InventoryAction,c=new Komodo.ClientActions.InventoryAction.SellAction;
c.Id=b;c.Quantity=f;a.Sell=c;d.InventoryActions.push(a)};b.sellAllItems=function(){};b.sendGlobalMessage=function(b){var f=new Komodo.ClientActions.SocialAction,a=new Komodo.ClientActions.SocialAction.ChatAction;a.GlobalMessage=b;f.Chat=a;d.SocialActions.push(f)};b.send=m})(Connection||(Connection={}));var Store;
(function(b){function m(){d=document.createElement("div");document.getElementById("paneContainer").appendChild(d);Tabs.registerGameTab(d,"Store");for(var a in e)if(0<=parseInt(a,10)){var c=e[a];if("CRAFTING"!=c){var f=document.createElement("div");f.classList.add("store-category");b.categories[c]=f;var g=document.createElement("div");g.textContent=c;g.classList.add("store-category-header");f.appendChild(g);d.appendChild(f)}}}function g(a){var b=document.createElement("div");b.classList.add("store-item");
var d=document.createElement("div");d.classList.add("store-item-header");d.textContent=a.name;b.appendChild(d);d=document.createElement("DIV");d.style.width="64px";d.style.height="64px";d.style.position="relative";d.style.margin="0 auto";var e=document.createElement("DIV");e.classList.add(Utils.cssifyName(a.name));d.appendChild(e);b.appendChild(d);d=document.createElement("div");d.classList.add("store-item-footer");d.textContent=Utils.formatNumber(a.price);b.appendChild(d);return b}var d;b.categories=
[];(function(a){a[a.MINING=1]="MINING";a[a.MACHINES=2]="MACHINES";a[a.GATHERING=3]="GATHERING";a[a.PROCESSING=4]="PROCESSING";a[a.ITEMS=5]="ITEMS";a[a.CRAFTING=6]="CRAFTING"})(b.Category||(b.Category={}));var e=b.Category,f=function(){return function(){}}();b.tempFix=function(){m()};b.addItem=function(a,c,k,l,n){d||m();var h=new f;h.id=a;h.category=c;h.price=k;h.factor=l;h.name=n;b.categories[e[c]].appendChild(g(h))}})(Store||(Store={}));
