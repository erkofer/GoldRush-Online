var Utils;
(function(a){a.addEvent=function(a,e,f){null!=a&&"undefined"!=typeof a&&(a.addEventListener?a.addEventListener(e,f,!1):a.attachEvent?a.attachEvent("on"+e,f):a["on"+e]=f)};a.cssSwap=function(a,e,f){a.classList.contains(e)&&a.classList.remove(e);a.classList.add(f)};a.cssifyName=function(a){return a.split(" ").join("_")};a.ifNotDefault=function(a,e){-100!=a&&e()};a.createButton=function(a,e){var f,n;f=document.createElement("div");n=document.createElement("div");n.textContent=a;e&&(n.id=e);f.classList.add("button");
f.appendChild(n);return f};a.isNumber=function(a){return!isNaN(parseFloat(a))};a.formatNumber=function(a,e){"undefined"===typeof e&&(e=!1);return a?e?a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","):999999999999999<a?(a/1E15).toFixed(3)+"Qa":999999999999<a?(a/1E12).toFixed(3)+"T":999999999<a?(a/1E9).toFixed(3)+"B":999999<a?(a/1E6).toFixed(3)+"M":a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","):"0"};a.getRandomInt=function(a,e){return Math.floor(Math.random()*(e-a+1))+a};a.formatTime=function(a){var e=
Math.floor(a/3600),f=Math.floor(a%3600/60);a=Math.floor(a%60);return(10>e?1>e?"":"0"+e+":":e+":")+(10>f?"0"+f+":":f+":")+(10>a?"0"+a:a+"")};a.convertServerTimeToLocal=function(a){var e=+a.split(":")[0],f=+a.split(":")[1].split(" ")[0];"PM"==a.split(":")[1].split(" ")[1]&&(e+=12);a=(new Date).getTimezoneOffset();e-=a/60-a%60;f-=a%60;0>e&&(e=24-e);0>f&&(f=60-f,e--);23<e&&(e-=24);59<f&&(f-=60,e++);return(10>e?"0":"")+e+":"+(10>f?"0":"")+f}})(Utils||(Utils={}));var modal;
(function(a){function p(){a.activeWindow&&a.activeWindow.hide();a.activeWindow=null}function e(){if(a.activeWindow){var k=a.activeWindow.container.getBoundingClientRect();a.activeWindow.container.style.left=window.innerWidth/2-(k.right-k.left)/2+"px";a.activeWindow.container.style.top=window.innerHeight/2-(k.bottom-k.top)/2+"px"}else clearInterval(a.intervalIdentifier)}var f=0,n;a.activeWindow;a.intervalIdentifier;a.hide=p;a.close=function(){if(a.activeWindow){var k=a.activeWindow;p();k.container.parentNode.removeChild(k.container)}};
var l=function(){function k(){this.container=document.createElement("div");this.container.addEventListener("click",function(a){a.stopPropagation()},!1);this.container.classList.add("modal-window");if(!n){var k=document.createElement("div");n=k;k.classList.add("modal-wrapper");k.addEventListener("click",function(b){b.stopPropagation();3E3<Date.now()-f&&a.close()},!1);document.body.appendChild(k)}n.appendChild(this.container);this.titleEl=document.createElement("div");this.titleEl.classList.add("modal-header");
this.bodyEl=document.createElement("div");this.container.appendChild(this.titleEl);this.container.appendChild(this.bodyEl)}Object.defineProperty(k.prototype,"title",{get:function(){return this._title},set:function(a){this._title=a;this.titleEl.textContent=this._title},enumerable:!0,configurable:!0});k.prototype.addElement=function(a){this.bodyEl.appendChild(a)};k.prototype.addOption=function(a){this.options||(this.options=document.createElement("div"),this.options.classList.add("modal-options"),this.container.appendChild(this.options));
var b=document.createElement("span");b.classList.add("modal-option");var c=document.createElement("span");c.textContent=a;b.appendChild(c);this.options.appendChild(b);return b};k.prototype.addAffirmativeOption=function(a){a=this.addOption(a);a.classList.add("affirmative");return a};k.prototype.addNegativeOption=function(a){a=this.addOption(a);a.classList.add("negative");return a};k.prototype.show=function(){this.container.classList.contains("opened")||this.container.classList.add("opened");n.classList.contains("opened")||
n.classList.add("opened");a.activeWindow=this;e();a.intervalIdentifier=setInterval(e,100);f=Date.now()};k.prototype.hide=function(){this.container.classList.contains("opened")&&this.container.classList.remove("opened");n.classList.contains("opened")&&n.classList.remove("opened")};return k}();a.Window=l})(modal||(modal={}));var Objects;
(function(a){var p=[],e=function(){return function(){this.quantity=0}}();a.register=function(a,n){if(!p[a]){var l=new e;l.name=n;p[a]=l}};a.lookupName=function(a){return p[a].name};a.setQuantity=function(a,e){p[a].quantity=e};a.getQuantity=function(a){return p[a].quantity};a.setLifeTimeTotal=function(a,e){p[a].lifeTimeTotal=e};a.getLifeTimeTotal=function(a){return p[a].lifeTimeTotal}})(Objects||(Objects={}));var Account;
(function(a){function p(){b.classList.contains("closed")||b.classList.add("closed")}function e(){var a=new modal.Window,c=document.createElement("DIV");c.style.width="400px";var b=document.createElement("DIV");b.style.marginBottom="5px";var q=document.createElement("INPUT");q.type="TEXT";q.maxLength=16;q.placeholder="Username";b.appendChild(q);var h=document.createElement("DIV");h.style.marginBottom="5px";var g=document.createElement("INPUT");g.type="PASSWORD";g.pattern=".{6,}";g.placeholder="Password";
h.appendChild(g);var k=document.createElement("DIV");k.style.marginBottom="5px";var e=document.createElement("INPUT");e.type="CHECKBOX";e.placeholder="Stay logged in on this computer?";k.appendChild(e);c.appendChild(b);c.appendChild(h);c.appendChild(k);d=document.createElement("div");a.addElement(d);a.title="Log in";a.addElement(c);a.addNegativeOption("Cancel").addEventListener("click",function(){modal.close()},!1);a.addAffirmativeOption("Submit").addEventListener("click",function(){for(l(q.value,
g.value,e.checked);d.firstChild;)d.removeChild(d.firstChild)},!1);a.show()}function f(){var a=new modal.Window,c=document.createElement("DIV");c.style.width="400px";var b=document.createElement("DIV");b.style.marginBottom="5px";var q=document.createElement("INPUT");q.type="TEXT";q.maxLength=16;q.placeholder="Username";b.appendChild(q);var h=document.createElement("DIV");h.style.marginBottom="5px";var d=document.createElement("INPUT");d.type="EMAIL";d.placeholder="Email";h.appendChild(d);var k=document.createElement("DIV");
k.style.marginBottom="5px";var e=document.createElement("INPUT");e.type="PASSWORD";e.pattern=".{6,}";e.placeholder="Password";k.appendChild(e);var u=document.createElement("DIV");u.style.marginBottom="5px";var w=document.createElement("INPUT");w.type="PASSWORD";w.pattern=".{6,}";w.placeholder="Confirm password";u.appendChild(w);w.onblur=function(){e.value!=w.value&&w.setCustomValidity("Passwords are not the same.")};w.onfocus=function(){w.setCustomValidity("")};c.appendChild(b);c.appendChild(h);c.appendChild(k);
c.appendChild(u);a.addElement(c);g=document.createElement("div");a.addElement(g);a.title="Register";a.addNegativeOption("Cancel").addEventListener("click",function(){modal.close()},!1);a.addAffirmativeOption("Submit").addEventListener("click",function(){for(n(d.value,q.value,e.value,w.value);g.firstChild;)g.removeChild(g.firstChild)},!1);a.show()}function n(a,c,b,h){$.ajax({type:"POST",url:"/Api/Account/Register",data:$.param({Email:a,UserName:c,Password:b,ConfirmPassword:h}),headers:{"Content-Type":"application/x-www-form-urlencoded"},
success:function(a){a=JSON.parse(a);if(a.Succeeded)Connection.restart(),m(),modal.close();else{for(;g.firstChild;)g.removeChild(g.firstChild);for(var c=0;c<a.Errors.length;c++){var b=document.createElement("div");b.textContent=a.Errors[c];g.appendChild(b)}}}})}function l(a,c,b){$.ajax({type:"POST",url:"/Api/Account/Login",data:$.param({UserName:a,Password:c,RememberMe:b}),headers:{"Content-Type":"application/x-www-form-urlencoded"},success:function(a){a=JSON.parse(a);if(a.Succeeded)Connection.restart(),
m(),modal.close();else{for(;d.firstChild;)d.removeChild(d.firstChild);for(var c=0;c<a.Errors.length;c++){var b=document.createElement("div");b.textContent=a.Errors[c];d.appendChild(b)}}}})}function k(){$.ajax({type:"POST",url:"/Api/Account/LogOff",headers:{"Content-Type":"application/x-www-form-urlencoded"},success:function(a){console.log(a);Connection.restart();m();location.reload()}})}function m(){$.ajax({type:"POST",url:"/Api/Account/Info",headers:{"Content-Type":"application/x-www-form-urlencoded"},
success:function(a){a=JSON.parse(a);var c=a.Anonymous;h.textContent=c?"Guest":a.UserName;Utils.cssSwap(b,c?"registered":"anonymous",c?"anonymous":"registered")}})}var b,c,h,g,d,r,s=function(){function a(){}a.prototype.failed=function(a){this.resultsElement.textContent="Loading failed..."};a.prototype.succeeded=function(a){for(;this.resultsElement.firstChild;)this.resultsElement.removeChild(this.resultsElement.firstChild);var c=document.createElement("table"),b=c.createTHead().insertRow(0);b.classList.add("table-subheader");
var h=b.insertCell(0);h.textContent="Score";h.style.width="65%";h=b.insertCell(0);h.textContent="Name";h.style.width="25%";b=b.insertCell(0);b.textContent="Rank";b.style.width="10%";for(var b=c.createTBody(),g=0;g<a.length;g++){var d=a[g];console.log(d);var k=b.insertRow(b.rows.length);k.classList.add("table-row");var u=k.insertCell(0);u.textContent=Utils.formatNumber(d.Score);u.style.width="65%";u.addEventListener("click",function(a){var c=a.target;a=c.dataset?c.dataset.tooltip:c.getAttribute("data-tooltip");
0<c.textContent.indexOf(",")?c.textContent=Utils.formatNumber(a):c.textContent=Utils.formatNumber(a,!0)});u.dataset?u.dataset.tooltip=d.Score:u.setAttribute("data-tooltip",d.Score.toString());k.insertCell(0).textContent=d.UserId;h.style.width="25%";k=k.insertCell(0);k.textContent=Utils.formatNumber(d.Rank);k.style.width="10%"}this.resultsElement.appendChild(c)};a.prototype.sendRequest=function(a,c){var b=this;$.ajax({asyn:!0,type:"POST",url:"/Api/Stats/LeaderBoard/",data:$.param({Lower:a,Upper:c}),
headers:{"Content-Type":"application/x-www-form-urlencoded"},success:function(a){a=JSON.parse(a);b.succeeded(a)},failure:function(a){b.failed(a)}})};return a}();(function(){b=document.createElement("DIV");b.classList.add("account-manager");b.classList.add("closed");b.onmouseenter=function(){clearTimeout(r)};b.onmouseleave=function(){r=setTimeout(p,250)};var a=document.createElement("DIV");a.textContent="Sign in";a.classList.add("account-option");a.classList.add("anonymous-account-option");a.addEventListener("click",
function(){e()});b.appendChild(a);a=document.createElement("DIV");a.textContent="Register";a.classList.add("account-option");a.classList.add("anonymous-account-option");a.addEventListener("click",function(){f()});b.appendChild(a);a=document.createElement("DIV");a.textContent="Options";a.classList.add("account-option");a.classList.add("registered-account-option");b.appendChild(a);a=document.createElement("DIV");a.textContent="Sign out";a.classList.add("account-option");a.classList.add("registered-account-option");
a.addEventListener("click",function(){k()});b.appendChild(a);c=document.createElement("DIV");c.classList.add("account-user");h=document.createElement("SPAN");c.appendChild(h);b.appendChild(c);document.body.appendChild(b);c.addEventListener("click",function(){b.classList.contains("closed")?b.classList.remove("closed"):b.classList.add("closed")});a=document.createElement("SPAN");a.textContent="Leaderboards";a.addEventListener("click",function(){var a=new modal.Window;a.title="Leaderboards";var c=document.createElement("DIV");
c.style.width="400px";c.textContent="Loading...";a.addElement(c);var b=new s;b.resultsElement=c;b.sendRequest(0,19);a.show()});document.getElementsByClassName("header-links")[0].appendChild(a);m()})();a.info=m})(Account||(Account={}));var Rock;
(function(a){function p(a,c){var b=a.getBoundingClientRect();return{x:c.clientX-b.left,y:c.clientY-b.top}}function e(c,b){if(c>d&&c<d+64&&b>r&&b<r+64){if(v){n(d+2,r+2,60,60);for(var h=Utils.getRandomInt(1,3),g=0;g<h;g++){var k=Utils.getRandomInt(-5,5),e=Utils.getRandomInt(-2,2);a.particles.push(new y(c+k,b+e))}}else n(d-2,r-2,68,68);s=!0}else s&&(n(d,r,64,64),s=!1)}function f(a,c){a!=d&&c!=r&&(d=a,r=c,g?n(a,c,64,64):setTimeout(function(){f(a,c)},10))}function n(a,b,g,d){m.clearRect(0,0,250,250);m.drawImage(c,
0,0);m.drawImage(h,a,b,g,d)}var l=document.getElementById("rock"),k=document.getElementById("particles"),m=l.getContext("2d"),b=k.getContext("2d"),c=new Image,h=new Image(16,16),g=!1,d=0,r=0,s=!1,v=!1;a.particles=[];var y=function(){function a(c,b){this.height=this.width=5;this.dispose=!1;this.x=c;this.y=b;this.verticalVelocity=Utils.getRandomInt(-100,-155);this.horizonalVelocity=Utils.getRandomInt(-50,50);this.width=Utils.getRandomInt(3,6);this.height=Utils.getRandomInt(3,6);this.lastTick=Date.now()}
a.prototype.update=function(){var a=Date.now()-this.lastTick;this.lastTick=Date.now();a/=1E3;this.y+=this.verticalVelocity*a;this.x+=this.horizonalVelocity*a;this.verticalVelocity+=200*a;270<this.y&&(this.dispose=!0)};return a}();a.Particle=y;a.moveRock=f;setInterval(function(){b.clearRect(0,0,250,250);for(var c=0;c<a.particles.length;c++){var h=a.particles[c];h.update();var g=h;b.beginPath();b.fillStyle="gray";b.rect(g.x,g.y,g.width,g.height);b.fill();b.stroke();h.dispose&&a.particles.splice(c,1)}},
10);(function(){c.onload=function(){m.drawImage(c,0,0);console.log("rock loaded")};c.src="/Content/Rock.png";h.onload=function(){g=!0};h.src="/Content/Stone.png";l.addEventListener("mousemove",function(a){a=p(l,a);e(a.x,a.y)},!1);l.addEventListener("mousedown",function(a){a=p(l,a);v=!0;e(a.x,a.y);Connection.mine(a.x,a.y)},!1);l.addEventListener("mouseup",function(a){a=p(l,a);v=!1;e(a.x,a.y)},!1);l.addEventListener("mouseleave",function(a){a=p(l,a);v=!1;e(a.x,a.y)},!1)})()})(Rock||(Rock={}));var Tabs;
(function(a){function p(){if(l){var b=l.scrollHeight;b>window.innerHeight-a.bottomPadding&&(b=window.innerHeight-a.bottomPadding);f.style.minHeight=b+"px";f.style.maxHeight=b+"px";f.style.overflowY=b>=window.innerHeight-a.bottomPadding?"scroll":"hidden"}}var e=0,f=document.getElementById("paneContainer");a.bottomPadding=200;var n=[],l,k=new (function(){function b(a){this.container=a;this.tabs=[];this.lowestId=0;this.id=e++;n.push(this)}b.prototype.newTab=function(c){var b=new m;b.pane=c;c=document.createElement("DIV");
c.classList.add("tab-button");this.container.appendChild(c);b.button=c;0==this.lowestId?b.activate():b.deactivate();var g=this.lowestId++,d=this.id;c.addEventListener("click",function(){a.activateTab(d,g)});this.tabs.push(b);this.container.appendChild(c);return this.lowestId-1};b.prototype.activate=function(a){for(var b=0;b<this.tabs.length;b++)this.tabs[b].deactivate();this.tabs[a].activate()};b.prototype.css=function(a,b){this.tabs[a].button.classList.add(b)};return b}())(document.getElementById("tabContainer"));
a.registerGameTab=function(a,c){var h=k.newTab(a);c&&k.css(h,c)};a.updateGameTabs=p;Utils.addEvent(window,"resize",a.updateGameTabs);setInterval(p,20);a.activateTab=function(a,c){n[a].activate(c);p()};var m=function(){function a(){}a.prototype.deactivate=function(){Utils.cssSwap(this.button,"active","inactive");this.pane.style.display="none";this.pane.style.overflow="hidden"};a.prototype.activate=function(){Utils.cssSwap(this.button,"inactive","active");this.pane.style.display="block";this.pane.style.overflow=
"visible";l=this.pane};return a}()})(Tabs||(Tabs={}));var Chat;
(function(a){function p(){if(!f){f=document.createElement("DIV");f.classList.add("chat-window");f.classList.add("social");f.id="chatWindow";f.style.backgroundColor="#ebebeb";f.style.border="1px solid #adadad";var a=document.createElement("DIV");a.classList.add("chat-header");a.style.backgroundColor="rgb(160, 160, 160)";f.appendChild(a);var m=document.createElement("DIV");m.textContent="_";m.style.position="absolute";m.style.top="0";m.style.right="0";m.addEventListener("click",function(){f.classList.contains("closed")?
(f.classList.remove("closed"),m.textContent="_"):(f.classList.add("closed"),m.textContent="+")});a.appendChild(m);var b=document.createElement("DIV");b.classList.add("chat-room-tab");b.textContent="General";b.addEventListener("click",function(){document.getElementById("debugpane").style.display="none";document.getElementById("chatpane").style.display="block"});a.appendChild(b);b=document.createElement("DIV");b.classList.add("chat-room-tab");b.textContent=">Dev";b.addEventListener("click",function(){document.getElementById("debugpane").style.display=
"block";document.getElementById("chatpane").style.display="none"});b.style.display="none";a.appendChild(b);l=document.createElement("DIV");l.id="debugpane";l.classList.add("chat-room");l.style.display="none";f.appendChild(l);n=document.createElement("DIV");n.id="chatpane";n.classList.add("chat-room");f.appendChild(n);a=document.createElement("DIV");a.id="debuglog";a.classList.add("chat-room-content");l.appendChild(a);a=document.createElement("DIV");a.id="chatlog";a.classList.add("chat-room-content");
n.appendChild(a);a=document.createElement("DIV");b=document.createElement("DIV");b.classList.add("chat-textbox-container");var c=document.createElement("INPUT");c.setAttribute("TYPE","TEXT");c.classList.add("chat-textbox");c.style.borderTop="1px solid #adadad";c.setAttribute("maxlength","220");c.addEventListener("keydown",function(a){13==a.keyCode&&e();68==a.keyCode&&a.altKey&&(document.getElementById("debugtab").style.display="inline-block")});c.id="chattext";b.appendChild(c);a.appendChild(b);b=
document.createElement("DIV");b.classList.add("chat-submit-container");c=document.createElement("INPUT");c.setAttribute("TYPE","BUTTON");c.setAttribute("VALUE","SEND");c.classList.add("chat-submit");c.style.borderTop="1px solid #adadad";c.style.borderLeft="1px solid #adadad";c.addEventListener("click",function(){e()});b.appendChild(c);a.appendChild(b);f.appendChild(a);document.body.appendChild(f)}}function e(){Connection.sendGlobalMessage(document.getElementById("chattext").value);document.getElementById("chattext").value=
""}var f,n,l;a.initialize=p;p();a.log=function(a){var e=document.getElementById("debuglog"),b=document.createElement("DIV");b.textContent=a;e.appendChild(b)};a.receiveGlobalMessage=function(a,e,b,c){var h=document.getElementById("chatlog"),g=5>Math.abs(h.scrollTop-(h.scrollHeight-h.offsetHeight)),d=document.createElement("DIV");d.classList.add("chat-msg");c&&""!=c&&d.classList.add("chat-"+c);c=document.createElement("SPAN");c.textContent="["+Utils.convertServerTimeToLocal(b)+"] ";b=document.createElement("SPAN");
b.textContent=a;b.classList.add("chat-sender");a=document.createElement("SPAN");a.textContent=e;a.classList.add("chat-text");e=document.createElement("SPAN");e.textContent=": ";d.appendChild(c);d.appendChild(b);d.appendChild(e);d.appendChild(a);h.appendChild(d);g&&(h.scrollTop=h.scrollHeight)}})(Chat||(Chat={}));var tooltip;
(function(a){function p(a,c){var h=b.getBoundingClientRect(),g=h.right-h.left,h=h.bottom-h.top;b.style.left=g+(a+15)>window.innerWidth?a-g-15+"px":a+15+"px";b.style.top=0<c-h?c-h+"px":c+5+"px"}function e(){b&&b.parentElement.removeChild(b);m=b=null}function f(a,c,b){var h=new s;n(a);b&&(h.header=b);h.content=c;k.push(h);a.dataset?a.dataset.tooltip=l:a.setAttribute("data-tooltip",l.toString());l++}function n(a){a.onmouseenter=function(a){var f=+a.target.getAttribute("data-tooltip");r!==a.target&&(c=
setInterval(function(){h+=.01;if(.25<=h){var a=g,l=d,t=k[f];m!==f&&e();m=f;b=t.html;document.body.appendChild(b);p(a,l);h=0;clearInterval(c);c=null}},10));r=a.target};a.onmousemove=function(a){a=a.pageX||a.pageY?{x:a.pageX,y:a.pageY}:a.clientX||a.clientY?{x:a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,y:a.clientY+document.body.scrollTop+document.documentElement.scrollTop}:void 0;c||p(a.x,a.y);g=a.x;d=a.y};a.onmouseleave=function(a){r=null;clearInterval(c);h=0;e()}}var l=
0,k=[],m,b,c,h=0,g,d,r,s=function(){function a(){this.html=document.createElement("div");this.html.classList.add("tooltip-wrapper")}Object.defineProperty(a.prototype,"header",{get:function(){return this.html.getElementsByClassName("tooltip-header")[0]},set:function(a){a.classList.add("tooltip-header");this.html.appendChild(a)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"content",{get:function(){return this.html.getElementsByClassName("tooltip-content")[0]},set:function(a){a.classList.add("tooltip-content");
this.html.appendChild(a)},enumerable:!0,configurable:!0});return a}();a.complexModify=function(a,c,b){a=k[a];b&&(a.header.parentElement.removeChild(a.header),a.header=b);a.content.parentElement.removeChild(a.content);a.content=c};a.modify=function(a,c,b){a=k[a];b&&(a.header.textContent=b);a.content.textContent=c};a.retrieveContent=function(a){return k[a].content};a.complexCreate=f;a.create=function(a,c,b){var h=document.createElement("div");h.textContent=c;b?(c=document.createElement("div"),c.textContent=
b,f(a,h,c)):f(a,h)}})(tooltip||(tooltip={}));var Inventory;
(function(a){function p(a){Connection.sellItem(h.id,a?a:1)}function e(){var c=document.getElementById("selecteditemquantity"),b=+c.value;Utils.isNumber(b)&&b>a.getSelectedItemQuantity()&&(c.value=a.getSelectedItemQuantity().toString())}function f(){k=document.createElement("DIV");document.getElementById("paneContainer").appendChild(k);b=document.createElement("DIV");b.classList.add("selected-item");b.style.display="none";var q=document.createElement("SPAN");q.textContent="x";q.style.top="0px";q.style.right=
"3px";q.style.position="absolute";q.addEventListener("click",function(){a.selectItem()});b.appendChild(q);c=document.createElement("DIV");c.classList.add("selected-item-image");q=document.createElement("INPUT");q.id="selecteditemquantity";q.type="text";q.style.height="18px";q.classList.add("selected-item-quantity");q.addEventListener("input",function(){e()});r=Utils.createButton("Drink","");r.classList.add("selected-item-quantity");r.addEventListener("click",function(){Connection.drink(h.id);e()});
var f=Utils.createButton("Sell","");f.classList.add("selected-item-quantity");f.addEventListener("click",function(){var c=+document.getElementById("selecteditemquantity").value;Utils.isNumber(c)&&a.sellSelectedItem(c);e()});var t=Utils.createButton("Sell all","");t.classList.add("selected-item-quantity");t.addEventListener("click",function(){a.sellAllSelectedItem();e()});b.appendChild(c);b.appendChild(t);b.appendChild(f);b.appendChild(r);b.appendChild(q);k.appendChild(b);q=document.createElement("DIV");
q.style.textAlign="center";f=document.createElement("DIV");f.style.display="inline-block";t=Utils.createButton("Sell (...)","");t.addEventListener("click",function(){Connection.sellAllItems()});var l=Utils.createButton("...","");l.addEventListener("click",function(){a.toggleConfig()});f.appendChild(t);f.appendChild(l);q.appendChild(f);k.appendChild(q);d=document.createElement("DIV");d.classList.add("config-container");d.classList.add("closed");q=document.createElement("TABLE");q.classList.add("config-table");
d.appendChild(q);t=q.createTHead();f=t.insertRow(0);t=t.insertRow(0);t.classList.add("table-header");t=t.insertCell(0);t.textContent="Inventory Configuration";t.setAttribute("colspan","10");f.classList.add("table-subheader");for(var n in x)0<=parseInt(n,10)&&"NFS"!=x[n]&&(f.insertCell(f.cells.length).classList.add("config-cell-check"),t=f.insertCell(f.cells.length),t.classList.add("config-cell-name"),t.textContent=x[n]);g=q.createTBody();m=document.createElement("DIV");m.style.position="relative";
m.appendChild(d);k.appendChild(m);Tabs.registerGameTab(k,"Inventory")}function n(a){var c=document.createElement("DIV");a.container=c;c.classList.add("header-item");var b=document.createElement("DIV");b.style.width="32px";b.style.height="32px";b.style.display="inline-block";b.style.position="relative";b.style.margin="0 auto";var h=document.createElement("DIV");h.classList.add("Half-"+a.name.replace(" ","_"));b.appendChild(h);c.appendChild(b);b=document.createElement("DIV");a.quantityElm=b;b.classList.add("item-text");
b.textContent=Utils.formatNumber(0);b.style.verticalAlign="top";b.style.marginTop="8px";b.style.display="inline-block";c.appendChild(b);b=document.createElement("DIV");b.style.display="none";a.worthElm=b;c.appendChild(b);return c}function l(c){if(0==c.category||null==c.category)return n(c);var b=document.createElement("DIV");c.container=b;b.classList.add("item");b.addEventListener("click",function(){a.selectItem(c.id)});tooltip.create(b,c.name);var h=document.createElement("DIV");h.classList.add("item-text");
var d=document.createElement("DIV");d.style.verticalAlign="top";d.style.display="inline-block";d.textContent=Utils.formatNumber(c.worth);c.worthElm=d;var k=document.createElement("DIV");k.classList.add("Quarter-Coins");k.style.display="inline-block";h.appendChild(k);h.appendChild(d);b.appendChild(h);d=document.createElement("DIV");d.style.width="64px";d.style.height="64px";d.style.position="relative";d.style.margin="0 auto";h=document.createElement("DIV");h.classList.add(c.name.replace(" ","_"));
d.appendChild(h);b.appendChild(d);h=document.createElement("DIV");c.quantityElm=h;h.classList.add("item-text");h.textContent=Utils.formatNumber(0);b.appendChild(h);if(null!=c.category){var u,e,d=g.rows.length,h=c.category,h=2*h;h--;for(k=0;k<d;k++){var f=g.rows[k].cells[h];if(f&&0==f.childElementCount){u=g.rows[k].cells[h];e=g.rows[k].cells[h-1];break}}if(!u){e=g.insertRow(g.rows.length);e.classList.add("table-row");for(var m in x)0<=parseInt(m,10)&&"NFS"!=x[m]&&(e.insertCell(e.cells.length).classList.add("config-cell-check"),
e.insertCell(e.cells.length).classList.add("config-cell-name"));u=e.cells[h];e=e.cells[h-1]}m=document.createElement("DIV");m.classList.add("item-text");m.style.height="auto";d=document.createElement("SPAN");d.style.verticalAlign="top";h=document.createElement("DIV");h.classList.add("Third-"+Utils.cssifyName(c.name));h.style.display="inline-block";v[c.id]=h;d.textContent=c.name;s[c.id]=d;m.appendChild(h);m.appendChild(d);u.appendChild(m);u=document.createElement("INPUT");u.type="CHECKBOX";var C=c.id;
a.configClickers[C]=u;u.addEventListener("change",function(c){Connection.configureItem(C,a.configClickers[C].checked)});e.appendChild(u)}return b}a.items=[];a.configClickers=[];var k,m,b,c,h,g,d,r,s=[],v=[],y=function(){return function(a,c,b,h){this.id=a;this.name=c;this.worth=b;this.category=h}}();a.Item=y;(function(a){a[a.NFS=0]="NFS";a[a.ORE=1]="ORE";a[a.GEM=2]="GEM";a[a.INGREDIENT=3]="INGREDIENT";a[a.CRAFTING=4]="CRAFTING";a[a.POTION=5]="POTION"})(a.Category||(a.Category={}));var x=a.Category;
a.getSelectedItemQuantity=function(){return h?h.quantity:0};a.selectItem=function(d){d?(null!=h&&c.classList.remove(Utils.cssifyName(h.name)),h=a.items[d],c.classList.add(Utils.cssifyName(h.name)),r.style.display=5==h.category?"inline-block":"none",e()):(c.classList.remove(Utils.cssifyName(h.name)),h=null);b.style.display=null==h?"none":"block"};a.sellSelectedItem=p;a.sellAllSelectedItem=function(){p(h.quantity)};a.modifyConfig=function(c,b){a.configClickers[c]||console.log(c);a.configClickers[c].checked=
b};a.toggleConfig=function(){d.classList.contains("closed")?d.classList.remove("closed"):d.classList.add("closed")};a.addItem=function(c,b,h,d){a.items[c]||(c=new y(c,b,h,d),a.items[c.id]=c,Objects.register(c.id,c.name),k||f(),0!=c.category&&null!=c.category?m.appendChild(l(c)):document.getElementById("headerInventory").appendChild(l(c)))};a.changePrice=function(c,b){Utils.ifNotDefault(b,function(){var h=a.items[c];h.worth=b;h.worthElm.textContent=Utils.formatNumber(b)})};a.changeQuantity=function(c,
b){Utils.ifNotDefault(b,function(){Objects.setQuantity(c,b);Crafting.update();a.items[c].quantityElm.textContent=Utils.formatNumber(b);a.items[c].quantity=b;a.items[c].container.style.display=0!=a.items[c].category&&null!=a.items[c].category?0==b?"none":"inline-block":0==Objects.getLifeTimeTotal(c)?"none":"inline-block";e()})};a.update=function(){0>=s.length||a.items.forEach(function(a){var c=Objects.getLifeTimeTotal(a.id);s[a.id]&&(s[a.id].textContent=0<c?a.name:"???");v[a.id]&&(v[a.id].style.display=
0<c?"inline-block":"none")})}})(Inventory||(Inventory={}));var Connection;
(function(a){function p(){console.log("Connection opened");var a=b.encode64();e(a);b=new Komodo.ClientActions;n=setInterval(function(){var a=b.encode64();e(a);b=new Komodo.ClientActions},1E3)}function e(a){if(a.encode64){var b=a.encode64();Chat.log("Sent "+f(b)+" bytes to komodo.");Chat.log("Decoded: ");Chat.log(JSON.stringify(a));Chat.log("Encoded: ");Chat.log(a.encode64());Komodo.send(a.encode64())}else Chat.log("Sent "+f(a)+" bytes to komodo."),Komodo.send(a)}function f(a){var b=[];a=[a];for(var g=
0;a.length;){var d=a.pop();if("boolean"===typeof d)g+=4;else if("string"===typeof d)g+=2*d.length;else if("number"===typeof d)g+=8;else if("object"===typeof d&&-1===b.indexOf(d)){b.push(d);for(var e in d)a.push(d[e])}}return g}var n,l,k,m;(function(){l=document.createElement("div");l.classList.add("error-notification-tray");l.style.display="none";k=document.createElement("div");k.classList.add("network-error");var a=document.createElement("div");a.classList.add("network-error-text");a.textContent=
"No connection";k.appendChild(a);m=document.createElement("div");m.classList.add("rate-limited");a=document.createElement("div");a.classList.add("network-error-text");a.textContent="You have exceeded your allotted requests";m.appendChild(a);a=document.getElementById("game");l.appendChild(k);l.appendChild(m);a.insertBefore(l,a.childNodes[0])})();Komodo.connection.received(function(a){Chat.log("Recieved "+f(a)+" bytes from komodo.");Chat.log("Encoded: ");Chat.log(a);Chat.log("Decoded: ");Chat.log(JSON.stringify(Komodo.decode(a)));
Chat.log(f(JSON.stringify(Komodo.decode(a)))-f(a)+" bytes saved.");a=Komodo.decode(a);if(null!=a.Messages)for(var b=a.Messages,g=0;g<b.length;g++){var d=b[g];Chat.receiveGlobalMessage(d.Sender,d.Text,d.Time,d.Permissions)}if(null!=a.GameSchema){b=a.GameSchema;if(b.Items)for(g=0;g<b.Items.length;g++)Inventory.addItem(b.Items[g].Id,b.Items[g].Name,b.Items[g].Worth,b.Items[g].Category),Statistics.addItem(b.Items[g].Id,b.Items[g].Name);if(b.StoreItems)for(g=0;g<b.StoreItems.length;g++)d=b.StoreItems[g],
Store.addItem(d.Id,d.Category,d.Price,d.Factor,d.Name,d.MaxQuantity);if(b.Processors)for(g=0;g<b.Processors.length;g++){d=b.Processors[g];Crafting.addProcessor(d.Id,d.Name);for(var e=0;e<d.Recipes.length;e++)Crafting.addProcessorRecipe(d.Id,d.Recipes[e].Ingredients,d.Recipes[e].Resultants)}if(b.CraftingItems)for(g=0;g<b.CraftingItems.length;g++)d=b.CraftingItems[g],Crafting.addRecipe(d.Id,d.Ingredients,d.Resultants,d.IsItem);if(b.Buffs)for(g=0;g<b.Buffs.length;g++)d=b.Buffs[g],Buffs.register(d.Id,
d.Name,d.Description,d.Duration)}if(null!=a.Items)for(b=a.Items,g=0;g<b.length;g++)Inventory.changeQuantity(b[g].Id,b[g].Quantity),Inventory.changePrice(b[g].Id,b[g].Worth);if(null!=a.StoreItemsUpdate)for(b=a.StoreItemsUpdate,g=0;g<b.length;g++)Store.changeQuantity(b[g].Id,b[g].Quantity,b[g].MaxQuantity,b[g].Price);if(null!=a.StatItemsUpdate)for(b=a.StatItemsUpdate,g=0;g<b.length;g++)Statistics.changeStats(b[g].Id,b[g].PrestigeQuantity,b[g].LifeTimeQuantity);if(null!=a.ConfigItems)for(b=a.ConfigItems,
g=0;g<b.length;g++)Inventory.modifyConfig(b[g].Id,b[g].Enabled);if(null!=a.Processors)for(b=a.Processors,g=0;g<b.length;g++)d=b[g],Crafting.updateProcessor(d.Id,d.SelectedRecipe,d.OperationDuration,d.CompletedOperations,d.TotalOperations,d.Capacity);null!=a.AntiCheatCoordinates&&(b=a.AntiCheatCoordinates,Rock.moveRock(b.X,b.Y));if(null!=a.Buffs)for(b=a.Buffs,g=0;g<b.length;g++)d=b[g],Buffs.update(d.Id,d.TimeActive);null!=a.IsRateLimited&&(m.style.display=a.IsRateLimited?"block":"none")});a.restart=
function(){Komodo.restart()};var b=new Komodo.ClientActions;Komodo.connection.stateChanged(function(a){a.newState===$.signalR.connectionState.connected&&(p(),k.style.display="none");a.newState===$.signalR.connectionState.disconnected&&(clearInterval(n),k.style.display="block");a.newState===$.signalR.connectionState.reconnecting&&(k.style.display="block")});a.drink=function(a){var h=new Komodo.ClientActions.PotionAction;h.Id=a;b.PotionActions.push(h)};a.mine=function(a,h){var g=new Komodo.ClientActions.MiningAction;
g.X=a;g.Y=h;b.MiningActions.push(g)};a.sellItem=function(a,h){var g=new Komodo.ClientActions.InventoryAction,d=new Komodo.ClientActions.InventoryAction.SellAction;d.Id=a;d.Quantity=h;g.Sell=d;b.InventoryActions.push(g)};a.configureItem=function(a,h){var g=new Komodo.ClientActions.InventoryAction,d=new Komodo.ClientActions.InventoryAction.ConfigAction;d.Id=a;d.Enabled=h;g.Config=d;b.InventoryActions.push(g)};a.purchaseItem=function(a,h){var g=new Komodo.ClientActions.StoreAction,d=new Komodo.ClientActions.StoreAction.PurchaseAction;
d.Id=a;d.Quantity=h?h:1;g.Purchase=d;b.StoreActions.push(g)};a.sellAllItems=function(){var a=new Komodo.ClientActions.InventoryAction;a.SellAll=!0;b.InventoryActions.push(a)};a.craftRecipe=function(a,h){var g=new Komodo.ClientActions.CraftingAction;g.Id=a;g.Quantity=h;b.CraftingActions.push(g)};a.processRecipe=function(a,h,g){var d=new Komodo.ClientActions.ProcessingAction;d.Id=a;d.RecipeIndex=h;d.Iterations=g;b.ProcessingActions.push(d)};a.sendGlobalMessage=function(a){var h=new Komodo.ClientActions.SocialAction,
g=new Komodo.ClientActions.SocialAction.ChatAction;g.GlobalMessage=a;h.Chat=g;b.SocialActions.push(h)};a.send=e})(Connection||(Connection={}));var Buffs;
(function(a){var p=[],e=document.getElementById("sidebarInformation"),f,n=function(){return function(){}}();a.register=function(a,e,m,b){if(!p[a]){var c=new n;c.name=e;c.description=m;c.duration=b;p[a]=c;a=document.createElement("div");a.classList.add("buff-container");tooltip.create(a,c.description);e=document.createElement("div");e.textContent=c.name;e.classList.add("buff-header");a.appendChild(e);e=document.createElement("div");e.classList.add("buff-image-container");a.appendChild(e);m=document.createElement("div");
m.classList.add(Utils.cssifyName(c.name));e.appendChild(m);e=document.createElement("div");e.classList.add("buff-header");a.appendChild(e);f.appendChild(a);c.container=a;c.durationElm=e}};a.update=function(a,e){var f=p[a];f.timeActive=e;f.durationElm.textContent="("+Utils.formatTime(f.duration-e)+")";f.container.style.display=0==e?"none":"inline-block"};f=document.createElement("div");e.appendChild(f)})(Buffs||(Buffs={}));var Store;
(function(a){function p(){f=document.createElement("div");document.getElementById("paneContainer").appendChild(f);Tabs.registerGameTab(f,"Store");for(var a in k)if(0<=parseInt(a,10)){var c=k[a];if("CRAFTING"!=c){var h=document.createElement("div");h.classList.add("store-category");l[c]=h;var g=document.createElement("div");g.textContent=c;g.classList.add("store-category-header");h.appendChild(g);f.appendChild(h)}}}function e(a){var c=document.createElement("div");c.classList.add("store-item");a.container=
c;var h=document.createElement("div");h.classList.add("store-item-header");var g=document.createElement("div");g.classList.add("store-item-header-text");g.textContent=a.name;h.appendChild(g);var d=document.createElement("div");d.classList.add("store-item-header-quantity-container");var e=document.createElement("span");e.classList.add("store-item-header-quantity");var f=document.createElement("span");f.classList.add("store-item-header-quantity");var k=document.createElement("span");k.classList.add("store-item-header-quantity");
k.textContent="/";1<a.maxQuantity&&(d.appendChild(f),d.appendChild(k),d.appendChild(e));h.appendChild(d);a.maxQuantityElm=e;a.quantityElm=f;a.nameElm=g;c.appendChild(h);h=document.createElement("DIV");h.style.width="64px";h.style.height="64px";h.style.position="relative";h.style.margin="0 auto";g=document.createElement("DIV");g.classList.add(Utils.cssifyName(a.name));h.appendChild(g);c.appendChild(h);h=document.createElement("div");h.classList.add("store-item-footer");g=document.createElement("div");
g.classList.add("item-text");d=document.createElement("div");d.textContent=Utils.formatNumber(a.price);d.style.display="inline-block";d.style.verticalAlign="top";a.priceElm=d;e=document.createElement("div");e.classList.add("Quarter-Coins");e.style.display="inline-block";g.appendChild(e);g.appendChild(d);var d=document.createElement("div"),e=Utils.createButton("Buy",""),m=a.id;if(5!=a.category)e.addEventListener("click",function(){Connection.purchaseItem(m)});else{var l=document.createElement("INPUT");
l.type="TEXT";l.style.width="40px";l.style.height="15px";d.appendChild(l);e.addEventListener("click",function(){Utils.isNumber(l.value)&&Connection.purchaseItem(m,+l.value)})}d.appendChild(e);h.appendChild(d);h.appendChild(g);c.appendChild(h);return c}var f,n=[],l=[];(function(a){a[a.MINING=1]="MINING";a[a.MACHINES=2]="MACHINES";a[a.GATHERING=3]="GATHERING";a[a.PROCESSING=4]="PROCESSING";a[a.ITEMS=5]="ITEMS";a[a.CRAFTING=6]="CRAFTING"})(a.Category||(a.Category={}));var k=a.Category,m=function(){return function(){}}();
a.tempFix=function(){p()};a.addItem=function(a,c,h,g,d,r){f||p();if(!n[a]){var s=new m;s.id=a;s.category=c;s.price=h;s.factor=g;s.name=d;s.maxQuantity=r?r:0;Objects.register(s.id,s.name);c=l[k[c]];null==c&&(c=l.MINING);6!=s.category&&c.appendChild(e(s));n[a]=s}};a.changeQuantity=function(a,c,h,g){var d=n[a];Utils.ifNotDefault(h,function(){if(0!=h)try{d.maxQuantity=h,d.maxQuantityElm.textContent=h.toString()}catch(a){}});Utils.ifNotDefault(c,function(){Objects.setQuantity(a,c);d.quantity=c;Crafting.update();
0!=h&&6!=d.category&&(d.container.style.display=-1>=d.quantity||d.quantity>=d.maxQuantity&&0<d.maxQuantity?"none":"inline-block",d.maxQuantity&&1<d.maxQuantity&&(d.quantityElm.textContent=c.toString()))});Utils.ifNotDefault(g,function(){d.priceElm&&(d.price=g,d.priceElm.textContent=Utils.formatNumber(g))})}})(Store||(Store={}));var Statistics;
(function(a){function p(){var a=document.createElement("TABLE"),e=a.createTHead(),b=e.insertRow(0);b.classList.add("table-header");b=b.insertCell(0);b.textContent="Item Statistics";b.setAttribute("colspan","3");e=e.insertRow(1);e.classList.add("table-subheader");b=e.insertCell(0);b.textContent="Lifetime Quantity";b.style.width="40%";b=e.insertCell(0);b.textContent="Prestige Quantity";b.style.width="40%";e=e.insertCell(0);e.textContent="Item";e.style.width="20%";f=a.createTBody();return a}var e,f,
n=[],l=function(){return function(){}}();a.changeStats=function(a,e,b){var c=n[a];Utils.ifNotDefault(e,function(){c.prestigeQuantity=e;c.prestigeRow.textContent=Utils.formatNumber(e)});Utils.ifNotDefault(b,function(){c.lifetimeQuantity=b;Objects.setLifeTimeTotal(a,b);c.alltimeRow.textContent=Utils.formatNumber(b)})};a.addItem=function(a,m){e||(e=document.createElement("DIV"),document.getElementById("paneContainer").appendChild(e),Tabs.registerGameTab(e,"Statistics"),e.appendChild(p()));if(!n[a]){var b=
new l;n[a]=b;var c=f.insertRow(f.rows.length);c.classList.add("table-row");b.alltimeRow=c.insertCell(0);b.alltimeRow.style.width="40%";b.prestigeRow=c.insertCell(0);b.prestigeRow.style.width="40%";b=c.insertCell(0);b.style.width="20%";c=document.createElement("DIV");c.classList.add("Third-"+Utils.cssifyName(m));c.style.display="inline-block";b.appendChild(c)}}})(Statistics||(Statistics={}));var Crafting;
(function(a){function p(){k=document.createElement("DIV");document.getElementById("paneContainer").appendChild(k);Tabs.registerGameTab(k,"Crafting");m=document.createElement("DIV");k.appendChild(m);b=document.createElement("DIV");k.appendChild(b);c=document.createElement("TABLE");c.classList.add("block-table");var a=c.createTHead(),e=a.insertRow(0);e.classList.add("table-subheader");a=a.insertRow(0);a.classList.add("table-header");a=a.insertCell(0);a.colSpan=h.length;a.textContent="Crafting Table";
for(a=0;a<h.length;a++){var f=e.insertCell(0);f.style.width=g[a];f.textContent=h[a];"0"!=d[a]&&(f.style.minWidth=d[a])}e=c.insertRow(2);e.classList.add("table-subheader");e=e.insertCell(0);e.colSpan=h.length;e.textContent="Items";e=c.insertRow(3);e.classList.add("table-subheader");e=e.insertCell(0);e.colSpan=h.length;e.textContent="Upgrades";b.appendChild(c)}function e(b,c){var e=a.processors[b];if(e){var d=e._recipes[c];for(e.selectedRecipe=c;e.recipeList.lastChild;)e.recipeList.removeChild(e.recipeList.lastChild);
for(var h=0;h<d.ingredients.length;h++){var g=document.createElement("DIV");g.classList.add("item-text");g.style.height="30px";var f=document.createElement("DIV");f.style.display="inline-block";var k=document.createElement("DIV");d.ingredients[h].quantityDiv=k;k.style.display="inline-block";k.style.verticalAlign="super";k.style.color=d.ingredients[h].quantity<=Objects.getQuantity(d.ingredients[h].id)?"darkgreen":"darkred";k.textContent=Utils.formatNumber(d.ingredients[h].quantity);f.classList.add("Half-"+
Utils.cssifyName(Objects.lookupName(d.ingredients[h].id)));g.appendChild(f);g.appendChild(k);e.recipeList.appendChild(g)}}}function f(a){var b=document.createElement("TABLE");b.classList.add("block-table");var c=b.createTHead(),d=c.insertRow(0);d.classList.add("table-subheader");c=c.insertRow(0);c.classList.add("table-header");c=c.insertCell(0);c.colSpan=h.length;c.textContent=a.name;for(c=0;c<h.length;c++){var f=d.insertCell(0);f.style.width=s[c];f.textContent=r[c];"0"!=s[c]&&(f.style.minWidth=v[c])}c=
b.insertRow(2);c.classList.add("table-row");c=c.insertCell(0);c.colSpan=r.length;f=document.createElement("DIV");f.classList.add("progress-bar-container");d=document.createElement("DIV");d.classList.add("progress-bar");var k=document.createElement("DIV");k.classList.add("progress-bar-text-container");var l=document.createElement("DIV");l.classList.add("progress-bar-text");k.appendChild(l);f.appendChild(k);a.progressBar=d;a.progressText=l;f.appendChild(d);c.appendChild(f);d=b.insertRow(3);d.classList.add("table-row");
for(c=0;c<r.length;c++){f=d.insertCell(0);f.style.width=g[c];f.style.height="75px";"0"!=v[c]&&(f.style.minWidth=v[c]);"Image"==r[c]&&(k=document.createElement("DIV"),k.classList.add(Utils.cssifyName(a.name)),k.style.margin="0 auto",f.appendChild(k));"Capacity"==r[c]&&(f.textContent="0",a.capacityElm=f);"Input"==r[c]&&(a.recipeList=f);if("Output"==r[c]){k=Utils.createButton("Max","");f.appendChild(k);k=document.createElement("INPUT");k.type="TEXT";k.style.width="35px";a.quantityTextbox=k;f.appendChild(k);
var p=a.id,q=document.createElement("SELECT");q.addEventListener("change",function(a){e(p,q.selectedIndex)});a.recipeSelector=q;f.appendChild(q)}"Action"==r[c]&&(k=Utils.createButton("Activate",""),k.addEventListener("click",function(){Utils.isNumber(a.quantityTextbox.value)&&Connection.processRecipe(a.id,a.recipeSelector.selectedIndex,+a.quantityTextbox.value)},!1),f.appendChild(k))}n(a);m.appendChild(b)}function n(a){A||(A=document.createElement("div"),q.appendChild(A));var b=document.createElement("div");
b.classList.add("processor-sidebar");a.sidebarContainer=b;var c=document.createElement("div");c.classList.add("buff-header");c.textContent=a.name;b.appendChild(c);c=document.createElement("div");c.classList.add("processor-sidebar-progress-bar-container");var d=document.createElement("div");d.classList.add("processor-sidebar-progress-bar");a.sidebarProgressBar=d;var e=document.createElement("div");e.classList.add("processor-sidebar-progress-text");a.sidebarProgressText=e;c.appendChild(e);c.appendChild(d);
b.appendChild(c);c=document.createElement("div");c.classList.add("processor-sidebar-progress-bar-container");d=document.createElement("div");d.classList.add("processor-sidebar-progress-bar");a.sidebarJobBar=d;e=document.createElement("div");e.classList.add("processor-sidebar-progress-text");a.sidebarJobText=e;c.appendChild(e);c.appendChild(d);b.appendChild(c);b.style.display="none";A.appendChild(b)}function l(a,b){var e=c.rows.length;b&&(e=y,y++);e=c.insertRow(e);e.classList.add("table-row");a.row=
e;for(var f=0;f<h.length;f++){var k=e.insertCell(0);k.style.width=g[f];"0"!=d[f]&&(k.style.minWidth=d[f]);"Name"==h[f]&&(k.textContent=Objects.lookupName(a.id));if("Input"==h[f])for(var l=0;l<a.ingredients.length;l++){var m=document.createElement("DIV");m.classList.add("item-text");m.style.height="22px";var n=document.createElement("DIV");n.style.display="inline-block";var p=document.createElement("DIV");a.ingredients[l].quantityDiv=p;p.style.display="inline-block";p.style.verticalAlign="super";p.textContent=
Utils.formatNumber(a.ingredients[l].quantity);n.classList.add("Third-"+Utils.cssifyName(Objects.lookupName(a.ingredients[l].id)));m.appendChild(n);m.appendChild(p);k.appendChild(m)}if("Output"==h[f])for(l=0;l<a.resultants.length;l++)m=document.createElement("DIV"),m.classList.add("item-text"),m.style.height="22px",n=document.createElement("DIV"),n.style.display="inline-block",p=document.createElement("DIV"),p.style.display="inline-block",p.style.verticalAlign="super",p.textContent=Utils.formatNumber(a.resultants[l].quantity),
n.classList.add("Third-"+Utils.cssifyName(Objects.lookupName(a.resultants[l].id))),m.appendChild(n),a.isItem&&m.appendChild(p),k.appendChild(m);if("Action"==h[f]&&(l=Utils.createButton("Craft",""),l.addEventListener("click",function(){Connection.craftRecipe(a.id,1)},!1),k.appendChild(l),a.isItem)){var q=document.createElement("INPUT");q.type="TEXT";q.style.width="30px";l=Utils.createButton("Craft-x","");l.addEventListener("click",function(){Connection.craftRecipe(a.id,+q.value)},!1);k.appendChild(l);
k.appendChild(q)}}}var k,m,b,c,h=["Action","Description","Input","Output","Name"],g=["10%","50%","15%","15%","10%"],d=["170px","0","0","0","0"],r=["Action","Output","Input","Capacity","Image"],s=["10%","30%","20%","20%","20%"],v=["170px","0","0","0","0"],y=3,x=[];a.processors=[];var q=document.getElementById("sidebarInformation"),A,t=function(){function a(){this._recipes=[]}a.prototype.addRecipe=function(a){this._recipes.push(a);this.selectedRecipe||(this.selectedRecipe=0)};return a}();a.Processor=
t;var B=function(){function a(){this.ingredients=[];this.resultants=[]}a.prototype.addIngredient=function(a){this.ingredients.push(a)};a.prototype.addResultant=function(a){this.resultants.push(a)};return a}();a.Recipe=B;var z=function(){return function(a,b){this.id=a;this.quantity=b}}();a.Ingredient=z;a.addRecipe=function(a,b,c,e){k||p();if(!x[a]){var d=new B;d.id=a;d.isItem=e;x[a]=d;for(a=0;a<b.length;a++)d.addIngredient(new z(b[a].Id,b[a].Quantity));for(a=0;a<c.length;a++)d.addResultant(new z(c[a].Id,
c[a].Quantity));l(d,e)}};a.addProcessor=function(b,c){k||p();if(!a.processors[b]){var d=new t;d.id=b;d.name=c;a.processors[b]=d;f(d)}};a.addProcessorRecipe=function(b,c,d){if(a.processors[b]){var h=a.processors[b],g;a:if(a.processors[b]){g=a.processors[b];for(var f=0;f<g._recipes.length;f++)if(d[0].Id==g._recipes[f].resultants[0].id){g=!0;break a}g=!1}else g=void 0;if(!g){g=new B;for(f=0;f<c.length;f++)g.addIngredient(new z(c[f].Id,c[f].Quantity));for(f=0;f<d.length;f++)g.addResultant(new z(d[f].Id,
d[f].Quantity));h.addRecipe(g);c=document.createElement("OPTION");c.textContent=Objects.lookupName(d[0].Id);h.recipeSelector.appendChild(c);1==h._recipes.length&&e(b,0)}}};a.updateProcessor=function(b,c,d,e,g,h){var f=a.processors[b];if(f){var k=!1;Utils.ifNotDefault(c,function(){f.selectedRecipe=c});Utils.ifNotDefault(g,function(){f.totalOperations=g;k=!0});Utils.ifNotDefault(d,function(){f.operationDuration=d});Utils.ifNotDefault(h,function(){f.capacityElm.textContent=h.toString()});Utils.ifNotDefault(e,
function(){f.completedOperations=e;k=!0});if(k){if(0>=f.totalOperations||f.completedOperations==f.totalOperations){f.progressBar.style.width="0%";f.progressText.textContent="";f.sidebarProgressText.textContent="";f.sidebarContainer.style.display="none";f.totalOperationCompletionTime=0;return}f.sidebarContainer.style.display="inline-block";f.operationStartTime=Date.now();f.operationCompletionTime=f.operationStartTime+1E3*f.operationDuration;0==f.totalOperationCompletionTime&&(f.totalOperationCompletionTime=
f.operationStartTime+1E3*f.operationDuration*(f.totalOperations-f.completedOperations))}if(-1<f.selectedRecipe)try{f.progressText.textContent=Objects.lookupName(f._recipes[f.selectedRecipe].resultants[0].id)+" ("+f.completedOperations+"/"+f.totalOperations+")",f.sidebarJobText.textContent=Objects.lookupName(f._recipes[f.selectedRecipe].resultants[0].id)+" ("+f.completedOperations+"/"+f.totalOperations+")"}catch(l){console.log("invalid processor recipe "+f.selectedRecipe)}else f.progressText.textContent=
"",f.sidebarProgressText.textContent=""}};setInterval(function(){a.processors.forEach(function(a){if(0>=a.operationDuration)a.progressBar.style.width="0%";else if(a.completedOperations!=a.totalOperations&&0<a.totalOperations){var b=a.operationCompletionTime-Date.now(),b=b/1E3,c=a.totalOperationCompletionTime-Date.now(),d=c/(a.operationDuration*a.totalOperations),b=b/a.operationDuration,b=100-100*b;a.progressBar.style.width=b+"%";a.sidebarJobBar.style.width=b+"%";a.sidebarProgressBar.style.width=100-
d/10+"%";a.sidebarProgressText.textContent=Utils.formatTime(c/1E3)}})},10);a.update=function(){k&&(x.forEach(function(a){var b=Objects.getQuantity(a.id);a.row.style.display=-1==b||!a.isItem&&0<b?"none":"";a.ingredients.forEach(function(a){var b=Objects.getQuantity(a.id);a.quantityDiv.style.color=b>=a.quantity?"darkgreen":"darkred"})}),a.processors.forEach(function(a){e(a.id,a.recipeSelector.selectedIndex)}))}})(Crafting||(Crafting={}));
