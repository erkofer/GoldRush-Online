var Utils;
(function(a){a.addEvent=function(a,h,g){null!=a&&"undefined"!=typeof a&&(a.addEventListener?a.addEventListener(h,g,!1):a.attachEvent?a.attachEvent("on"+h,g):a["on"+h]=g)};a.cssSwap=function(a,h,g){a.classList.contains(h)&&a.classList.remove(h);a.classList.add(g)};a.cssifyName=function(a){return a.split(" ").join("_")};a.ifNotDefault=function(a,h){-100!=a&&h()};a.createButton=function(a,h){var g,m;g=document.createElement("div");m=document.createElement("div");m.textContent=a;h&&(m.id=h);g.classList.add("button");
g.appendChild(m);return g};a.isNumber=function(a){return!isNaN(parseFloat(a))};a.formatNumber=function(a,h){"undefined"===typeof h&&(h=!1);return a?h?a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","):999999999999999<a?(a/1E15).toFixed(3)+"Qa":999999999999<a?(a/1E12).toFixed(3)+"T":999999999<a?(a/1E9).toFixed(3)+"B":999999<a?(a/1E6).toFixed(3)+"M":a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","):"0"};a.getRandomInt=function(a,h){return Math.floor(Math.random()*(h-a+1))+a};a.formatTime=function(a){var h=
Math.floor(a/3600),g=Math.floor(a%3600/60);a=Math.floor(a%60);return(10>h?1>h?"":"0"+h+":":h+":")+(10>g?"0"+g+":":g+":")+(10>a?"0"+a:a+"")};a.convertServerTimeToLocal=function(a){var h=+a.split(":")[0],g=+a.split(":")[1].split(" ")[0];"PM"==a.split(":")[1].split(" ")[1]&&(h+=12);a=(new Date).getTimezoneOffset();h-=a/60-a%60;g-=a%60;0>h&&(h=24-h);0>g&&(g=60-g,h--);23<h&&(h-=24);59<g&&(g-=60,h++);return(10>h?"0":"")+h+":"+(10>g?"0":"")+g}})(Utils||(Utils={}));var modal;
(function(a){function n(){a.activeWindow&&a.activeWindow.hide();a.activeWindow=null}function h(){if(a.activeWindow){var f=a.activeWindow.container.getBoundingClientRect();a.activeWindow.container.style.left=window.innerWidth/2-(f.right-f.left)/2+"px";a.activeWindow.container.style.top=window.innerHeight/2-(f.bottom-f.top)/2+"px"}else clearInterval(a.intervalIdentifier)}var g=0,m;a.activeWindow;a.intervalIdentifier;a.hide=n;a.close=function(){if(a.activeWindow){var f=a.activeWindow;n();f.container.parentNode.removeChild(f.container)}};
var l=function(){function f(){this.container=document.createElement("div");this.container.addEventListener("click",function(a){a.stopPropagation()},!1);this.container.classList.add("modal-window");if(!m){var f=document.createElement("div");m=f;f.classList.add("modal-wrapper");f.addEventListener("click",function(d){d.stopPropagation();3E3<Date.now()-g&&a.close()},!1);document.body.appendChild(f)}m.appendChild(this.container);this.titleEl=document.createElement("div");this.titleEl.classList.add("modal-header");
this.bodyEl=document.createElement("div");this.container.appendChild(this.titleEl);this.container.appendChild(this.bodyEl)}Object.defineProperty(f.prototype,"title",{get:function(){return this._title},set:function(a){this._title=a;this.titleEl.textContent=this._title},enumerable:!0,configurable:!0});f.prototype.addElement=function(a){this.bodyEl.appendChild(a)};f.prototype.addOption=function(a){this.options||(this.options=document.createElement("div"),this.options.classList.add("modal-options"),this.container.appendChild(this.options));
var d=document.createElement("span");d.classList.add("modal-option");var b=document.createElement("span");b.textContent=a;d.appendChild(b);this.options.appendChild(d);return d};f.prototype.addAffirmativeOption=function(a){a=this.addOption(a);a.classList.add("affirmative");return a};f.prototype.addNegativeOption=function(a){a=this.addOption(a);a.classList.add("negative");return a};f.prototype.show=function(){this.container.classList.contains("opened")||this.container.classList.add("opened");m.classList.contains("opened")||
m.classList.add("opened");a.activeWindow=this;h();a.intervalIdentifier=setInterval(h,100);g=Date.now()};f.prototype.hide=function(){this.container.classList.contains("opened")&&this.container.classList.remove("opened");m.classList.contains("opened")&&m.classList.remove("opened")};return f}();a.Window=l})(modal||(modal={}));var Objects;
(function(a){var n=[],h=function(){return function(){this.quantity=0}}();a.register=function(a,m){if(!n[a]){var l=new h;l.name=m;n[a]=l}};a.lookupName=function(a){return n[a].name};a.setQuantity=function(a,h){n[a].quantity=h};a.getQuantity=function(a){return n[a].quantity};a.setMaxQuantity=function(a,h){n[a].maxQuantity=h};a.getMaxQuantity=function(a){return n[a].maxQuantity};a.setLifeTimeTotal=function(a,h){n[a].lifeTimeTotal=h};a.getLifeTimeTotal=function(a){return n[a].lifeTimeTotal};a.setTooltip=
function(a,h){n[a].tooltip=h};a.getTooltip=function(a){return n[a].tooltip}})(Objects||(Objects={}));var Account;
(function(a){function n(){d.classList.contains("closed")||d.classList.add("closed")}function h(){var a=new modal.Window,b=document.createElement("DIV");b.style.width="400px";var d=document.createElement("DIV");d.style.marginBottom="5px";var c=document.createElement("INPUT");c.type="TEXT";c.maxLength=16;c.placeholder="Username";d.appendChild(c);var p=document.createElement("DIV");p.style.marginBottom="5px";var q=document.createElement("INPUT");q.type="PASSWORD";q.pattern=".{6,}";q.placeholder="Password";
p.appendChild(q);var f=document.createElement("DIV");f.style.marginBottom="5px";var h=document.createElement("INPUT");h.type="CHECKBOX";h.placeholder="Stay logged in on this computer?";f.appendChild(h);b.appendChild(d);b.appendChild(p);b.appendChild(f);e=document.createElement("div");a.addElement(e);a.title="Log in";a.addElement(b);a.addNegativeOption("Cancel").addEventListener("click",function(){modal.close()},!1);a.addAffirmativeOption("Submit").addEventListener("click",function(){for(l(c.value,
q.value,h.checked);e.firstChild;)e.removeChild(e.firstChild)},!1);a.show()}function g(){var a=new modal.Window,b=document.createElement("DIV");b.style.width="400px";var d=document.createElement("DIV");d.style.marginBottom="5px";var c=document.createElement("INPUT");c.type="TEXT";c.maxLength=16;c.placeholder="Username";d.appendChild(c);var e=document.createElement("DIV");e.style.marginBottom="5px";var q=document.createElement("INPUT");q.type="EMAIL";q.placeholder="Email";e.appendChild(q);var f=document.createElement("DIV");
f.style.marginBottom="5px";var h=document.createElement("INPUT");h.type="PASSWORD";h.pattern=".{6,}";h.placeholder="Password";f.appendChild(h);var u=document.createElement("DIV");u.style.marginBottom="5px";var x=document.createElement("INPUT");x.type="PASSWORD";x.pattern=".{6,}";x.placeholder="Confirm password";u.appendChild(x);x.onblur=function(){h.value!=x.value&&x.setCustomValidity("Passwords are not the same.")};x.onfocus=function(){x.setCustomValidity("")};b.appendChild(d);b.appendChild(e);b.appendChild(f);
b.appendChild(u);a.addElement(b);p=document.createElement("div");a.addElement(p);a.title="Register";a.addNegativeOption("Cancel").addEventListener("click",function(){modal.close()},!1);a.addAffirmativeOption("Submit").addEventListener("click",function(){for(m(q.value,c.value,h.value,x.value);p.firstChild;)p.removeChild(p.firstChild)},!1);a.show()}function m(a,b,c,d){$.ajax({type:"POST",url:"/Api/Account/Register",data:$.param({Email:a,UserName:b,Password:c,ConfirmPassword:d}),headers:{"Content-Type":"application/x-www-form-urlencoded"},
success:function(a){a=JSON.parse(a);if(a.Succeeded)Connection.restart(),k(),modal.close();else{for(;p.firstChild;)p.removeChild(p.firstChild);for(var b=0;b<a.Errors.length;b++){var c=document.createElement("div");c.textContent=a.Errors[b];p.appendChild(c)}}}})}function l(a,b,c){$.ajax({type:"POST",url:"/Api/Account/Login",data:$.param({UserName:a,Password:b,RememberMe:c}),headers:{"Content-Type":"application/x-www-form-urlencoded"},success:function(a){a=JSON.parse(a);if(a.Succeeded)Connection.restart(),
k(),modal.close();else{for(;e.firstChild;)e.removeChild(e.firstChild);for(var b=0;b<a.Errors.length;b++){var c=document.createElement("div");c.textContent=a.Errors[b];e.appendChild(c)}}}})}function f(){$.ajax({type:"POST",url:"/Api/Account/LogOff",headers:{"Content-Type":"application/x-www-form-urlencoded"},success:function(a){console.log(a);Connection.restart();k();location.reload()}})}function k(){$.ajax({type:"POST",url:"/Api/Account/Info",headers:{"Content-Type":"application/x-www-form-urlencoded"},
success:function(a){a=JSON.parse(a);var b=a.Anonymous;c.textContent=b?"Guest":a.UserName;Utils.cssSwap(d,b?"registered":"anonymous",b?"anonymous":"registered")}})}var d,b,c,p,e,r,v=function(){function a(){}a.prototype.failed=function(a){this.resultsElement.textContent="Loading failed..."};a.prototype.succeeded=function(a){for(;this.resultsElement.firstChild;)this.resultsElement.removeChild(this.resultsElement.firstChild);var b=document.createElement("table"),c=b.createTHead().insertRow(0);c.classList.add("table-subheader");
var d=c.insertCell(0);d.textContent="Score";d.style.width="65%";d=c.insertCell(0);d.textContent="Name";d.style.width="25%";c=c.insertCell(0);c.textContent="Rank";c.style.width="10%";for(var c=b.createTBody(),p=0;p<a.length;p++){var e=a[p];console.log(e);var f=c.insertRow(c.rows.length);f.classList.add("table-row");var u=f.insertCell(0);u.textContent=Utils.formatNumber(e.Score);u.style.width="65%";u.addEventListener("click",function(a){var b=a.target;a=b.dataset?b.dataset.tooltip:b.getAttribute("data-tooltip");
0<b.textContent.indexOf(",")?b.textContent=Utils.formatNumber(a):b.textContent=Utils.formatNumber(a,!0)});u.dataset?u.dataset.tooltip=e.Score:u.setAttribute("data-tooltip",e.Score.toString());f.insertCell(0).textContent=e.UserId;d.style.width="25%";f=f.insertCell(0);f.textContent=Utils.formatNumber(e.Rank);f.style.width="10%"}this.resultsElement.appendChild(b)};a.prototype.sendRequest=function(a,b){var c=this;$.ajax({asyn:!0,type:"POST",url:"/Api/Stats/LeaderBoard/",data:$.param({Lower:a,Upper:b}),
headers:{"Content-Type":"application/x-www-form-urlencoded"},success:function(a){a=JSON.parse(a);c.succeeded(a)},failure:function(a){c.failed(a)}})};return a}();(function(){d=document.createElement("DIV");d.classList.add("account-manager");d.classList.add("closed");d.onmouseenter=function(){clearTimeout(r)};d.onmouseleave=function(){r=setTimeout(n,250)};var a=document.createElement("DIV");a.textContent="Sign in";a.classList.add("account-option");a.classList.add("anonymous-account-option");a.addEventListener("click",
function(){h()});d.appendChild(a);a=document.createElement("DIV");a.textContent="Register";a.classList.add("account-option");a.classList.add("anonymous-account-option");a.addEventListener("click",function(){g()});d.appendChild(a);a=document.createElement("DIV");a.textContent="Options";a.classList.add("account-option");a.classList.add("registered-account-option");d.appendChild(a);a=document.createElement("DIV");a.textContent="Sign out";a.classList.add("account-option");a.classList.add("registered-account-option");
a.addEventListener("click",function(){f()});d.appendChild(a);b=document.createElement("DIV");b.classList.add("account-user");c=document.createElement("SPAN");b.appendChild(c);d.appendChild(b);document.body.appendChild(d);b.addEventListener("click",function(){d.classList.contains("closed")?d.classList.remove("closed"):d.classList.add("closed")});a=document.createElement("SPAN");a.textContent="Leaderboards";a.addEventListener("click",function(){var a=new modal.Window;a.title="Leaderboards";var b=document.createElement("DIV");
b.style.width="400px";b.textContent="Loading...";a.addElement(b);var c=new v;c.resultsElement=b;c.sendRequest(0,19);a.show()});document.getElementsByClassName("header-links")[0].appendChild(a);k()})();a.info=k})(Account||(Account={}));var Rock;
(function(a){function n(a,b){var c=a.getBoundingClientRect();return{x:b.clientX-c.left,y:b.clientY-c.top}}function h(b,c){if(b>e&&b<e+64&&c>r&&c<r+64){if(t){m(e+2,r+2,60,60);if(w)for(var d=Utils.getRandomInt(1,3),p=0;p<d;p++){var f=Utils.getRandomInt(-5,5),s=Utils.getRandomInt(-2,2);a.particles.push(new z(b+f,c+s))}w=!1}else m(e-2,r-2,68,68),w=!0;v=!0}else v&&(m(e,r,64,64),v=!1,w=!0)}function g(a,b){a!=e&&b!=r&&(e=a,r=b,p?m(a,b,64,64):setTimeout(function(){g(a,b)},10))}function m(a,d,p,e){k.clearRect(0,
0,250,250);k.drawImage(b,0,0);k.drawImage(c,a,d,p,e)}var l=document.getElementById("rock"),f=document.getElementById("particles"),k=l.getContext("2d"),d=f.getContext("2d"),b=new Image,c=new Image(16,16),p=!1,e=0,r=0,v=!1,t=!1;a.particles=[];var z=function(){function a(b,c){this.height=this.width=5;this.dispose=!1;this.x=b;this.y=c;this.verticalVelocity=Utils.getRandomInt(-100,-155);this.horizonalVelocity=Utils.getRandomInt(-50,50);this.width=Utils.getRandomInt(3,6);this.height=Utils.getRandomInt(3,
6);this.rotation=Utils.getRandomInt(0,180);this.rotationalVelocity=Utils.getRandomInt(-75,75);this.lastTick=Date.now()}a.prototype.update=function(){var a=Date.now()-this.lastTick;this.lastTick=Date.now();a/=1E3;this.rotation+=this.rotationalVelocity*a;this.y+=this.verticalVelocity*a;this.x+=this.horizonalVelocity*a;this.verticalVelocity+=200*a;270<this.y&&(this.dispose=!0)};return a}();a.Particle=z;var w=!0;a.moveRock=g;var s=document.createElement("canvas"),y=s.getContext("2d");setInterval(function(){d.clearRect(0,
0,250,250);for(var b=0;b<a.particles.length;b++){var c=a.particles[b];c.update();var p=c;s.width=p.width;s.height=p.height;y.rect(0,0,p.width,p.height);y.fillStyle="gray";y.fill();y.stroke();d.beginPath();var e=d,f=s,h=p.x,g=p.y,k=p.width,l=p.height,p=p.rotation*Math.PI/180;e.translate(h+k/2,g+l/2);e.rotate(p);e.drawImage(f,k/2*-1,l/2*-1,k,l);e.rotate(-1*p);e.translate(-1*(h+k/2),-1*(g+l/2));c.dispose&&a.particles.splice(b,1)}},10);(function(){b.onload=function(){k.drawImage(b,0,0);console.log("rock loaded")};
b.src="/Content/Rock.png";c.onload=function(){p=!0};c.src="/Content/Stone.png";l.addEventListener("mousemove",function(a){a=n(l,a);h(a.x,a.y)},!1);l.addEventListener("mousedown",function(a){a=n(l,a);t=!0;h(a.x,a.y);Connection.mine(a.x,a.y)},!1);l.addEventListener("mouseup",function(a){a=n(l,a);t=!1;h(a.x,a.y)},!1);l.addEventListener("mouseleave",function(a){a=n(l,a);t=!1;h(a.x,a.y)},!1)})()})(Rock||(Rock={}));var Tabs;
(function(a){function n(){if(l){var d=l.scrollHeight;d>window.innerHeight-a.bottomPadding&&(d=window.innerHeight-a.bottomPadding);g.style.minHeight=d+"px";g.style.maxHeight=d+"px";g.style.overflowY=d>=window.innerHeight-a.bottomPadding?"scroll":"hidden"}}var h=0,g=document.getElementById("paneContainer");a.bottomPadding=200;var m=[],l,f=new (function(){function d(a){this.container=a;this.tabs=[];this.lowestId=0;this.id=h++;m.push(this)}d.prototype.newTab=function(b){var c=new k;c.pane=b;b=document.createElement("DIV");
b.classList.add("tab-button");this.container.appendChild(b);c.button=b;0==this.lowestId?c.activate():c.deactivate();var d=this.lowestId++,e=this.id;b.addEventListener("click",function(){a.activateTab(e,d)});this.tabs.push(c);this.container.appendChild(b);return this.lowestId-1};d.prototype.activate=function(a){for(var c=0;c<this.tabs.length;c++)this.tabs[c].deactivate();this.tabs[a].activate()};d.prototype.css=function(a,c){this.tabs[a].button.classList.add(c)};return d}())(document.getElementById("tabContainer"));
a.registerGameTab=function(a,b){var c=f.newTab(a);b&&f.css(c,b)};a.updateGameTabs=n;Utils.addEvent(window,"resize",a.updateGameTabs);setInterval(n,20);a.activateTab=function(a,b){m[a].activate(b);n()};var k=function(){function a(){}a.prototype.deactivate=function(){Utils.cssSwap(this.button,"active","inactive");this.pane.style.display="none";this.pane.style.overflow="hidden"};a.prototype.activate=function(){Utils.cssSwap(this.button,"inactive","active");this.pane.style.display="block";this.pane.style.overflow=
"visible";l=this.pane};return a}()})(Tabs||(Tabs={}));var Chat;
(function(a){function n(){if(!g){g=document.createElement("DIV");g.classList.add("chat-window");g.classList.add("social");g.id="chatWindow";g.style.backgroundColor="#ebebeb";g.style.border="1px solid #adadad";var a=document.createElement("DIV");a.classList.add("chat-header");a.style.backgroundColor="rgb(160, 160, 160)";g.appendChild(a);var k=document.createElement("DIV");k.textContent="_";k.style.position="absolute";k.style.top="0";k.style.right="0";k.addEventListener("click",function(){g.classList.contains("closed")?
(g.classList.remove("closed"),k.textContent="_"):(g.classList.add("closed"),k.textContent="+")});a.appendChild(k);var d=document.createElement("DIV");d.classList.add("chat-room-tab");d.textContent="General";d.addEventListener("click",function(){document.getElementById("debugpane").style.display="none";document.getElementById("chatpane").style.display="block"});a.appendChild(d);d=document.createElement("DIV");d.classList.add("chat-room-tab");d.textContent=">Dev";d.addEventListener("click",function(){document.getElementById("debugpane").style.display=
"block";document.getElementById("chatpane").style.display="none"});d.style.display="none";a.appendChild(d);l=document.createElement("DIV");l.id="debugpane";l.classList.add("chat-room");l.style.display="none";g.appendChild(l);m=document.createElement("DIV");m.id="chatpane";m.classList.add("chat-room");g.appendChild(m);a=document.createElement("DIV");a.id="debuglog";a.classList.add("chat-room-content");l.appendChild(a);a=document.createElement("DIV");a.id="chatlog";a.classList.add("chat-room-content");
m.appendChild(a);a=document.createElement("DIV");d=document.createElement("DIV");d.classList.add("chat-textbox-container");var b=document.createElement("INPUT");b.setAttribute("TYPE","TEXT");b.classList.add("chat-textbox");b.style.borderTop="1px solid #adadad";b.setAttribute("maxlength","220");b.addEventListener("keydown",function(a){13==a.keyCode&&h();68==a.keyCode&&a.altKey&&(document.getElementById("debugtab").style.display="inline-block")});b.id="chattext";d.appendChild(b);a.appendChild(d);d=
document.createElement("DIV");d.classList.add("chat-submit-container");b=document.createElement("INPUT");b.setAttribute("TYPE","BUTTON");b.setAttribute("VALUE","SEND");b.classList.add("chat-submit");b.style.borderTop="1px solid #adadad";b.style.borderLeft="1px solid #adadad";b.addEventListener("click",function(){h()});d.appendChild(b);a.appendChild(d);g.appendChild(a);document.body.appendChild(g)}}function h(){Connection.sendGlobalMessage(document.getElementById("chattext").value);document.getElementById("chattext").value=
""}var g,m,l;a.initialize=n;n();a.log=function(a){var h=document.getElementById("debuglog"),d=document.createElement("DIV");d.textContent=a;h.appendChild(d)};a.receiveGlobalMessage=function(a,h,d,b){var c=document.getElementById("chatlog"),p=5>Math.abs(c.scrollTop-(c.scrollHeight-c.offsetHeight)),e=document.createElement("DIV");e.classList.add("chat-msg");b&&""!=b&&e.classList.add("chat-"+b);b=document.createElement("SPAN");b.textContent="["+Utils.convertServerTimeToLocal(d)+"] ";d=document.createElement("SPAN");
d.textContent=a;d.classList.add("chat-sender");a=document.createElement("SPAN");a.textContent=h;a.classList.add("chat-text");h=document.createElement("SPAN");h.textContent=": ";e.appendChild(b);e.appendChild(d);e.appendChild(h);e.appendChild(a);c.appendChild(e);p&&(c.scrollTop=c.scrollHeight)}})(Chat||(Chat={}));var tooltip;
(function(a){function n(a,b){var c=d.getBoundingClientRect(),p=c.right-c.left,c=c.bottom-c.top;d.style.left=p+(a+15)>window.innerWidth?a-p-15+"px":a+15+"px";d.style.top=0<b-c?b-c+"px":b+5+"px"}function h(){d&&d.parentElement.removeChild(d);k=d=null}function g(a,b,c){var d=new v;m(a);c&&(d.header=c);d.content=b;f.push(d);a.dataset?a.dataset.tooltip=l:a.setAttribute("data-tooltip",l.toString());l++}function m(a){a.onmouseenter=function(a){var g=+a.target.getAttribute("data-tooltip");r!==a.target&&(b=
setInterval(function(){c+=.01;if(.25<=c){var a=p,l=e,q=f[g];k!==g&&h();k=g;d=q.html;document.body.appendChild(d);n(a,l);c=0;clearInterval(b);b=null}},10));r=a.target};a.onmousemove=function(a){a=a.pageX||a.pageY?{x:a.pageX,y:a.pageY}:a.clientX||a.clientY?{x:a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,y:a.clientY+document.body.scrollTop+document.documentElement.scrollTop}:void 0;b||n(a.x,a.y);p=a.x;e=a.y};a.onmouseleave=function(a){r=null;clearInterval(b);c=0;h()}}var l=
0,f=[],k,d,b,c=0,p,e,r,v=function(){function a(){this.html=document.createElement("div");this.html.classList.add("tooltip-wrapper")}Object.defineProperty(a.prototype,"header",{get:function(){return this.html.getElementsByClassName("tooltip-header")[0]},set:function(a){a.classList.add("tooltip-header");this.html.appendChild(a)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"content",{get:function(){return this.html.getElementsByClassName("tooltip-content")[0]},set:function(a){a.classList.add("tooltip-content");
this.html.appendChild(a)},enumerable:!0,configurable:!0});return a}();a.complexModify=function(a,b,c){a=f[a];c&&(a.header.parentElement.removeChild(a.header),a.header=c);a.content.parentElement.removeChild(a.content);a.content=b};a.modify=function(a,b,c){a=f[a];c&&(a.header.textContent=c);a.content.textContent=b};a.retrieveContent=function(a){return f[a].content};a.complexCreate=g;a.create=function(a,b,c){var d=document.createElement("div");d.textContent=b;c?(b=document.createElement("div"),b.textContent=
c,g(a,d,b)):g(a,d)}})(tooltip||(tooltip={}));var Inventory;
(function(a){function n(a){Connection.sellItem(c.id,a?a:1)}function h(){var b=document.getElementById("selecteditemquantity"),c=+b.value;Utils.isNumber(c)&&c>a.getSelectedItemQuantity()&&(b.value=a.getSelectedItemQuantity().toString())}function g(){f=document.createElement("DIV");document.getElementById("paneContainer").appendChild(f);d=document.createElement("DIV");d.classList.add("selected-item");d.style.display="none";var s=document.createElement("SPAN");s.textContent="x";s.style.top="0px";s.style.right=
"3px";s.style.position="absolute";s.addEventListener("click",function(){a.selectItem()});d.appendChild(s);b=document.createElement("DIV");b.classList.add("selected-item-image");s=document.createElement("INPUT");s.id="selecteditemquantity";s.type="text";s.style.height="18px";s.classList.add("selected-item-quantity");s.addEventListener("input",function(){h()});r=Utils.createButton("Drink","");r.classList.add("selected-item-quantity");r.addEventListener("click",function(){Connection.drink(c.id);h()});
var g=Utils.createButton("Sell","");g.classList.add("selected-item-quantity");g.addEventListener("click",function(){var b=+document.getElementById("selecteditemquantity").value;Utils.isNumber(b)&&a.sellSelectedItem(b);h()});var q=Utils.createButton("Sell all","");q.classList.add("selected-item-quantity");q.addEventListener("click",function(){a.sellAllSelectedItem();h()});d.appendChild(b);d.appendChild(q);d.appendChild(g);d.appendChild(r);d.appendChild(s);f.appendChild(d);s=document.createElement("DIV");
s.style.textAlign="center";g=document.createElement("DIV");g.style.display="inline-block";q=Utils.createButton("Sell (...)","");q.addEventListener("click",function(){Connection.sellAllItems()});var l=Utils.createButton("...","");l.addEventListener("click",function(){a.toggleConfig()});g.appendChild(q);g.appendChild(l);s.appendChild(g);f.appendChild(s);e=document.createElement("DIV");e.classList.add("config-container");e.classList.add("closed");s=document.createElement("TABLE");s.classList.add("config-table");
e.appendChild(s);q=s.createTHead();g=q.insertRow(0);q=q.insertRow(0);q.classList.add("table-header");q=q.insertCell(0);q.textContent="Inventory Configuration";q.setAttribute("colspan","10");g.classList.add("table-subheader");for(var m in w)0<=parseInt(m,10)&&"NFS"!=w[m]&&(g.insertCell(g.cells.length).classList.add("config-cell-check"),q=g.insertCell(g.cells.length),q.classList.add("config-cell-name"),q.textContent=w[m]);p=s.createTBody();k=document.createElement("DIV");k.style.position="relative";
k.appendChild(e);f.appendChild(k);Tabs.registerGameTab(f,"Inventory");Equipment.draw()}function m(a){var b=document.createElement("DIV");a.container=b;b.classList.add("header-item");var c=document.createElement("DIV");c.style.width="32px";c.style.height="32px";c.style.display="inline-block";c.style.position="relative";c.style.margin="0 auto";var d=document.createElement("DIV");d.classList.add("Half-"+a.name.replace(" ","_"));c.appendChild(d);b.appendChild(c);c=document.createElement("DIV");a.quantityElm=
c;c.classList.add("item-text");c.textContent=Utils.formatNumber(0);c.style.verticalAlign="top";c.style.marginTop="8px";c.style.display="inline-block";b.appendChild(c);c=document.createElement("DIV");c.style.display="none";a.worthElm=c;b.appendChild(c);return b}function l(b){if(0==b.category||null==b.category)return m(b);var c=document.createElement("DIV");b.container=c;c.classList.add("item");c.addEventListener("click",function(){a.selectItem(b.id)});tooltip.create(c,b.name);var d=document.createElement("DIV");
d.classList.add("item-text");var e=document.createElement("DIV");e.style.verticalAlign="top";e.style.display="inline-block";e.textContent=Utils.formatNumber(b.worth);b.worthElm=e;var f=document.createElement("DIV");f.classList.add("Quarter-Coins");f.style.display="inline-block";d.appendChild(f);d.appendChild(e);c.appendChild(d);e=document.createElement("DIV");e.style.width="64px";e.style.height="64px";e.style.position="relative";e.style.margin="0 auto";d=document.createElement("DIV");d.classList.add(b.name.replace(" ",
"_"));e.appendChild(d);c.appendChild(e);d=document.createElement("DIV");b.quantityElm=d;d.classList.add("item-text");d.textContent=Utils.formatNumber(0);c.appendChild(d);if(null!=b.category){var u,h,e=p.rows.length,d=b.category,d=2*d;d--;for(f=0;f<e;f++){var g=p.rows[f].cells[d];if(g&&0==g.childElementCount){u=p.rows[f].cells[d];h=p.rows[f].cells[d-1];break}}if(!u){h=p.insertRow(p.rows.length);h.classList.add("table-row");for(var k in w)0<=parseInt(k,10)&&"NFS"!=w[k]&&(h.insertCell(h.cells.length).classList.add("config-cell-check"),
h.insertCell(h.cells.length).classList.add("config-cell-name"));u=h.cells[d];h=h.cells[d-1]}k=document.createElement("DIV");k.classList.add("item-text");k.style.height="auto";e=document.createElement("SPAN");e.style.verticalAlign="top";d=document.createElement("DIV");d.classList.add("Third-"+Utils.cssifyName(b.name));d.style.display="inline-block";t[b.id]=d;e.textContent=b.name;v[b.id]=e;k.appendChild(d);k.appendChild(e);u.appendChild(k);u=document.createElement("INPUT");u.type="CHECKBOX";var l=b.id;
a.configClickers[l]=u;u.addEventListener("change",function(b){Connection.configureItem(l,a.configClickers[l].checked)});h.appendChild(u)}return c}a.items=[];a.configClickers=[];var f,k,d,b,c,p,e,r,v=[],t=[],z=function(){return function(a,b,c,d){this.id=a;this.name=b;this.worth=c;this.category=d}}();a.Item=z;(function(a){a[a.NFS=0]="NFS";a[a.ORE=1]="ORE";a[a.GEM=2]="GEM";a[a.INGREDIENT=3]="INGREDIENT";a[a.CRAFTING=4]="CRAFTING";a[a.POTION=5]="POTION"})(a.Category||(a.Category={}));var w=a.Category;
a.getSelectedItemQuantity=function(){return c?c.quantity:0};a.selectItem=function(e){e?(null!=c&&b.classList.remove(Utils.cssifyName(c.name)),c=a.items[e],b.classList.add(Utils.cssifyName(c.name)),r.style.display=5==c.category?"inline-block":"none",h()):(b.classList.remove(Utils.cssifyName(c.name)),c=null);d.style.display=null==c?"none":"block"};a.sellSelectedItem=n;a.sellAllSelectedItem=function(){n(c.quantity)};a.modifyConfig=function(b,c){a.configClickers[b]||console.log(b);a.configClickers[b].checked=
c};a.toggleConfig=function(){e.classList.contains("closed")?e.classList.remove("closed"):e.classList.add("closed")};a.addItem=function(b,c,d,e){a.items[b]||(b=new z(b,c,d,e),a.items[b.id]=b,Objects.register(b.id,b.name),f||g(),0!=b.category&&null!=b.category?k.appendChild(l(b)):document.getElementById("headerInventory").appendChild(l(b)))};a.changePrice=function(b,c){Utils.ifNotDefault(c,function(){var d=a.items[b];d.worth=c;d.worthElm.textContent=Utils.formatNumber(c)})};a.changeQuantity=function(b,
c){Utils.ifNotDefault(c,function(){Objects.setQuantity(b,c);Crafting.update();a.items[b].quantityElm.textContent=Utils.formatNumber(c);a.items[b].quantity=c;a.items[b].container.style.display=0!=a.items[b].category&&null!=a.items[b].category?0==c?"none":"inline-block":0==Objects.getLifeTimeTotal(b)?"none":"inline-block";h()})};a.update=function(){0>=v.length||a.items.forEach(function(a){var b=Objects.getLifeTimeTotal(a.id);v[a.id]&&(v[a.id].textContent=0<b?a.name:"???");t[a.id]&&(t[a.id].style.display=
0<b?"inline-block":"none")})}})(Inventory||(Inventory={}));var Connection;
(function(a){function n(){console.log("Connection opened");var a=d.encode64();h(a);d=new Komodo.ClientActions;m=setInterval(function(){var a=d.encode64();h(a);d=new Komodo.ClientActions},1E3)}function h(a){if(a.encode64){var c=a.encode64();Chat.log("Sent "+g(c)+" bytes to komodo.");Chat.log("Decoded: ");Chat.log(JSON.stringify(a));Chat.log("Encoded: ");Chat.log(a.encode64());Komodo.send(a.encode64())}else Chat.log("Sent "+g(a)+" bytes to komodo."),Komodo.send(a)}function g(a){var c=[];a=[a];for(var d=
0;a.length;){var e=a.pop();if("boolean"===typeof e)d+=4;else if("string"===typeof e)d+=2*e.length;else if("number"===typeof e)d+=8;else if("object"===typeof e&&-1===c.indexOf(e)){c.push(e);for(var f in e)a.push(e[f])}}return d}var m,l,f,k;(function(){l=document.createElement("div");l.classList.add("error-notification-tray");l.style.display="none";f=document.createElement("div");f.classList.add("network-error");var a=document.createElement("div");a.classList.add("network-error-text");a.textContent=
"No connection";f.appendChild(a);k=document.createElement("div");k.classList.add("rate-limited");a=document.createElement("div");a.classList.add("network-error-text");a.textContent="You have exceeded your allotted requests";k.appendChild(a);a=document.getElementById("game");l.appendChild(f);l.appendChild(k);a.insertBefore(l,a.childNodes[0])})();Komodo.connection.received(function(a){Chat.log("Recieved "+g(a)+" bytes from komodo.");Chat.log("Encoded: ");Chat.log(a);Chat.log("Decoded: ");Chat.log(JSON.stringify(Komodo.decode(a)));
Chat.log(g(JSON.stringify(Komodo.decode(a)))-g(a)+" bytes saved.");a=Komodo.decode(a);if(null!=a.Messages)for(var c=a.Messages,d=0;d<c.length;d++){var e=c[d];Chat.receiveGlobalMessage(e.Sender,e.Text,e.Time,e.Permissions)}if(null!=a.GameSchema){c=a.GameSchema;if(c.Items)for(d=0;d<c.Items.length;d++)Inventory.addItem(c.Items[d].Id,c.Items[d].Name,c.Items[d].Worth,c.Items[d].Category),Statistics.addItem(c.Items[d].Id,c.Items[d].Name);if(c.StoreItems)for(d=0;d<c.StoreItems.length;d++)e=c.StoreItems[d],
Store.addItem(e.Id,e.Category,e.Price,e.Factor,e.Name,e.MaxQuantity,e.Tooltip);if(c.Processors)for(d=0;d<c.Processors.length;d++){e=c.Processors[d];Crafting.addProcessor(e.Id,e.Name);for(var f=0;f<e.Recipes.length;f++)Crafting.addProcessorRecipe(e.Id,e.Recipes[f].Ingredients,e.Recipes[f].Resultants)}if(c.CraftingItems)for(d=0;d<c.CraftingItems.length;d++)e=c.CraftingItems[d],Crafting.addRecipe(e.Id,e.Ingredients,e.Resultants,e.IsItem);if(c.Buffs)for(d=0;d<c.Buffs.length;d++)e=c.Buffs[d],Buffs.register(e.Id,
e.Name,e.Description,e.Duration)}if(null!=a.Items)for(c=a.Items,d=0;d<c.length;d++)Inventory.changeQuantity(c[d].Id,c[d].Quantity),Inventory.changePrice(c[d].Id,c[d].Worth);if(null!=a.StoreItemsUpdate)for(c=a.StoreItemsUpdate,d=0;d<c.length;d++)Store.changeQuantity(c[d].Id,c[d].Quantity,c[d].MaxQuantity,c[d].Price);if(null!=a.StatItemsUpdate)for(c=a.StatItemsUpdate,d=0;d<c.length;d++)Statistics.changeStats(c[d].Id,c[d].PrestigeQuantity,c[d].LifeTimeQuantity);if(null!=a.ConfigItems)for(c=a.ConfigItems,
d=0;d<c.length;d++)Inventory.modifyConfig(c[d].Id,c[d].Enabled);if(null!=a.Processors)for(c=a.Processors,d=0;d<c.length;d++)e=c[d],Crafting.updateProcessor(e.Id,e.SelectedRecipe,e.OperationDuration,e.CompletedOperations,e.TotalOperations,e.Capacity);null!=a.AntiCheatCoordinates&&(c=a.AntiCheatCoordinates,Rock.moveRock(c.X,c.Y));if(null!=a.Buffs)for(c=a.Buffs,d=0;d<c.length;d++)e=c[d],Buffs.update(e.Id,e.TimeActive);null!=a.IsRateLimited&&(k.style.display=a.IsRateLimited?"block":"none");if(null!=a.Gatherers)for(a=
a.Gatherers,c=0;c<a.length;c++)d=a[c],Equipment.toggleGatherer(d.Id,d.Enabled)});a.restart=function(){Komodo.restart()};var d=new Komodo.ClientActions;Komodo.connection.stateChanged(function(a){a.newState===$.signalR.connectionState.connected&&(n(),f.style.display="none");a.newState===$.signalR.connectionState.disconnected&&(clearInterval(m),f.style.display="block");a.newState===$.signalR.connectionState.reconnecting&&(f.style.display="block")});a.toggleGatherer=function(a,c){var f=new Komodo.ClientActions.GathererAction;
f.Id=a;f.Enabled=c;d.GathererActions.push(f)};a.drink=function(a){var c=new Komodo.ClientActions.PotionAction;c.Id=a;d.PotionActions.push(c)};a.mine=function(a,c){var f=new Komodo.ClientActions.MiningAction;f.X=a;f.Y=c;d.MiningActions.push(f)};a.sellItem=function(a,c){var f=new Komodo.ClientActions.InventoryAction,e=new Komodo.ClientActions.InventoryAction.SellAction;e.Id=a;e.Quantity=c;f.Sell=e;d.InventoryActions.push(f)};a.configureItem=function(a,c){var f=new Komodo.ClientActions.InventoryAction,
e=new Komodo.ClientActions.InventoryAction.ConfigAction;e.Id=a;e.Enabled=c;f.Config=e;d.InventoryActions.push(f)};a.purchaseItem=function(a,c){var f=new Komodo.ClientActions.StoreAction,e=new Komodo.ClientActions.StoreAction.PurchaseAction;e.Id=a;e.Quantity=c?c:1;f.Purchase=e;d.StoreActions.push(f)};a.sellAllItems=function(){var a=new Komodo.ClientActions.InventoryAction;a.SellAll=!0;d.InventoryActions.push(a)};a.craftRecipe=function(a,c){var f=new Komodo.ClientActions.CraftingAction;f.Id=a;f.Quantity=
c;d.CraftingActions.push(f)};a.processRecipe=function(a,c,f){var e=new Komodo.ClientActions.ProcessingAction;e.Id=a;e.RecipeIndex=c;e.Iterations=f;d.ProcessingActions.push(e)};a.sendGlobalMessage=function(a){var c=new Komodo.ClientActions.SocialAction,f=new Komodo.ClientActions.SocialAction.ChatAction;f.GlobalMessage=a;c.Chat=f;d.SocialActions.push(c)};a.send=h})(Connection||(Connection={}));var Buffs;
(function(a){var n=[],h=document.getElementById("sidebarInformation"),g,m=function(){return function(){}}();a.register=function(a,f,h,d){if(!n[a]){var b=new m;b.name=f;b.description=h;b.duration=d;n[a]=b;a=document.createElement("div");a.classList.add("buff-container");tooltip.create(a,b.description);f=document.createElement("div");f.textContent=b.name;f.classList.add("buff-header");a.appendChild(f);f=document.createElement("div");f.classList.add("buff-image-container");a.appendChild(f);h=document.createElement("div");
h.classList.add(Utils.cssifyName(b.name));f.appendChild(h);f=document.createElement("div");f.classList.add("buff-header");a.appendChild(f);g.appendChild(a);b.container=a;b.durationElm=f}};a.update=function(a,f){var h=n[a];h.timeActive=f;h.durationElm.textContent="("+Utils.formatTime(h.duration-f)+")";h.container.style.display=0==f?"none":"inline-block"};g=document.createElement("div");h.appendChild(g)})(Buffs||(Buffs={}));var Equipment;
(function(a){function n(a){var f=h[a],k=document.createElement("div");k.classList.add("equipment-gatherer-container");var d=document.createElement("div");d.textContent=Objects.lookupName(a);var b=Utils.createButton("Disable","");b.addEventListener("click",function(){Connection.toggleGatherer(a,!f.enabled)});k.appendChild(d);k.appendChild(b);f.toggleElm=b.firstChild;g.appendChild(k)}var h=[],g,m=function(){return function(){}}();a.draw=function(){g||(g=document.createElement("div"),document.getElementById("paneContainer").appendChild(g),
Tabs.registerGameTab(g,"Equipment"))};a.registerGatherer=function(a){if(!h[a]){var f=new m;h[a]=f;n(a)}};a.toggleGatherer=function(a,f){var g=h[a];g&&(console.log(f),g.enabled=f,g.toggleElm.textContent=f?"Disable":"Enable")}})(Equipment||(Equipment={}));var Store;
(function(a){function n(){g=document.createElement("div");document.getElementById("paneContainer").appendChild(g);Tabs.registerGameTab(g,"Store");for(var a in f)if(0<=parseInt(a,10)){var b=f[a];if("CRAFTING"!=b){var c=document.createElement("div");c.classList.add("store-category");l[b]=c;var h=document.createElement("div");h.textContent=b;h.classList.add("store-category-header");c.appendChild(h);g.appendChild(c)}}}function h(a){var b=document.createElement("div");"undefined"!=a.tooltip&&tooltip.create(b,
a.tooltip);b.classList.add("store-item");a.container=b;var c=document.createElement("div");c.classList.add("store-item-header");var f=document.createElement("div");f.classList.add("store-item-header-text");f.textContent=a.name;c.appendChild(f);var e=document.createElement("div");e.classList.add("store-item-header-quantity-container");var h=document.createElement("span");h.classList.add("store-item-header-quantity");var g=document.createElement("span");g.classList.add("store-item-header-quantity");
var k=document.createElement("span");k.classList.add("store-item-header-quantity");k.textContent="/";1<a.maxQuantity&&(e.appendChild(g),e.appendChild(k),e.appendChild(h));c.appendChild(e);a.maxQuantityElm=h;a.quantityElm=g;a.nameElm=f;b.appendChild(c);c=document.createElement("DIV");c.style.width="64px";c.style.height="64px";c.style.position="relative";c.style.margin="0 auto";f=document.createElement("DIV");f.classList.add(Utils.cssifyName(a.name));c.appendChild(f);b.appendChild(c);c=document.createElement("div");
c.classList.add("store-item-footer");f=document.createElement("div");f.classList.add("item-text");e=document.createElement("div");e.textContent=Utils.formatNumber(a.price);e.style.display="inline-block";e.style.verticalAlign="top";a.priceElm=e;h=document.createElement("div");h.classList.add("Quarter-Coins");h.style.display="inline-block";f.appendChild(h);f.appendChild(e);var e=document.createElement("div"),h=Utils.createButton("Buy",""),l=a.id;if(5!=a.category)h.addEventListener("click",function(){Connection.purchaseItem(l)});
else{var m=document.createElement("INPUT");m.type="TEXT";m.style.width="40px";m.style.height="15px";e.appendChild(m);h.addEventListener("click",function(){Utils.isNumber(m.value)&&Connection.purchaseItem(l,+m.value)})}e.appendChild(h);c.appendChild(e);c.appendChild(f);b.appendChild(c);return b}var g,m=[],l=[];(function(a){a[a.MINING=1]="MINING";a[a.MACHINES=2]="MACHINES";a[a.GATHERING=3]="GATHERING";a[a.PROCESSING=4]="PROCESSING";a[a.ITEMS=5]="ITEMS";a[a.CRAFTING=6]="CRAFTING"})(a.Category||(a.Category=
{}));var f=a.Category,k=function(){return function(){}}();a.tempFix=function(){n()};a.addItem=function(a,b,c,p,e,r,v){g||n();if(!m[a]){Objects.register(a,e);var t=new k;t.id=a;t.category=b;t.price=c;t.factor=p;t.name=e;t.tooltip=v;t.maxQuantity=r?r:0;Objects.register(t.id,t.name);Objects.setTooltip(t.id,t.tooltip);2==t.category&&Equipment.registerGatherer(t.id);b=l[f[b]];null==b&&(b=l.MINING);6!=t.category&&b.appendChild(h(t));m[a]=t}};a.changeQuantity=function(a,b,c,f){var e=m[a];Utils.ifNotDefault(c,
function(){if(0!=c)try{e.maxQuantity=c,e.maxQuantityElm.textContent=c.toString()}catch(a){}});Utils.ifNotDefault(b,function(){Objects.setQuantity(a,b);e.quantity=b;Crafting.update();0!=c&&6!=e.category&&(e.container.style.display=-1>=e.quantity||e.quantity>=e.maxQuantity&&0<e.maxQuantity?"none":"inline-block",e.maxQuantity&&1<e.maxQuantity&&(e.quantityElm.textContent=b.toString()))});Utils.ifNotDefault(f,function(){e.priceElm&&(e.price=f,e.priceElm.textContent=Utils.formatNumber(f))})}})(Store||(Store=
{}));var Statistics;
(function(a){function n(){var a=document.createElement("TABLE"),h=a.createTHead(),d=h.insertRow(0);d.classList.add("table-header");d=d.insertCell(0);d.textContent="Item Statistics";d.setAttribute("colspan","3");h=h.insertRow(1);h.classList.add("table-subheader");d=h.insertCell(0);d.textContent="Lifetime Quantity";d.style.width="40%";d=h.insertCell(0);d.textContent="Prestige Quantity";d.style.width="40%";h=h.insertCell(0);h.textContent="Item";h.style.width="20%";g=a.createTBody();return a}var h,g,
m=[],l=function(){return function(){}}();a.changeStats=function(a,h,d){var b=m[a];Utils.ifNotDefault(h,function(){b.prestigeQuantity=h;b.prestigeRow.textContent=Utils.formatNumber(h)});Utils.ifNotDefault(d,function(){b.lifetimeQuantity=d;Objects.setLifeTimeTotal(a,d);b.alltimeRow.textContent=Utils.formatNumber(d)})};a.addItem=function(a,k){h||(h=document.createElement("DIV"),document.getElementById("paneContainer").appendChild(h),Tabs.registerGameTab(h,"Statistics"),h.appendChild(n()));if(!m[a]){var d=
new l;m[a]=d;var b=g.insertRow(g.rows.length);b.classList.add("table-row");d.alltimeRow=b.insertCell(0);d.alltimeRow.style.width="40%";d.prestigeRow=b.insertCell(0);d.prestigeRow.style.width="40%";d=b.insertCell(0);d.style.width="20%";b=document.createElement("DIV");b.classList.add("Third-"+Utils.cssifyName(k));b.style.display="inline-block";d.appendChild(b)}}})(Statistics||(Statistics={}));var Crafting;
(function(a){function n(){f=document.createElement("DIV");document.getElementById("paneContainer").appendChild(f);Tabs.registerGameTab(f,"Crafting");k=document.createElement("DIV");f.appendChild(k);d=document.createElement("DIV");f.appendChild(d);b=document.createElement("TABLE");b.classList.add("block-table");var a=b.createTHead(),h=a.insertRow(0);h.classList.add("table-subheader");a=a.insertRow(0);a.classList.add("table-header");a=a.insertCell(0);a.colSpan=c.length;a.textContent="Crafting Table";
for(a=0;a<c.length;a++){var g=h.insertCell(0);g.style.width=p[a];g.textContent=c[a];"0"!=e[a]&&(g.style.minWidth=e[a])}h=b.insertRow(2);h.classList.add("table-subheader");h=h.insertCell(0);h.colSpan=c.length;h.textContent="Items";h=b.insertRow(3);h.classList.add("table-subheader");h=h.insertCell(0);h.colSpan=c.length;h.textContent="Upgrades";d.appendChild(b)}function h(c,d){var b=a.processors[c];if(b){var e=b._recipes[d];for(b.selectedRecipe=d;b.recipeList.lastChild;)b.recipeList.removeChild(b.recipeList.lastChild);
for(var h=0;h<e.ingredients.length;h++){var f=document.createElement("DIV");f.classList.add("item-text");f.style.height="30px";var g=document.createElement("DIV");g.style.display="inline-block";var k=document.createElement("DIV");e.ingredients[h].quantityDiv=k;k.style.display="inline-block";k.style.verticalAlign="super";k.style.color=e.ingredients[h].quantity<=Objects.getQuantity(e.ingredients[h].id)?"darkgreen":"darkred";k.textContent=Utils.formatNumber(e.ingredients[h].quantity);g.classList.add("Half-"+
Utils.cssifyName(Objects.lookupName(e.ingredients[h].id)));f.appendChild(g);f.appendChild(k);b.recipeList.appendChild(f)}}}function g(a){var d=document.createElement("TABLE");d.classList.add("block-table");var b=d.createTHead(),e=b.insertRow(0);e.classList.add("table-subheader");b=b.insertRow(0);b.classList.add("table-header");b=b.insertCell(0);b.colSpan=c.length;b.textContent=a.name;for(b=0;b<c.length;b++){var f=e.insertCell(0);f.style.width=v[b];f.textContent=r[b];"0"!=v[b]&&(f.style.minWidth=t[b])}b=
d.insertRow(2);b.classList.add("table-row");b=b.insertCell(0);b.colSpan=r.length;f=document.createElement("DIV");f.classList.add("progress-bar-container");e=document.createElement("DIV");e.classList.add("progress-bar");var g=document.createElement("DIV");g.classList.add("progress-bar-text-container");var l=document.createElement("DIV");l.classList.add("progress-bar-text");g.appendChild(l);f.appendChild(g);a.progressBar=e;a.progressText=l;f.appendChild(e);b.appendChild(f);e=d.insertRow(3);e.classList.add("table-row");
for(b=0;b<r.length;b++){f=e.insertCell(0);f.style.width=p[b];f.style.height="75px";"0"!=t[b]&&(f.style.minWidth=t[b]);"Image"==r[b]&&(g=document.createElement("DIV"),g.classList.add(Utils.cssifyName(a.name)),g.style.margin="0 auto",f.appendChild(g));"Capacity"==r[b]&&(f.textContent="0",a.capacityElm=f);"Input"==r[b]&&(a.recipeList=f);if("Output"==r[b]){g=Utils.createButton("Max","");f.appendChild(g);g=document.createElement("INPUT");g.type="TEXT";g.style.width="35px";a.quantityTextbox=g;f.appendChild(g);
var n=a.id,q=document.createElement("SELECT");q.addEventListener("change",function(a){h(n,q.selectedIndex)});a.recipeSelector=q;f.appendChild(q)}"Action"==r[b]&&(g=Utils.createButton("Activate",""),g.addEventListener("click",function(){Utils.isNumber(a.quantityTextbox.value)&&Connection.processRecipe(a.id,a.recipeSelector.selectedIndex,+a.quantityTextbox.value)},!1),f.appendChild(g))}m(a);k.appendChild(d)}function m(a){y||(y=document.createElement("div"),s.appendChild(y));var b=document.createElement("div");
b.classList.add("processor-sidebar");a.sidebarContainer=b;var c=document.createElement("div");c.classList.add("buff-header");c.textContent=a.name;b.appendChild(c);c=document.createElement("div");c.classList.add("processor-sidebar-progress-bar-container");var d=document.createElement("div");d.classList.add("processor-sidebar-progress-bar");a.sidebarProgressBar=d;var e=document.createElement("div");e.classList.add("processor-sidebar-progress-text");a.sidebarProgressText=e;c.appendChild(e);c.appendChild(d);
b.appendChild(c);c=document.createElement("div");c.classList.add("processor-sidebar-progress-bar-container");d=document.createElement("div");d.classList.add("processor-sidebar-progress-bar");a.sidebarJobBar=d;e=document.createElement("div");e.classList.add("processor-sidebar-progress-text");a.sidebarJobText=e;c.appendChild(e);c.appendChild(d);b.appendChild(c);b.style.display="none";y.appendChild(b)}function l(a,d){var f=b.rows.length;d&&(f=z,z++);f=b.insertRow(f);f.classList.add("table-row");a.row=
f;for(var h=0;h<c.length;h++){var g=f.insertCell(0);g.style.width=p[h];"0"!=e[h]&&(g.style.minWidth=e[h]);"Name"==c[h]&&(g.textContent=Objects.lookupName(a.id));if("Input"==c[h])for(var k=0;k<a.ingredients.length;k++){var l=document.createElement("DIV");l.classList.add("item-text");l.style.height="auto";var m=document.createElement("DIV");m.style.display="inline-block";var n=document.createElement("DIV");a.ingredients[k].quantityDiv=n;n.style.display="inline-block";n.style.verticalAlign="super";n.textContent=
Utils.formatNumber(a.ingredients[k].quantity);m.classList.add("Third-"+Utils.cssifyName(Objects.lookupName(a.ingredients[k].id)));l.appendChild(m);l.appendChild(n);g.appendChild(l)}"Description"==c[h]&&(g.textContent=Objects.getTooltip(a.resultants[0].id));if("Output"==c[h])for(k=0;k<a.resultants.length;k++)l=document.createElement("DIV"),l.classList.add("item-text"),l.style.height="auto",m=document.createElement("DIV"),m.style.display="inline-block",n=document.createElement("DIV"),n.style.display=
"inline-block",n.style.verticalAlign="super",n.textContent=Utils.formatNumber(a.resultants[k].quantity),m.classList.add("Third-"+Utils.cssifyName(Objects.lookupName(a.resultants[k].id))),l.appendChild(m),a.isItem&&l.appendChild(n),g.appendChild(l);if("Action"==c[h]&&(k=Utils.createButton("Craft",""),k.addEventListener("click",function(){Connection.craftRecipe(a.id,1)},!1),g.appendChild(k),a.isItem)){var q=document.createElement("INPUT");q.type="TEXT";q.style.width="30px";k=Utils.createButton("Craft-x",
"");k.addEventListener("click",function(){Connection.craftRecipe(a.id,+q.value)},!1);g.appendChild(k);g.appendChild(q)}}}var f,k,d,b,c=["Action","Description","Input","Output","Name"],p=["10%","50%","15%","15%","10%"],e=["170px","0","0","0","0"],r=["Action","Output","Input","Capacity","Image"],v=["10%","30%","20%","20%","20%"],t=["170px","0","0","0","0"],z=3,w=[];a.processors=[];var s=document.getElementById("sidebarInformation"),y,q=function(){function a(){this._recipes=[]}a.prototype.addRecipe=
function(a){this._recipes.push(a);this.selectedRecipe||(this.selectedRecipe=0)};return a}();a.Processor=q;var B=function(){function a(){this.ingredients=[];this.resultants=[]}a.prototype.addIngredient=function(a){this.ingredients.push(a)};a.prototype.addResultant=function(a){this.resultants.push(a)};return a}();a.Recipe=B;var A=function(){return function(a,b){this.id=a;this.quantity=b}}();a.Ingredient=A;a.addRecipe=function(a,b,c,d){f||n();if(!w[a]){var e=new B;e.id=a;e.isItem=d;w[a]=e;for(a=0;a<
b.length;a++)e.addIngredient(new A(b[a].Id,b[a].Quantity));for(a=0;a<c.length;a++)e.addResultant(new A(c[a].Id,c[a].Quantity));l(e,d)}};a.addProcessor=function(b,c){f||n();if(!a.processors[b]){var d=new q;d.id=b;d.name=c;a.processors[b]=d;g(d)}};a.addProcessorRecipe=function(b,c,d){if(a.processors[b]){var e=a.processors[b],f;a:if(a.processors[b]){f=a.processors[b];for(var g=0;g<f._recipes.length;g++)if(d[0].Id==f._recipes[g].resultants[0].id){f=!0;break a}f=!1}else f=void 0;if(!f){f=new B;for(g=0;g<
c.length;g++)f.addIngredient(new A(c[g].Id,c[g].Quantity));for(g=0;g<d.length;g++)f.addResultant(new A(d[g].Id,d[g].Quantity));e.addRecipe(f);c=document.createElement("OPTION");c.textContent=Objects.lookupName(d[0].Id);e.recipeSelector.appendChild(c);1==e._recipes.length&&h(b,0)}}};a.updateProcessor=function(b,c,d,e,f,h){var g=a.processors[b];if(g){var k=!1;Utils.ifNotDefault(c,function(){g.selectedRecipe=c});Utils.ifNotDefault(f,function(){g.totalOperations=f;k=!0});Utils.ifNotDefault(d,function(){g.operationDuration=
d});Utils.ifNotDefault(h,function(){g.capacityElm.textContent=h.toString()});Utils.ifNotDefault(e,function(){g.completedOperations=e;k=!0});if(k){if(0>=g.totalOperations||g.completedOperations==g.totalOperations){g.progressBar.style.width="0%";g.progressText.textContent="";g.sidebarProgressText.textContent="";g.sidebarContainer.style.display="none";g.totalOperationCompletionTime=0;return}g.sidebarContainer.style.display="inline-block";g.operationStartTime=Date.now();g.operationCompletionTime=g.operationStartTime+
1E3*g.operationDuration;0==g.totalOperationCompletionTime&&(g.totalOperationCompletionTime=g.operationStartTime+1E3*g.operationDuration*(g.totalOperations-g.completedOperations))}if(-1<g.selectedRecipe)try{g.progressText.textContent=Objects.lookupName(g._recipes[g.selectedRecipe].resultants[0].id)+" ("+g.completedOperations+"/"+g.totalOperations+")",g.sidebarJobText.textContent=Objects.lookupName(g._recipes[g.selectedRecipe].resultants[0].id)+" ("+g.completedOperations+"/"+g.totalOperations+")"}catch(l){console.log("invalid processor recipe "+
g.selectedRecipe)}else g.progressText.textContent="",g.sidebarProgressText.textContent=""}};setInterval(function(){a.processors.forEach(function(a){if(0>=a.operationDuration)a.progressBar.style.width="0%";else if(a.completedOperations!=a.totalOperations&&0<a.totalOperations){var b=a.operationCompletionTime-Date.now(),b=b/1E3,c=a.totalOperationCompletionTime-Date.now(),d=c/(a.operationDuration*a.totalOperations),b=b/a.operationDuration,b=100-100*b;a.progressBar.style.width=b+"%";a.sidebarJobBar.style.width=
b+"%";a.sidebarProgressBar.style.width=100-d/10+"%";a.sidebarProgressText.textContent=Utils.formatTime(c/1E3)}})},10);a.update=function(){f&&(w.forEach(function(a){var b=Objects.getQuantity(a.id);a.row.style.display=-1==b||!a.isItem&&0<b?"none":"";a.ingredients.forEach(function(a){var b=Objects.getQuantity(a.id);a.quantityDiv.style.color=b>=a.quantity?"darkgreen":"darkred"})}),a.processors.forEach(function(a){h(a.id,a.recipeSelector.selectedIndex)}))}})(Crafting||(Crafting={}));
