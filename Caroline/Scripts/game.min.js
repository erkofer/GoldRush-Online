var Utils;
(function(a){a.addEvent=function(a,h,d){null!=a&&"undefined"!=typeof a&&(a.addEventListener?a.addEventListener(h,d,!1):a.attachEvent?a.attachEvent("on"+h,d):a["on"+h]=d)};a.cssSwap=function(a,h,d){a.classList.contains(h)&&a.classList.remove(h);a.classList.add(d)};a.cssifyName=function(a){return a.split(" ").join("_")};a.ifNotDefault=function(a,h){-100!=a&&h()};a.createButton=function(a,h){var d,q;d=document.createElement("div");q=document.createElement("div");q.textContent=a;h&&(q.id=h);d.classList.add("button");
d.appendChild(q);return d};a.isNumber=function(a){return!isNaN(parseFloat(a))};a.formatNumber=function(a,h){"undefined"===typeof h&&(h=!1);return a?h?a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","):999999999999999<a?(a/1E15).toFixed(3)+"Qa":999999999999<a?(a/1E12).toFixed(3)+"T":999999999<a?(a/1E9).toFixed(3)+"B":999999<a?(a/1E6).toFixed(3)+"M":a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","):"0"};a.getRandomInt=function(a,h){return Math.floor(Math.random()*(h-a+1))+a};a.formatTime=function(a){var h=
Math.floor(a/3600),d=Math.floor(a%3600/60);a=Math.floor(a%60);return(10>h?1>h?"":"0"+h+":":h+":")+(10>d?"0"+d+":":d+":")+(10>a?"0"+a:a+"")};a.convertServerTimeToLocal=function(a){var h=+a.split(":")[0],d=+a.split(":")[1].split(" ")[0];"PM"==a.split(":")[1].split(" ")[1]&&(h+=12);a=(new Date).getTimezoneOffset();h-=a/60-a%60;d-=a%60;0>h&&(h=24-h);0>d&&(d=60-d,h--);23<h&&(h-=24);59<d&&(d-=60,h++);return(10>h?"0":"")+h+":"+(10>d?"0":"")+d}})(Utils||(Utils={}));var tooltip;
(function(a){function n(a,f){var c=b.getBoundingClientRect(),r=c.right-c.left,c=c.bottom-c.top;b.style.left=r+(a+15)>window.innerWidth?a-r-15+"px":a+15+"px";b.style.top=0<f-c?f-c+"px":f+5+"px"}function h(){b&&b.parentElement.removeChild(b);m=b=null}function d(a,f,c){var b=new u;q(a);c&&(b.header=c);b.content=f;k.push(b);a.dataset?a.dataset.tooltip=p:a.setAttribute("data-tooltip",p.toString());p++}function q(a){a.onmouseenter=function(a){var s=+a.target.getAttribute("data-tooltip");g!==a.target&&(e=
setInterval(function(){f+=.01;if(.25<=f){var a=l,g=c,d=k[s];m!==s&&h();m=s;b=d.html;document.body.appendChild(b);n(a,g);f=0;clearInterval(e);e=null}},10));g=a.target};a.onmousemove=function(a){a=a.pageX||a.pageY?{x:a.pageX,y:a.pageY}:a.clientX||a.clientY?{x:a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,y:a.clientY+document.body.scrollTop+document.documentElement.scrollTop}:void 0;e||n(a.x,a.y);l=a.x;c=a.y};a.onmouseleave=function(a){g=null;clearInterval(e);f=0;h()}}var p=
0,k=[],m,b,e,f=0,l,c,g,u=function(){function a(){this.html=document.createElement("div");this.html.classList.add("tooltip-wrapper")}Object.defineProperty(a.prototype,"header",{get:function(){return this.html.getElementsByClassName("tooltip-header")[0]},set:function(a){a.classList.add("tooltip-header");this.html.appendChild(a)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"content",{get:function(){return this.html.getElementsByClassName("tooltip-content")[0]},set:function(a){a.classList.add("tooltip-content");
this.html.appendChild(a)},enumerable:!0,configurable:!0});return a}();a.complexModify=function(a,f,c){a=k[a];c&&(a.header.parentElement.removeChild(a.header),a.header=c);a.content.parentElement.removeChild(a.content);a.content=f};a.modify=function(a,f,c){a=k[a];c&&(a.header.textContent=c);a.content.textContent=f};a.retrieveContent=function(a){return k[a].content};a.complexCreate=d;a.create=function(a,f,c){var b=document.createElement("div");b.textContent=f;c?(f=document.createElement("div"),f.textContent=
c,d(a,b,f)):d(a,b)}})(tooltip||(tooltip={}));var Chat;
(function(a){function n(){if(!d){d=document.createElement("DIV");d.classList.add("chat-window");d.classList.add("social");d.id="chatWindow";d.style.backgroundColor="#ebebeb";d.style.border="1px solid #adadad";var a=document.createElement("DIV");a.classList.add("chat-header");a.style.backgroundColor="rgb(160, 160, 160)";d.appendChild(a);var m=document.createElement("DIV");m.textContent="_";m.style.position="absolute";m.style.top="0";m.style.right="0";m.addEventListener("click",function(){d.classList.contains("closed")?
(d.classList.remove("closed"),m.textContent="_"):(d.classList.add("closed"),m.textContent="+")});a.appendChild(m);var b=document.createElement("DIV");b.classList.add("chat-room-tab");b.textContent="General";b.addEventListener("click",function(){document.getElementById("debugpane").style.display="none";document.getElementById("chatpane").style.display="block"});a.appendChild(b);b=document.createElement("DIV");b.classList.add("chat-room-tab");b.textContent=">Dev";b.addEventListener("click",function(){document.getElementById("debugpane").style.display=
"block";document.getElementById("chatpane").style.display="none"});b.style.display="none";a.appendChild(b);p=document.createElement("DIV");p.id="debugpane";p.classList.add("chat-room");p.style.display="none";d.appendChild(p);q=document.createElement("DIV");q.id="chatpane";q.classList.add("chat-room");d.appendChild(q);a=document.createElement("DIV");a.id="debuglog";a.classList.add("chat-room-content");p.appendChild(a);a=document.createElement("DIV");a.id="chatlog";a.classList.add("chat-room-content");
q.appendChild(a);a=document.createElement("DIV");b=document.createElement("DIV");b.classList.add("chat-textbox-container");var e=document.createElement("INPUT");e.setAttribute("TYPE","TEXT");e.classList.add("chat-textbox");e.style.borderTop="1px solid #adadad";e.setAttribute("maxlength","220");e.addEventListener("keydown",function(a){13==a.keyCode&&h();68==a.keyCode&&a.altKey&&(document.getElementById("debugtab").style.display="inline-block")});e.id="chattext";b.appendChild(e);a.appendChild(b);b=
document.createElement("DIV");b.classList.add("chat-submit-container");e=document.createElement("INPUT");e.setAttribute("TYPE","BUTTON");e.setAttribute("VALUE","SEND");e.classList.add("chat-submit");e.style.borderTop="1px solid #adadad";e.style.borderLeft="1px solid #adadad";e.addEventListener("click",function(){h()});b.appendChild(e);a.appendChild(b);d.appendChild(a);document.body.appendChild(d)}}function h(){Connection.sendGlobalMessage(document.getElementById("chattext").value);document.getElementById("chattext").value=
""}var d,q,p;a.initialize=n;n();a.log=function(a){var d=document.getElementById("debuglog"),b=document.createElement("DIV");b.textContent=a;d.appendChild(b)};a.receiveGlobalMessage=function(a,d,b,e){var f=document.getElementById("chatlog"),l=5>Math.abs(f.scrollTop-(f.scrollHeight-f.offsetHeight)),c=document.createElement("DIV");c.classList.add("chat-msg");e&&""!=e&&c.classList.add("chat-"+e);e=document.createElement("SPAN");e.textContent="["+Utils.convertServerTimeToLocal(b)+"] ";b=document.createElement("SPAN");
b.textContent=a;b.classList.add("chat-sender");a=document.createElement("SPAN");a.textContent=d;a.classList.add("chat-text");d=document.createElement("SPAN");d.textContent=": ";c.appendChild(e);c.appendChild(b);c.appendChild(d);c.appendChild(a);f.appendChild(c);l&&(f.scrollTop=f.scrollHeight)}})(Chat||(Chat={}));var Tabs;
(function(a){function n(){if(p){var b=p.scrollHeight;b>window.innerHeight-a.bottomPadding&&(b=window.innerHeight-a.bottomPadding);d.style.minHeight=b+"px";d.style.maxHeight=b+"px";d.style.overflowY=b>=window.innerHeight-a.bottomPadding?"scroll":"hidden"}}var h=0,d=document.getElementById("paneContainer");a.bottomPadding=200;var q=[],p,k=new (function(){function b(a){this.container=a;this.tabs=[];this.lowestId=0;this.id=h++;q.push(this)}b.prototype.newTab=function(b){var f=new m;f.pane=b;b=document.createElement("DIV");
b.classList.add("tab-button");this.container.appendChild(b);f.button=b;0==this.lowestId?f.activate():f.deactivate();var l=this.lowestId++,c=this.id;b.addEventListener("click",function(){a.activateTab(c,l)});this.tabs.push(f);this.container.appendChild(b);return this.lowestId-1};b.prototype.activate=function(a){for(var b=0;b<this.tabs.length;b++)this.tabs[b].deactivate();this.tabs[a].activate()};b.prototype.css=function(a,b){this.tabs[a].button.classList.add(b)};return b}())(document.getElementById("tabContainer"));
a.registerGameTab=function(a,e){var f=k.newTab(a);e&&k.css(f,e)};a.updateGameTabs=n;Utils.addEvent(window,"resize",a.updateGameTabs);setInterval(n,20);a.activateTab=function(a,e){q[a].activate(e);n()};var m=function(){function a(){}a.prototype.deactivate=function(){Utils.cssSwap(this.button,"active","inactive");this.pane.style.display="none";this.pane.style.overflow="hidden"};a.prototype.activate=function(){Utils.cssSwap(this.button,"inactive","active");this.pane.style.display="block";this.pane.style.overflow=
"visible";p=this.pane};return a}()})(Tabs||(Tabs={}));var Objects;
(function(a){var n=[],h=function(){return function(){this.quantity=0}}();a.register=function(a,q){if(!n[a]){var p=new h;p.name=q;n[a]=p}};a.lookupName=function(a){return n[a].name};a.setQuantity=function(a,h){n[a].quantity=h};a.getQuantity=function(a){return n[a].quantity};a.setMaxQuantity=function(a,h){n[a].maxQuantity=h};a.getMaxQuantity=function(a){return n[a].maxQuantity};a.setLifeTimeTotal=function(a,h){n[a].lifeTimeTotal=h};a.getLifeTimeTotal=function(a){return n[a].lifeTimeTotal};a.setTooltip=
function(a,h){n[a].tooltip=h};a.getTooltip=function(a){return n[a].tooltip}})(Objects||(Objects={}));var Inventory;
(function(a){function n(a){Connection.sellItem(f.id,a?a:1)}function h(){var c=document.getElementById("selecteditemquantity"),b=+c.value;Utils.isNumber(b)&&b>a.getSelectedItemQuantity()&&(c.value=a.getSelectedItemQuantity().toString())}function d(){k=document.createElement("DIV");document.getElementById("paneContainer").appendChild(k);b=document.createElement("DIV");b.classList.add("selected-item");b.style.display="none";var r=document.createElement("SPAN");r.textContent="x";r.style.top="0px";r.style.right=
"3px";r.style.position="absolute";r.addEventListener("click",function(){a.selectItem()});b.appendChild(r);e=document.createElement("DIV");e.classList.add("selected-item-image");r=document.createElement("INPUT");r.id="selecteditemquantity";r.type="text";r.style.height="18px";r.classList.add("selected-item-quantity");r.addEventListener("input",function(){h()});g=Utils.createButton("Drink","");g.classList.add("selected-item-quantity");g.addEventListener("click",function(){Connection.drink(f.id);h()});
var d=Utils.createButton("Sell","");d.classList.add("selected-item-quantity");d.addEventListener("click",function(){var c=+document.getElementById("selecteditemquantity").value;Utils.isNumber(c)&&a.sellSelectedItem(c);h()});var t=Utils.createButton("Sell all","");t.classList.add("selected-item-quantity");t.addEventListener("click",function(){a.sellAllSelectedItem();h()});b.appendChild(e);b.appendChild(t);b.appendChild(d);b.appendChild(g);b.appendChild(r);k.appendChild(b);r=document.createElement("DIV");
r.style.textAlign="center";d=document.createElement("DIV");d.style.display="inline-block";t=Utils.createButton("Sell (...)","");t.addEventListener("click",function(){Connection.sellAllItems()});var s=Utils.createButton("...","");s.addEventListener("click",function(){a.toggleConfig()});d.appendChild(t);d.appendChild(s);r.appendChild(d);k.appendChild(r);c=document.createElement("DIV");c.classList.add("config-container");c.classList.add("closed");r=document.createElement("TABLE");r.classList.add("config-table");
c.appendChild(r);t=r.createTHead();d=t.insertRow(0);t=t.insertRow(0);t.classList.add("table-header");t=t.insertCell(0);t.textContent="Inventory Configuration";t.setAttribute("colspan","10");d.classList.add("table-subheader");for(var A in v)0<=parseInt(A,10)&&"NFS"!=v[A]&&(d.insertCell(d.cells.length).classList.add("config-cell-check"),t=d.insertCell(d.cells.length),t.classList.add("config-cell-name"),t.textContent=v[A]);l=r.createTBody();m=document.createElement("DIV");m.style.position="relative";
m.appendChild(c);k.appendChild(m);Tabs.registerGameTab(k,"Inventory");Equipment.draw()}function q(a){var c=document.createElement("DIV");a.container=c;c.classList.add("header-item");var b=document.createElement("DIV");b.style.width="32px";b.style.height="32px";b.style.display="inline-block";b.style.position="relative";b.style.margin="0 auto";var f=document.createElement("DIV");f.classList.add("Half-"+a.name.replace(" ","_"));b.appendChild(f);c.appendChild(b);b=document.createElement("DIV");a.quantityElm=
b;b.classList.add("item-text");b.textContent=Utils.formatNumber(0);b.style.verticalAlign="top";b.style.marginTop="8px";b.style.display="inline-block";c.appendChild(b);b=document.createElement("DIV");b.style.display="none";a.worthElm=b;c.appendChild(b);return c}function p(b){if(0==b.category||null==b.category)return q(b);var c=document.createElement("DIV");b.container=c;c.classList.add("item");c.addEventListener("click",function(){a.selectItem(b.id)});tooltip.create(c,b.name);var f=document.createElement("DIV");
f.classList.add("item-text");var e=document.createElement("DIV");e.style.verticalAlign="top";e.style.display="inline-block";e.textContent=Utils.formatNumber(b.worth);b.worthElm=e;var g=document.createElement("DIV");g.classList.add("Quarter-Coins");g.style.display="inline-block";f.appendChild(g);f.appendChild(e);c.appendChild(f);e=document.createElement("DIV");e.style.width="64px";e.style.height="64px";e.style.position="relative";e.style.margin="0 auto";f=document.createElement("DIV");f.classList.add(b.name.replace(" ",
"_"));e.appendChild(f);c.appendChild(e);f=document.createElement("DIV");b.quantityElm=f;f.classList.add("item-text");f.textContent=Utils.formatNumber(0);c.appendChild(f);if(null!=b.category){var z,w,e=l.rows.length,f=b.category,f=2*f;f--;for(g=0;g<e;g++){var d=l.rows[g].cells[f];if(d&&0==d.childElementCount){z=l.rows[g].cells[f];w=l.rows[g].cells[f-1];break}}if(!z){w=l.insertRow(l.rows.length);w.classList.add("table-row");for(var k in v)0<=parseInt(k,10)&&"NFS"!=v[k]&&(w.insertCell(w.cells.length).classList.add("config-cell-check"),
w.insertCell(w.cells.length).classList.add("config-cell-name"));z=w.cells[f];w=w.cells[f-1]}k=document.createElement("DIV");k.classList.add("item-text");k.style.height="auto";e=document.createElement("SPAN");e.style.verticalAlign="top";f=document.createElement("DIV");f.classList.add("Third-"+Utils.cssifyName(b.name));f.style.display="inline-block";s[b.id]=f;e.textContent=b.name;u[b.id]=e;k.appendChild(f);k.appendChild(e);z.appendChild(k);z=document.createElement("INPUT");z.type="CHECKBOX";var m=b.id;
a.configClickers[m]=z;z.addEventListener("change",function(b){Connection.configureItem(m,a.configClickers[m].checked)});w.appendChild(z)}return c}a.items=[];a.configClickers=[];var k,m,b,e,f,l,c,g,u=[],s=[],x=function(){return function(a,b,f,c){this.id=a;this.name=b;this.worth=f;this.category=c}}();a.Item=x;(function(a){a[a.NFS=0]="NFS";a[a.ORE=1]="ORE";a[a.GEM=2]="GEM";a[a.INGREDIENT=3]="INGREDIENT";a[a.CRAFTING=4]="CRAFTING";a[a.POTION=5]="POTION"})(a.Category||(a.Category={}));var v=a.Category;
a.getSelectedItemQuantity=function(){return f?f.quantity:0};a.selectItem=function(c){c?(null!=f&&e.classList.remove(Utils.cssifyName(f.name)),f=a.items[c],e.classList.add(Utils.cssifyName(f.name)),g.style.display=5==f.category?"inline-block":"none",h()):(e.classList.remove(Utils.cssifyName(f.name)),f=null);b.style.display=null==f?"none":"block"};a.sellSelectedItem=n;a.sellAllSelectedItem=function(){n(f.quantity)};a.modifyConfig=function(b,c){a.configClickers[b]||console.log(b);a.configClickers[b].checked=
c};a.toggleConfig=function(){c.classList.contains("closed")?c.classList.remove("closed"):c.classList.add("closed")};a.addItem=function(b,c,f,e){a.items[b]||(b=new x(b,c,f,e),a.items[b.id]=b,Objects.register(b.id,b.name),k||d(),0!=b.category&&null!=b.category?m.appendChild(p(b)):document.getElementById("headerInventory").appendChild(p(b)))};a.changePrice=function(b,c){Utils.ifNotDefault(c,function(){var f=a.items[b];f.worth=c;f.worthElm.textContent=Utils.formatNumber(c)})};a.changeQuantity=function(b,
c){Utils.ifNotDefault(c,function(){Objects.setQuantity(b,c);Crafting.update();a.items[b].quantityElm.textContent=Utils.formatNumber(c);a.items[b].quantity=c;a.items[b].container.style.display=0!=a.items[b].category&&null!=a.items[b].category?0==c?"none":"inline-block":0==Objects.getLifeTimeTotal(b)?"none":"inline-block";h()})};a.update=function(){0>=u.length||a.items.forEach(function(a){var b=Objects.getLifeTimeTotal(a.id);u[a.id]&&(u[a.id].textContent=0<b?a.name:"???");s[a.id]&&(s[a.id].style.display=
0<b?"inline-block":"none")})}})(Inventory||(Inventory={}));var Statistics;
(function(a){function n(){var a=document.createElement("TABLE"),m=a.createTHead(),b=m.insertRow(0);b.classList.add("table-header");b=b.insertCell(0);b.textContent="Item Statistics";b.setAttribute("colspan","3");m=m.insertRow(1);m.classList.add("table-subheader");b=m.insertCell(0);b.textContent="Lifetime Quantity";b.style.width="40%";b=m.insertCell(0);b.textContent="Prestige Quantity";b.style.width="40%";m=m.insertCell(0);m.textContent="Item";m.style.width="20%";d=a.createTBody();return a}var h,d,
q=[],p=function(){return function(){}}();a.changeStats=function(a,d,b){var e=q[a];Utils.ifNotDefault(d,function(){e.prestigeQuantity=d;e.prestigeRow.textContent=Utils.formatNumber(d)});Utils.ifNotDefault(b,function(){e.lifetimeQuantity=b;Objects.setLifeTimeTotal(a,b);e.alltimeRow.textContent=Utils.formatNumber(b)})};a.addItem=function(a,m){h||(h=document.createElement("DIV"),document.getElementById("paneContainer").appendChild(h),Tabs.registerGameTab(h,"Statistics"),h.appendChild(n()));if(!q[a]){var b=
new p;q[a]=b;var e=d.insertRow(d.rows.length);e.classList.add("table-row");b.alltimeRow=e.insertCell(0);b.alltimeRow.style.width="40%";b.prestigeRow=e.insertCell(0);b.prestigeRow.style.width="40%";b=e.insertCell(0);b.style.width="20%";e=document.createElement("DIV");e.classList.add("Third-"+Utils.cssifyName(m));e.style.display="inline-block";b.appendChild(e)}}})(Statistics||(Statistics={}));var Store;
(function(a){function n(){d=document.createElement("div");document.getElementById("paneContainer").appendChild(d);Tabs.registerGameTab(d,"Store");for(var a in k)if(0<=parseInt(a,10)){var e=k[a];if("CRAFTING"!=e){var f=document.createElement("div");f.classList.add("store-category");p[e]=f;var l=document.createElement("div");l.textContent=e;l.classList.add("store-category-header");f.appendChild(l);d.appendChild(f)}}}function h(a){var e=document.createElement("div");"undefined"!=a.tooltip&&tooltip.create(e,
a.tooltip);e.classList.add("store-item");a.container=e;var f=document.createElement("div");f.classList.add("store-item-header");var l=document.createElement("div");l.classList.add("store-item-header-text");l.textContent=a.name;f.appendChild(l);var c=document.createElement("div");c.classList.add("store-item-header-quantity-container");var g=document.createElement("span");g.classList.add("store-item-header-quantity");var d=document.createElement("span");d.classList.add("store-item-header-quantity");
var k=document.createElement("span");k.classList.add("store-item-header-quantity");k.textContent="/";1<a.maxQuantity&&(c.appendChild(d),c.appendChild(k),c.appendChild(g));f.appendChild(c);a.maxQuantityElm=g;a.quantityElm=d;a.nameElm=l;e.appendChild(f);f=document.createElement("DIV");f.style.width="64px";f.style.height="64px";f.style.position="relative";f.style.margin="0 auto";l=document.createElement("DIV");l.classList.add(Utils.cssifyName(a.name));f.appendChild(l);e.appendChild(f);f=document.createElement("div");
f.classList.add("store-item-footer");l=document.createElement("div");l.classList.add("item-text");c=document.createElement("div");c.textContent=Utils.formatNumber(a.price);c.style.display="inline-block";c.style.verticalAlign="top";a.priceElm=c;g=document.createElement("div");g.classList.add("Quarter-Coins");g.style.display="inline-block";l.appendChild(g);l.appendChild(c);var c=document.createElement("div"),g=Utils.createButton("Buy",""),m=a.id;if(5!=a.category)g.addEventListener("click",function(){Connection.purchaseItem(m)});
else{var h=document.createElement("INPUT");h.type="TEXT";h.style.width="40px";h.style.height="15px";c.appendChild(h);g.addEventListener("click",function(){Utils.isNumber(h.value)&&Connection.purchaseItem(m,+h.value)})}c.appendChild(g);f.appendChild(c);f.appendChild(l);e.appendChild(f);return e}var d,q=[],p=[];(function(a){a[a.MINING=1]="MINING";a[a.MACHINES=2]="MACHINES";a[a.GATHERING=3]="GATHERING";a[a.PROCESSING=4]="PROCESSING";a[a.ITEMS=5]="ITEMS";a[a.CRAFTING=6]="CRAFTING"})(a.Category||(a.Category=
{}));var k=a.Category,m=function(){return function(){}}();a.tempFix=function(){n()};a.addItem=function(a,e,f,l,c,g,u){d||n();if(!q[a]){Objects.register(a,c);var s=new m;s.id=a;s.category=e;s.price=f;s.factor=l;s.name=c;s.tooltip=u;s.maxQuantity=g?g:0;Objects.register(s.id,s.name);Objects.setTooltip(s.id,s.tooltip);2==s.category&&Equipment.registerGatherer(s.id);e=p[k[e]];null==e&&(e=p.MINING);6!=s.category&&e.appendChild(h(s));q[a]=s}};a.changeQuantity=function(a,e,f,l){var c=q[a];Utils.ifNotDefault(f,
function(){if(0!=f)try{c.maxQuantity=f,c.maxQuantityElm.textContent=f.toString()}catch(a){}});Utils.ifNotDefault(e,function(){Objects.setQuantity(a,e);c.quantity=e;Crafting.update();0!=f&&6!=c.category&&(c.container.style.display=-1>=c.quantity||c.quantity>=c.maxQuantity&&0<c.maxQuantity?"none":"inline-block",c.maxQuantity&&1<c.maxQuantity&&(c.quantityElm.textContent=e.toString()))});Utils.ifNotDefault(l,function(){c.priceElm&&(c.price=l,c.priceElm.textContent=Utils.formatNumber(l))})}})(Store||(Store=
{}));var Rock;
(function(a){function n(){if(c){var b=Date.now(),f=b-v,f=f/1E3;v=b;a.currentNotifier=a.growing?a.currentNotifier+8*f:a.currentNotifier-8*f;if(4<a.currentNotifier||-4>a.currentNotifier)a.growing=!a.growing;p(g,u,64+a.currentNotifier,64+a.currentNotifier);a.notTouched&&setTimeout(n,10)}else setTimeout(n,10)}function h(a,c){var b=a.getBoundingClientRect();return{x:c.clientX-b.left,y:c.clientY-b.top}}function d(c,b){if(c>g&&c<g+64&&b>u&&b<u+64){if(x){p(g+2,u+2,60,60);if(y)for(var f=Utils.getRandomInt(1,3),
e=0;e<f;e++){var l=Utils.getRandomInt(-5,5),d=Utils.getRandomInt(-2,2);a.particles.push(new r(c+l,b+d))}y=!1}else p(g-2,u-2,68,68),y=!0;a.notTouched=!1;s=!0}else s&&(p(g,u,64,64),s=!1,y=!0);k.style.cursor=s?"pointer":"initial"}function q(a,b){a!=g&&b!=u&&(g=a,u=b,c?p(a,b,64,64):setTimeout(function(){q(a,b)},10))}function p(a,c,e,g){b.clearRect(0,0,250,250);b.drawImage(f,0,0);b.drawImage(l,a,c,e,g)}var k=document.getElementById("rock"),m=document.getElementById("particles"),b=k.getContext("2d"),e=
m.getContext("2d"),f=new Image,l=new Image(16,16),c=!1,g=0,u=0,s=!1,x=!1;a.notTouched=!0;a.growing=!0;a.currentNotifier=0;var v=Date.now();a.particles=[];var r=function(){function a(c,b){this.height=this.width=5;this.dispose=!1;this.x=c;this.y=b;this.verticalVelocity=Utils.getRandomInt(-100,-155);this.horizonalVelocity=Utils.getRandomInt(-50,50);this.width=Utils.getRandomInt(3,6);this.height=Utils.getRandomInt(3,6);this.rotation=Utils.getRandomInt(0,180);this.rotationalVelocity=Utils.getRandomInt(-75,
75);this.lastTick=Date.now()}a.prototype.update=function(){var a=Date.now()-this.lastTick;this.lastTick=Date.now();a/=1E3;this.rotation+=this.rotationalVelocity*a;this.y+=this.verticalVelocity*a;this.x+=this.horizonalVelocity*a;this.verticalVelocity+=200*a;270<this.y&&(this.dispose=!0)};return a}();a.Particle=r;n();var y=!0;a.moveRock=q;var t=document.createElement("canvas"),B=t.getContext("2d");setInterval(function(){e.clearRect(0,0,250,250);for(var c=0;c<a.particles.length;c++){var b=a.particles[c];
b.update();var f=b;t.width=f.width;t.height=f.height;B.rect(0,0,f.width,f.height);B.fillStyle="gray";B.fill();B.stroke();e.beginPath();var l=e,g=t,d=f.x,k=f.y,h=f.width,m=f.height,f=f.rotation*Math.PI/180;l.translate(d+h/2,k+m/2);l.rotate(f);l.drawImage(g,h/2*-1,m/2*-1,h,m);l.rotate(-1*f);l.translate(-1*(d+h/2),-1*(k+m/2));b.dispose&&a.particles.splice(c,1)}},10);(function(){f.onload=function(){b.drawImage(f,0,0);console.log("rock loaded")};f.src="/Content/Rock.png";l.onload=function(){c=!0};l.src=
"/Content/Stone.png";k.addEventListener("mousemove",function(a){a=h(k,a);d(a.x,a.y)},!1);k.addEventListener("mousedown",function(a){a=h(k,a);x=!0;d(a.x,a.y);Connection.mine(a.x,a.y)},!1);k.addEventListener("mouseup",function(a){a=h(k,a);x=!1;d(a.x,a.y)},!1);k.addEventListener("mouseleave",function(a){a=h(k,a);x=!1;d(a.x,a.y)},!1)})()})(Rock||(Rock={}));var Equipment;
(function(a){function n(a){var k=h[a],m=document.createElement("div");m.classList.add("equipment-gatherer-container");var b=document.createElement("div");b.textContent=Objects.lookupName(a);var e=Utils.createButton("Disable","");e.addEventListener("click",function(){Connection.toggleGatherer(a,!k.enabled)});m.appendChild(b);m.appendChild(e);k.toggleElm=e.firstChild;d.appendChild(m)}var h=[],d,q=function(){return function(){}}();a.draw=function(){d||(d=document.createElement("div"),document.getElementById("paneContainer").appendChild(d),
Tabs.registerGameTab(d,"Equipment"))};a.registerGatherer=function(a){if(!h[a]){var d=new q;h[a]=d;n(a)}};a.toggleGatherer=function(a,d){var m=h[a];m&&(m.enabled=d,m.toggleElm.textContent=d?"Disable":"Enable")}})(Equipment||(Equipment={}));var Crafting;
(function(a){function n(){k=document.createElement("DIV");document.getElementById("paneContainer").appendChild(k);Tabs.registerGameTab(k,"Crafting");m=document.createElement("DIV");k.appendChild(m);b=document.createElement("DIV");k.appendChild(b);e=document.createElement("TABLE");e.classList.add("block-table");var a=e.createTHead(),d=a.insertRow(0);d.classList.add("table-subheader");a=a.insertRow(0);a.classList.add("table-header");a=a.insertCell(0);a.colSpan=f.length;a.textContent="Crafting Table";
for(a=0;a<f.length;a++){var g=d.insertCell(0);g.style.width=l[a];g.textContent=f[a];"0"!=c[a]&&(g.style.minWidth=c[a])}d=e.insertRow(2);d.classList.add("table-subheader");d=d.insertCell(0);d.colSpan=f.length;d.textContent="Items";d=e.insertRow(3);d.classList.add("table-subheader");d=d.insertCell(0);d.colSpan=f.length;d.textContent="Upgrades";b.appendChild(e)}function h(c,b){var f=a.processors[c];if(f){var e=f._recipes[b];for(f.selectedRecipe=b;f.recipeList.lastChild;)f.recipeList.removeChild(f.recipeList.lastChild);
for(var l=0;l<e.ingredients.length;l++){var d=document.createElement("DIV");d.classList.add("item-text");d.style.height="30px";var g=document.createElement("DIV");g.style.display="inline-block";var h=document.createElement("DIV");e.ingredients[l].quantityDiv=h;h.style.display="inline-block";h.style.verticalAlign="super";h.style.color=e.ingredients[l].quantity<=Objects.getQuantity(e.ingredients[l].id)?"darkgreen":"darkred";h.textContent=Utils.formatNumber(e.ingredients[l].quantity);g.classList.add("Half-"+
Utils.cssifyName(Objects.lookupName(e.ingredients[l].id)));d.appendChild(g);d.appendChild(h);f.recipeList.appendChild(d)}}}function d(a){var c=document.createElement("TABLE");c.classList.add("block-table");var b=c.createTHead(),e=b.insertRow(0);e.classList.add("table-subheader");b=b.insertRow(0);b.classList.add("table-header");b=b.insertCell(0);b.colSpan=f.length;b.textContent=a.name;for(b=0;b<f.length;b++){var d=e.insertCell(0);d.style.width=u[b];d.textContent=g[b];"0"!=u[b]&&(d.style.minWidth=s[b])}b=
c.insertRow(2);b.classList.add("table-row");b=b.insertCell(0);b.colSpan=g.length;d=document.createElement("DIV");d.classList.add("progress-bar-container");e=document.createElement("DIV");e.classList.add("progress-bar");var k=document.createElement("DIV");k.classList.add("progress-bar-text-container");var r=document.createElement("DIV");r.classList.add("progress-bar-text");k.appendChild(r);d.appendChild(k);a.progressBar=e;a.progressText=r;d.appendChild(e);b.appendChild(d);e=c.insertRow(3);e.classList.add("table-row");
for(b=0;b<g.length;b++){d=e.insertCell(0);d.style.width=l[b];d.style.height="75px";"0"!=s[b]&&(d.style.minWidth=s[b]);"Image"==g[b]&&(k=document.createElement("DIV"),k.classList.add(Utils.cssifyName(a.name)),k.style.margin="0 auto",d.appendChild(k));"Capacity"==g[b]&&(d.textContent="0",a.capacityElm=d);"Input"==g[b]&&(a.recipeList=d);if("Output"==g[b]){k=Utils.createButton("Max","");d.appendChild(k);k=document.createElement("INPUT");k.type="TEXT";k.style.width="35px";a.quantityTextbox=k;d.appendChild(k);
var p=a.id,n=document.createElement("SELECT");n.addEventListener("change",function(a){h(p,n.selectedIndex)});a.recipeSelector=n;d.appendChild(n)}"Action"==g[b]&&(k=Utils.createButton("Activate",""),k.addEventListener("click",function(){Utils.isNumber(a.quantityTextbox.value)&&Connection.processRecipe(a.id,a.recipeSelector.selectedIndex,+a.quantityTextbox.value)},!1),d.appendChild(k))}q(a);m.appendChild(c)}function q(a){y||(y=document.createElement("div"),r.appendChild(y));var b=document.createElement("div");
b.classList.add("processor-sidebar");a.sidebarContainer=b;var c=document.createElement("div");c.classList.add("buff-header");c.textContent=a.name;b.appendChild(c);c=document.createElement("div");c.classList.add("processor-sidebar-progress-bar-container");var f=document.createElement("div");f.classList.add("processor-sidebar-progress-bar");a.sidebarProgressBar=f;var d=document.createElement("div");d.classList.add("processor-sidebar-progress-text");a.sidebarProgressText=d;c.appendChild(d);c.appendChild(f);
b.appendChild(c);c=document.createElement("div");c.classList.add("processor-sidebar-progress-bar-container");f=document.createElement("div");f.classList.add("processor-sidebar-progress-bar");a.sidebarJobBar=f;d=document.createElement("div");d.classList.add("processor-sidebar-progress-text");a.sidebarJobText=d;c.appendChild(d);c.appendChild(f);b.appendChild(c);b.style.display="none";y.appendChild(b)}function p(a,b){var d=e.rows.length;b&&(d=x,x++);d=e.insertRow(d);d.classList.add("table-row");a.row=
d;for(var g=0;g<f.length;g++){var k=d.insertCell(0);k.style.width=l[g];"0"!=c[g]&&(k.style.minWidth=c[g]);"Name"==f[g]&&(k.textContent=Objects.lookupName(a.id));if("Input"==f[g])for(var h=0;h<a.ingredients.length;h++){var m=document.createElement("DIV");m.classList.add("item-text");m.style.height="auto";var s=document.createElement("DIV");s.style.display="inline-block";var r=document.createElement("DIV");a.ingredients[h].quantityDiv=r;r.style.display="inline-block";r.style.verticalAlign="super";r.textContent=
Utils.formatNumber(a.ingredients[h].quantity);s.classList.add("Third-"+Utils.cssifyName(Objects.lookupName(a.ingredients[h].id)));m.appendChild(s);m.appendChild(r);k.appendChild(m)}"Description"==f[g]&&(k.textContent=Objects.getTooltip(a.resultants[0].id));if("Output"==f[g])for(h=0;h<a.resultants.length;h++)m=document.createElement("DIV"),m.classList.add("item-text"),m.style.height="auto",s=document.createElement("DIV"),s.style.display="inline-block",r=document.createElement("DIV"),r.style.display=
"inline-block",r.style.verticalAlign="super",r.textContent=Utils.formatNumber(a.resultants[h].quantity),s.classList.add("Third-"+Utils.cssifyName(Objects.lookupName(a.resultants[h].id))),m.appendChild(s),a.isItem&&m.appendChild(r),k.appendChild(m);if("Action"==f[g]&&(h=Utils.createButton("Craft",""),h.addEventListener("click",function(){Connection.craftRecipe(a.id,1)},!1),k.appendChild(h),a.isItem)){var p=document.createElement("INPUT");p.type="TEXT";p.style.width="30px";h=Utils.createButton("Craft-x",
"");h.addEventListener("click",function(){Connection.craftRecipe(a.id,+p.value)},!1);k.appendChild(h);k.appendChild(p)}}}var k,m,b,e,f=["Action","Description","Input","Output","Name"],l=["10%","50%","15%","15%","10%"],c=["170px","0","0","0","0"],g=["Action","Output","Input","Capacity","Image"],u=["10%","30%","20%","20%","20%"],s=["170px","0","0","0","0"],x=3,v=[];a.processors=[];var r=document.getElementById("sidebarInformation"),y,t=function(){function a(){this._recipes=[]}a.prototype.addRecipe=
function(a){this._recipes.push(a);this.selectedRecipe||(this.selectedRecipe=0)};return a}();a.Processor=t;var B=function(){function a(){this.ingredients=[];this.resultants=[]}a.prototype.addIngredient=function(a){this.ingredients.push(a)};a.prototype.addResultant=function(a){this.resultants.push(a)};return a}();a.Recipe=B;var A=function(){return function(a,b){this.id=a;this.quantity=b}}();a.Ingredient=A;a.addRecipe=function(a,b,c,f){k||n();if(!v[a]){var d=new B;d.id=a;d.isItem=f;v[a]=d;for(a=0;a<
b.length;a++)d.addIngredient(new A(b[a].Id,b[a].Quantity));for(a=0;a<c.length;a++)d.addResultant(new A(c[a].Id,c[a].Quantity));p(d,f)}};a.addProcessor=function(b,c){k||n();if(!a.processors[b]){var f=new t;f.id=b;f.name=c;a.processors[b]=f;d(f)}};a.addProcessorRecipe=function(b,c,f){if(a.processors[b]){var d=a.processors[b],e;a:if(a.processors[b]){e=a.processors[b];for(var l=0;l<e._recipes.length;l++)if(f[0].Id==e._recipes[l].resultants[0].id){e=!0;break a}e=!1}else e=void 0;if(!e){e=new B;for(l=0;l<
c.length;l++)e.addIngredient(new A(c[l].Id,c[l].Quantity));for(l=0;l<f.length;l++)e.addResultant(new A(f[l].Id,f[l].Quantity));d.addRecipe(e);c=document.createElement("OPTION");c.textContent=Objects.lookupName(f[0].Id);d.recipeSelector.appendChild(c);1==d._recipes.length&&h(b,0)}}};a.updateProcessor=function(b,c,f,d,e,l){var g=a.processors[b];if(g){var k=!1;Utils.ifNotDefault(c,function(){g.selectedRecipe=c});Utils.ifNotDefault(e,function(){g.totalOperations=e;k=!0});Utils.ifNotDefault(f,function(){g.operationDuration=
f});Utils.ifNotDefault(l,function(){g.capacityElm.textContent=l.toString()});Utils.ifNotDefault(d,function(){g.completedOperations=d;k=!0});if(k){if(0>=g.totalOperations||g.completedOperations==g.totalOperations){g.progressBar.style.width="0%";g.progressText.textContent="";g.sidebarProgressText.textContent="";g.sidebarContainer.style.display="none";g.totalOperationCompletionTime=0;return}g.sidebarContainer.style.display="inline-block";g.operationStartTime=Date.now();g.operationCompletionTime=g.operationStartTime+
1E3*g.operationDuration;0==g.totalOperationCompletionTime&&(g.totalOperationCompletionTime=g.operationStartTime+1E3*g.operationDuration*(g.totalOperations-g.completedOperations))}if(-1<g.selectedRecipe)try{g.progressText.textContent=Objects.lookupName(g._recipes[g.selectedRecipe].resultants[0].id)+" ("+g.completedOperations+"/"+g.totalOperations+")",g.sidebarJobText.textContent=Objects.lookupName(g._recipes[g.selectedRecipe].resultants[0].id)+" ("+g.completedOperations+"/"+g.totalOperations+")"}catch(h){console.log("invalid processor recipe "+
g.selectedRecipe)}else g.progressText.textContent="",g.sidebarProgressText.textContent=""}};setInterval(function(){a.processors.forEach(function(a){if(0>=a.operationDuration)a.progressBar.style.width="0%";else if(a.completedOperations!=a.totalOperations&&0<a.totalOperations){var b=a.operationCompletionTime-Date.now(),b=b/1E3,c=a.totalOperationCompletionTime-Date.now(),f=c/(a.operationDuration*a.totalOperations),b=b/a.operationDuration,b=100-100*b;a.progressBar.style.width=b+"%";a.sidebarJobBar.style.width=
b+"%";a.sidebarProgressBar.style.width=100-f/10+"%";a.sidebarProgressText.textContent=Utils.formatTime(c/1E3)}})},10);a.update=function(){k&&(v.forEach(function(a){var b=Objects.getQuantity(a.id);a.row.style.display=-1==b||!a.isItem&&0<b?"none":"";a.ingredients.forEach(function(a){var b=Objects.getQuantity(a.id);a.quantityDiv.style.color=b>=a.quantity?"darkgreen":"darkred"})}),a.processors.forEach(function(a){h(a.id,a.recipeSelector.selectedIndex)}))}})(Crafting||(Crafting={}));var Buffs;
(function(a){var n=[],h=document.getElementById("sidebarInformation"),d,q=function(){return function(){}}();a.register=function(a,k,h,b){if(!n[a]){var e=new q;e.name=k;e.description=h;e.duration=b;n[a]=e;a=document.createElement("div");a.classList.add("buff-container");tooltip.create(a,e.description);k=document.createElement("div");k.textContent=e.name;k.classList.add("buff-header");a.appendChild(k);k=document.createElement("div");k.classList.add("buff-image-container");a.appendChild(k);h=document.createElement("div");
h.classList.add(Utils.cssifyName(e.name));k.appendChild(h);k=document.createElement("div");k.classList.add("buff-header");a.appendChild(k);d.appendChild(a);e.container=a;e.durationElm=k}};a.update=function(a,d){var h=n[a];h.timeActive=d;h.durationElm.textContent="("+Utils.formatTime(h.duration-d)+")";h.container.style.display=0==d?"none":"inline-block"};d=document.createElement("div");h.appendChild(d)})(Buffs||(Buffs={}));var Account;
(function(a){function n(){b.classList.contains("closed")||b.classList.add("closed")}function h(){var a=new modal.Window,b=document.createElement("DIV");b.style.width="400px";var f=document.createElement("DIV");f.style.marginBottom="5px";var d=document.createElement("INPUT");d.type="TEXT";d.maxLength=16;d.placeholder="Username";f.appendChild(d);var g=document.createElement("DIV");g.style.marginBottom="5px";var e=document.createElement("INPUT");e.type="PASSWORD";e.pattern=".{6,}";e.placeholder="Password";
g.appendChild(e);var l=document.createElement("DIV");l.style.marginBottom="5px";var h=document.createElement("INPUT");h.type="CHECKBOX";h.placeholder="Stay logged in on this computer?";l.appendChild(h);b.appendChild(f);b.appendChild(g);b.appendChild(l);c=document.createElement("div");a.addElement(c);a.title="Log in";a.addElement(b);a.addNegativeOption("Cancel").addEventListener("click",function(){modal.close()},!1);a.addAffirmativeOption("Submit").addEventListener("click",function(){for(p(d.value,
e.value,h.checked);c.firstChild;)c.removeChild(c.firstChild)},!1);a.show()}function d(){var a=new modal.Window,b=document.createElement("DIV");b.style.width="400px";var c=document.createElement("DIV");c.style.marginBottom="5px";var f=document.createElement("INPUT");f.type="TEXT";f.maxLength=16;f.placeholder="Username";c.appendChild(f);var d=document.createElement("DIV");d.style.marginBottom="5px";var g=document.createElement("INPUT");g.type="EMAIL";g.placeholder="Email";d.appendChild(g);var e=document.createElement("DIV");
e.style.marginBottom="5px";var h=document.createElement("INPUT");h.type="PASSWORD";h.pattern=".{6,}";h.placeholder="Password";e.appendChild(h);var k=document.createElement("DIV");k.style.marginBottom="5px";var m=document.createElement("INPUT");m.type="PASSWORD";m.pattern=".{6,}";m.placeholder="Confirm password";k.appendChild(m);m.onblur=function(){h.value!=m.value&&m.setCustomValidity("Passwords are not the same.")};m.onfocus=function(){m.setCustomValidity("")};b.appendChild(c);b.appendChild(d);b.appendChild(e);
b.appendChild(k);a.addElement(b);l=document.createElement("div");a.addElement(l);a.title="Register";a.addNegativeOption("Cancel").addEventListener("click",function(){modal.close()},!1);a.addAffirmativeOption("Submit").addEventListener("click",function(){for(q(g.value,f.value,h.value,m.value);l.firstChild;)l.removeChild(l.firstChild)},!1);a.show()}function q(a,b,c,f){$.ajax({type:"POST",url:"/Api/Account/Register",data:$.param({Email:a,UserName:b,Password:c,ConfirmPassword:f}),headers:{"Content-Type":"application/x-www-form-urlencoded"},
success:function(a){a=JSON.parse(a);if(a.Succeeded)Connection.restart(),m(),modal.close();else{for(;l.firstChild;)l.removeChild(l.firstChild);for(var b=0;b<a.Errors.length;b++){var c=document.createElement("div");c.textContent=a.Errors[b];l.appendChild(c)}}}})}function p(a,b,f){$.ajax({type:"POST",url:"/Api/Account/Login",data:$.param({UserName:a,Password:b,RememberMe:f}),headers:{"Content-Type":"application/x-www-form-urlencoded"},success:function(a){a=JSON.parse(a);if(a.Succeeded)Connection.restart(),
m(),modal.close();else{for(;c.firstChild;)c.removeChild(c.firstChild);for(var b=0;b<a.Errors.length;b++){var f=document.createElement("div");f.textContent=a.Errors[b];c.appendChild(f)}}}})}function k(){$.ajax({type:"POST",url:"/Api/Account/LogOff",headers:{"Content-Type":"application/x-www-form-urlencoded"},success:function(a){console.log(a);Connection.restart();m();location.reload()}})}function m(){$.ajax({type:"POST",url:"/Api/Account/Info",headers:{"Content-Type":"application/x-www-form-urlencoded"},
success:function(a){a=JSON.parse(a);var c=a.Anonymous;f.textContent=c?"Guest":a.UserName;Utils.cssSwap(b,c?"registered":"anonymous",c?"anonymous":"registered")}})}var b,e,f,l,c,g,u=function(){function a(){}a.prototype.failed=function(a){this.resultsElement.textContent="Loading failed..."};a.prototype.succeeded=function(a){for(;this.resultsElement.firstChild;)this.resultsElement.removeChild(this.resultsElement.firstChild);var b=document.createElement("table"),c=b.createTHead().insertRow(0);c.classList.add("table-subheader");
var f=c.insertCell(0);f.textContent="Score";f.style.width="65%";f=c.insertCell(0);f.textContent="Name";f.style.width="25%";c=c.insertCell(0);c.textContent="Rank";c.style.width="10%";for(var c=b.createTBody(),d=0;d<a.length;d++){var g=a[d];console.log(g);var e=c.insertRow(c.rows.length);e.classList.add("table-row");var l=e.insertCell(0);l.textContent=Utils.formatNumber(g.Score);l.style.width="65%";l.addEventListener("click",function(a){var b=a.target;a=b.dataset?b.dataset.tooltip:b.getAttribute("data-tooltip");
0<b.textContent.indexOf(",")?b.textContent=Utils.formatNumber(a):b.textContent=Utils.formatNumber(a,!0)});l.dataset?l.dataset.tooltip=g.Score:l.setAttribute("data-tooltip",g.Score.toString());e.insertCell(0).textContent=g.UserId;f.style.width="25%";e=e.insertCell(0);e.textContent=Utils.formatNumber(g.Rank);e.style.width="10%"}this.resultsElement.appendChild(b)};a.prototype.sendRequest=function(a,b){var c=this;$.ajax({asyn:!0,type:"POST",url:"/Api/Stats/LeaderBoard/",data:$.param({Lower:a,Upper:b}),
headers:{"Content-Type":"application/x-www-form-urlencoded"},success:function(a){a=JSON.parse(a);c.succeeded(a)},failure:function(a){c.failed(a)}})};return a}();(function(){b=document.createElement("DIV");b.classList.add("account-manager");b.classList.add("closed");b.onmouseenter=function(){clearTimeout(g)};b.onmouseleave=function(){g=setTimeout(n,250)};var a=document.createElement("DIV");a.textContent="Sign in";a.classList.add("account-option");a.classList.add("anonymous-account-option");a.addEventListener("click",
function(){h()});b.appendChild(a);a=document.createElement("DIV");a.textContent="Register";a.classList.add("account-option");a.classList.add("anonymous-account-option");a.addEventListener("click",function(){d()});b.appendChild(a);a=document.createElement("DIV");a.textContent="Options";a.classList.add("account-option");a.classList.add("registered-account-option");b.appendChild(a);a=document.createElement("DIV");a.textContent="Sign out";a.classList.add("account-option");a.classList.add("registered-account-option");
a.addEventListener("click",function(){k()});b.appendChild(a);e=document.createElement("DIV");e.classList.add("account-user");f=document.createElement("SPAN");e.appendChild(f);b.appendChild(e);document.body.appendChild(b);e.addEventListener("click",function(){b.classList.contains("closed")?b.classList.remove("closed"):b.classList.add("closed")});a=document.createElement("SPAN");a.textContent="Leaderboards";a.addEventListener("click",function(){var a=new modal.Window;a.title="Leaderboards";var b=document.createElement("DIV");
b.style.width="400px";b.textContent="Loading...";a.addElement(b);var c=new u;c.resultsElement=b;c.sendRequest(0,19);a.show()});a.style.cursor="pointer";document.getElementsByClassName("header-links")[0].appendChild(a);m()})();a.info=m})(Account||(Account={}));var modal;
(function(a){function n(){a.activeWindow&&a.activeWindow.hide();a.activeWindow=null}function h(){if(a.activeWindow){var d=a.activeWindow.container.getBoundingClientRect();a.activeWindow.container.style.left=window.innerWidth/2-(d.right-d.left)/2+"px";a.activeWindow.container.style.top=window.innerHeight/2-(d.bottom-d.top)/2+"px"}else clearInterval(a.intervalIdentifier)}var d=0,q;a.activeWindow;a.intervalIdentifier;a.hide=n;a.close=function(){if(a.activeWindow){var d=a.activeWindow;n();d.container.parentNode.removeChild(d.container)}};
var p=function(){function k(){this.container=document.createElement("div");this.container.addEventListener("click",function(a){a.stopPropagation()},!1);this.container.classList.add("modal-window");if(!q){var h=document.createElement("div");q=h;h.classList.add("modal-wrapper");h.addEventListener("click",function(b){b.stopPropagation();3E3<Date.now()-d&&a.close()},!1);document.body.appendChild(h)}q.appendChild(this.container);this.titleEl=document.createElement("div");this.titleEl.classList.add("modal-header");
this.bodyEl=document.createElement("div");this.container.appendChild(this.titleEl);this.container.appendChild(this.bodyEl)}Object.defineProperty(k.prototype,"title",{get:function(){return this._title},set:function(a){this._title=a;this.titleEl.textContent=this._title},enumerable:!0,configurable:!0});k.prototype.addElement=function(a){this.bodyEl.appendChild(a)};k.prototype.addOption=function(a){this.options||(this.options=document.createElement("div"),this.options.classList.add("modal-options"),this.container.appendChild(this.options));
var b=document.createElement("span");b.classList.add("modal-option");var d=document.createElement("span");d.textContent=a;b.appendChild(d);this.options.appendChild(b);return b};k.prototype.addAffirmativeOption=function(a){a=this.addOption(a);a.classList.add("affirmative");return a};k.prototype.addNegativeOption=function(a){a=this.addOption(a);a.classList.add("negative");return a};k.prototype.show=function(){this.container.classList.contains("opened")||this.container.classList.add("opened");q.classList.contains("opened")||
q.classList.add("opened");a.activeWindow=this;h();a.intervalIdentifier=setInterval(h,100);d=Date.now()};k.prototype.hide=function(){this.container.classList.contains("opened")&&this.container.classList.remove("opened");q.classList.contains("opened")&&q.classList.remove("opened")};return k}();a.Window=p})(modal||(modal={}));var Connection;
(function(a){function n(){console.log("Connection opened");var a=e.encode64();h(a);e=new Komodo.ClientActions;q=setInterval(function(){var a=e.encode64();h(a);e=new Komodo.ClientActions},1E3)}function h(a){if(a.encode64){var b=a.encode64();Chat.log("Sent "+d(b)+" bytes to komodo.");Chat.log("Decoded: ");Chat.log(JSON.stringify(a));Chat.log("Encoded: ");Chat.log(a.encode64());Komodo.send(a.encode64())}else Chat.log("Sent "+d(a)+" bytes to komodo."),Komodo.send(a)}function d(a){var b=[];a=[a];for(var c=
0;a.length;){var d=a.pop();if("boolean"===typeof d)c+=4;else if("string"===typeof d)c+=2*d.length;else if("number"===typeof d)c+=8;else if("object"===typeof d&&-1===b.indexOf(d)){b.push(d);for(var e in d)a.push(d[e])}}return c}var q,p,k,m,b;(function(){var a=document.getElementsByClassName("header-links")[0],d=document.createElement("div");d.style.display="inline-block";d.textContent="Version History";d.addEventListener("click",function(){window.open("/version")});d.style.cursor="pointer";a.appendChild(d);
b=document.createElement("div");b.style.display="inline-block";b.textContent="There are # players mining.";a.appendChild(b);p=document.createElement("div");p.classList.add("error-notification-tray");k=document.createElement("div");k.classList.add("network-error");a=document.createElement("div");a.classList.add("network-error-text");a.textContent="No connection";k.appendChild(a);m=document.createElement("div");m.classList.add("rate-limited");a=document.createElement("div");a.classList.add("network-error-text");
m.style.display="none";a.textContent="You have exceeded your allotted requests";m.appendChild(a);a=document.getElementById("game");p.appendChild(k);p.appendChild(m);a.insertBefore(p,a.childNodes[0])})();Komodo.connection.received(function(a){Chat.log("Recieved "+d(a)+" bytes from komodo.");Chat.log("Encoded: ");Chat.log(a);Chat.log("Decoded: ");Chat.log(JSON.stringify(Komodo.decode(a)));Chat.log(d(JSON.stringify(Komodo.decode(a)))-d(a)+" bytes saved.");a=Komodo.decode(a);if(null!=a.Messages)for(var e=
a.Messages,c=0;c<e.length;c++){var g=e[c];Chat.receiveGlobalMessage(g.Sender,g.Text,g.Time,g.Permissions)}if(null!=a.GameSchema){e=a.GameSchema;if(e.Items)for(c=0;c<e.Items.length;c++)Inventory.addItem(e.Items[c].Id,e.Items[c].Name,e.Items[c].Worth,e.Items[c].Category),Statistics.addItem(e.Items[c].Id,e.Items[c].Name);if(e.StoreItems)for(c=0;c<e.StoreItems.length;c++)g=e.StoreItems[c],Store.addItem(g.Id,g.Category,g.Price,g.Factor,g.Name,g.MaxQuantity,g.Tooltip);if(e.Processors)for(c=0;c<e.Processors.length;c++){g=
e.Processors[c];Crafting.addProcessor(g.Id,g.Name);for(var h=0;h<g.Recipes.length;h++)Crafting.addProcessorRecipe(g.Id,g.Recipes[h].Ingredients,g.Recipes[h].Resultants)}if(e.CraftingItems)for(c=0;c<e.CraftingItems.length;c++)g=e.CraftingItems[c],Crafting.addRecipe(g.Id,g.Ingredients,g.Resultants,g.IsItem);if(e.Buffs)for(c=0;c<e.Buffs.length;c++)g=e.Buffs[c],Buffs.register(g.Id,g.Name,g.Description,g.Duration)}if(null!=a.Items)for(e=a.Items,c=0;c<e.length;c++)Inventory.changeQuantity(e[c].Id,e[c].Quantity),
Inventory.changePrice(e[c].Id,e[c].Worth);if(null!=a.StoreItemsUpdate)for(e=a.StoreItemsUpdate,c=0;c<e.length;c++)Store.changeQuantity(e[c].Id,e[c].Quantity,e[c].MaxQuantity,e[c].Price);if(null!=a.StatItemsUpdate)for(e=a.StatItemsUpdate,c=0;c<e.length;c++)Statistics.changeStats(e[c].Id,e[c].PrestigeQuantity,e[c].LifeTimeQuantity);if(null!=a.ConfigItems)for(e=a.ConfigItems,c=0;c<e.length;c++)Inventory.modifyConfig(e[c].Id,e[c].Enabled);if(null!=a.Processors)for(e=a.Processors,c=0;c<e.length;c++)g=
e[c],Crafting.updateProcessor(g.Id,g.SelectedRecipe,g.OperationDuration,g.CompletedOperations,g.TotalOperations,g.Capacity);null!=a.AntiCheatCoordinates&&(e=a.AntiCheatCoordinates,Rock.moveRock(e.X,e.Y));if(null!=a.Buffs)for(e=a.Buffs,c=0;c<e.length;c++)g=e[c],Buffs.update(g.Id,g.TimeActive);null!=a.IsRateLimited&&(m.style.display=a.IsRateLimited?"block":"none");if(null!=a.Gatherers)for(e=a.Gatherers,c=0;c<e.length;c++)g=e[c],Equipment.toggleGatherer(g.Id,g.Enabled);a.ConnectedUsers&&(b.textContent=
"There are "+a.ConnectedUsers+" players mining.")});a.restart=function(){Komodo.restart()};var e=new Komodo.ClientActions;Komodo.connection.stateChanged(function(a){a.newState===$.signalR.connectionState.connected&&(n(),k.style.display="none");a.newState===$.signalR.connectionState.disconnected&&(clearInterval(q),k.style.display="block");a.newState===$.signalR.connectionState.reconnecting&&(k.style.display="block")});a.toggleGatherer=function(a,b){var c=new Komodo.ClientActions.GathererAction;c.Id=
a;c.Enabled=b;e.GathererActions.push(c)};a.drink=function(a){var b=new Komodo.ClientActions.PotionAction;b.Id=a;e.PotionActions.push(b)};a.mine=function(a,b){var c=new Komodo.ClientActions.MiningAction;c.X=a;c.Y=b;e.MiningActions.push(c)};a.sellItem=function(a,b){var c=new Komodo.ClientActions.InventoryAction,d=new Komodo.ClientActions.InventoryAction.SellAction;d.Id=a;d.Quantity=b;c.Sell=d;e.InventoryActions.push(c)};a.configureItem=function(a,b){var c=new Komodo.ClientActions.InventoryAction,d=
new Komodo.ClientActions.InventoryAction.ConfigAction;d.Id=a;d.Enabled=b;c.Config=d;e.InventoryActions.push(c)};a.purchaseItem=function(a,b){var c=new Komodo.ClientActions.StoreAction,d=new Komodo.ClientActions.StoreAction.PurchaseAction;d.Id=a;d.Quantity=b?b:1;c.Purchase=d;e.StoreActions.push(c)};a.sellAllItems=function(){var a=new Komodo.ClientActions.InventoryAction;a.SellAll=!0;e.InventoryActions.push(a)};a.craftRecipe=function(a,b){var c=new Komodo.ClientActions.CraftingAction;c.Id=a;c.Quantity=
b;e.CraftingActions.push(c)};a.processRecipe=function(a,b,c){var d=new Komodo.ClientActions.ProcessingAction;d.Id=a;d.RecipeIndex=b;d.Iterations=c;e.ProcessingActions.push(d)};a.sendGlobalMessage=function(a){var b=new Komodo.ClientActions.SocialAction,c=new Komodo.ClientActions.SocialAction.ChatAction;c.GlobalMessage=a;b.Chat=c;e.SocialActions.push(b)};a.send=h})(Connection||(Connection={}));
