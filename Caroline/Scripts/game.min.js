var Utils;
(function(a){a.addEvent=function(a,f,c){null!=a&&"undefined"!=typeof a&&(a.addEventListener?a.addEventListener(f,c,!1):a.attachEvent?a.attachEvent("on"+f,c):a["on"+f]=c)};a.cssSwap=function(a,f,c){a.classList.contains(f)&&a.classList.remove(f);a.classList.add(c)};a.cssifyName=function(a){return a.split(" ").join("_")};a.createButton=function(a,f){var c,d;c=document.createElement("div");d=document.createElement("div");d.textContent=a;f&&(d.id=f);c.classList.add("button");c.appendChild(d);return c};
a.isNumber=function(a){return!isNaN(parseFloat(a))};a.formatNumber=function(a){return a?999999999999999<a?(a/1E15).toFixed(3)+"Qa":999999999999<a?(a/1E12).toFixed(3)+"T":999999999<a?(a/1E9).toFixed(3)+"B":999999<a?(a/1E6).toFixed(3)+"M":a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","):"0"};a.convertServerTimeToLocal=function(a){var f=+a.split(":")[0],c=+a.split(":")[1].split(" ")[0];"PM"==a.split(":")[1].split(" ")[1]&&(f+=12);a=(new Date).getTimezoneOffset();f-=a/60-a%60;c-=a%60;0>f&&(f=24-f);0>
c&&(c=60-c,f--);23<f&&(f-=24);59<c&&(c-=60,f++);return(10>f?"0":"")+f+":"+(10>c?"0":"")+c}})(Utils||(Utils={}));var Tabs;
(function(a){function l(){if(k){var b=k.scrollHeight;b>window.innerHeight-a.bottomPadding&&(b=window.innerHeight-a.bottomPadding);c.style.minHeight=b+"px";c.style.maxHeight=b+"px";c.style.overflowY=b>=window.innerHeight-a.bottomPadding?"scroll":"hidden"}}var f=0,c=document.getElementById("paneContainer");a.bottomPadding=200;var d=[],k,b=new (function(){function b(a){this.container=a;this.tabs=[];this.lowestId=0;this.id=f++;d.push(this)}b.prototype.newTab=function(b){var e=new g;e.pane=b;b=document.createElement("DIV");
b.classList.add("tab-button");this.container.appendChild(b);e.button=b;0==this.lowestId?e.button.classList.add("active"):(e.button.classList.add("inactive"),e.pane.style.display="none");var m=this.lowestId++,d=this.id;b.addEventListener("click",function(){a.activateTab(d,m)});this.tabs.push(e);this.container.appendChild(b);return this.lowestId-1};b.prototype.activate=function(b){for(var a=0;a<this.tabs.length;a++)this.tabs[a].deactivate();this.tabs[b].activate()};b.prototype.css=function(b,a){this.tabs[b].button.classList.add(a)};
return b}())(document.getElementById("tabContainer"));a.registerGameTab=function(a,g){var d=b.newTab(a);g&&b.css(d,g)};a.updateGameTabs=l;Utils.addEvent(window,"resize",a.updateGameTabs);setInterval(l,20);a.activateTab=function(b,a){d[b].activate(a);l()};var g=function(){function b(){}b.prototype.deactivate=function(){Utils.cssSwap(this.button,"active","inactive");this.pane.style.display="none"};b.prototype.activate=function(){Utils.cssSwap(this.button,"inactive","active");this.pane.style.display=
"block";k=this.pane};return b}()})(Tabs||(Tabs={}));var Chat;
(function(a){function l(){if(!c){c=document.createElement("DIV");c.style.position="fixed";c.style.bottom="0";c.style.left="0";c.style.minWidth="400px";c.style.width="40%";c.style.backgroundColor="#ebebeb";c.style.border="1px solid #adadad";c.style.height="280px";c.style.boxShadow="1px -1px 2px rgb(200,200,200)";var b=document.createElement("DIV");b.style.height="30px";b.style.backgroundColor="rgb(160, 160, 160)";c.appendChild(b);var a=document.createElement("DIV");a.style.color="white";a.style.fontSize=
"18px";a.style.height="30px";a.style.display="inline-block";a.textContent="General";a.style.padding="3px 10px";a.addEventListener("click",function(){document.getElementById("debugpane").style.display="none";document.getElementById("chatpane").style.display="block"});b.appendChild(a);a=document.createElement("DIV");a.style.color="white";a.id="debugtab";a.style.fontSize="18px";a.style.height="30px";a.style.display="inline-block";a.textContent=">Dev";a.style.padding="3px 10px";a.addEventListener("click",
function(){document.getElementById("debugpane").style.display="block";document.getElementById("chatpane").style.display="none"});a.style.display="none";b.appendChild(a);k=document.createElement("DIV");k.id="debugpane";k.style.width="100%";k.style.height="230px";k.style.display="none";k.style.position="relative";c.appendChild(k);d=document.createElement("DIV");d.id="chatpane";d.style.width="100%";d.style.height="230px";d.style.position="relative";c.appendChild(d);b=document.createElement("DIV");b.id=
"debuglog";b.style.position="absolute";b.style.bottom="0px";b.style.maxHeight="230px";b.style.width="100%";b.style.overflow="auto";k.appendChild(b);b=document.createElement("DIV");b.id="chatlog";b.style.position="absolute";b.style.bottom="0px";b.style.maxHeight="230px";b.style.width="100%";b.style.overflow="auto";d.appendChild(b);b=document.createElement("INPUT");b.setAttribute("TYPE","TEXT");b.style.width="100%";b.style.maxWidth="none";b.style.height="20px";b.style.border="none";b.style.borderTop=
"1px solid #adadad";b.style.width="85%";b.setAttribute("maxlength","220");b.addEventListener("keydown",function(b){13==b.keyCode&&f();68==b.keyCode&&b.altKey&&(document.getElementById("debugtab").style.display="inline-block")});b.id="chattext";c.appendChild(b);b=document.createElement("INPUT");b.setAttribute("TYPE","BUTTON");b.setAttribute("VALUE","SEND");b.style.height="20px";b.style.width="15%";b.style.fontSize="13px";b.style.border="none";b.style.borderTop="1px solid #adadad";b.style.borderLeft=
"1px solid #adadad";b.addEventListener("click",function(){f()});c.appendChild(b);document.body.appendChild(c)}}function f(){Connection.sendGlobalMessage(document.getElementById("chattext").value);document.getElementById("chattext").value=""}var c,d,k;a.initialize=l;l();a.log=function(b){var a=document.getElementById("debuglog"),e=document.createElement("DIV");e.textContent=b;a.appendChild(e)};a.receiveGlobalMessage=function(b,a,e,d){var k=document.getElementById("chatlog"),m=document.createElement("DIV");
m.classList.add("chat-msg");d&&""!=d&&m.classList.add("chat-"+d);d=document.createElement("SPAN");d.textContent="["+Utils.convertServerTimeToLocal(e)+"] ";e=document.createElement("SPAN");e.textContent=b;e.classList.add("chat-sender");b=document.createElement("SPAN");b.textContent=a;b.classList.add("chat-text");a=document.createElement("SPAN");a.textContent=": ";m.appendChild(d);m.appendChild(e);m.appendChild(a);m.appendChild(b);k.appendChild(m)}})(Chat||(Chat={}));var tooltip;
(function(a){function l(b,a){var d=e.getBoundingClientRect(),m=d.right-d.left,d=d.bottom-d.top;e.style.left=m+(b+15)>window.innerWidth?b-m-15+"px":b+15+"px";e.style.top=0<a-d?a-d+"px":a+5+"px"}function f(){e&&e.parentElement.removeChild(e);g=e=null}function c(a,e,m){var c=new p;d(a);m&&(c.header=m);c.content=e;b.push(c);a.dataset?a.dataset.tooltip=k:a.setAttribute("data-tooltip",k.toString());k++}function d(a){a.onmouseenter=function(a){var d=+a.target.getAttribute("data-tooltip");q!==a.target&&(h=
setInterval(function(){n+=.01;if(.25<=n){var a=m,c=r,k=b[d];g!==d&&f();g=d;e=k.html;document.body.appendChild(e);l(a,c);n=0;clearInterval(h);h=null}},10));q=a.target};a.onmousemove=function(a){a=a.pageX||a.pageY?{x:a.pageX,y:a.pageY}:a.clientX||a.clientY?{x:a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,y:a.clientY+document.body.scrollTop+document.documentElement.scrollTop}:void 0;h||l(a.x,a.y);m=a.x;r=a.y};a.onmouseleave=function(a){q=null;clearInterval(h);n=0;f()}}var k=
0,b=[],g,e,h,n=0,m,r,q,p=function(){function a(){this.html=document.createElement("div");this.html.classList.add("tooltip-wrapper")}Object.defineProperty(a.prototype,"header",{get:function(){return this.html.getElementsByClassName("tooltip-header")[0]},set:function(a){a.classList.add("tooltip-header");this.html.appendChild(a)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"content",{get:function(){return this.html.getElementsByClassName("tooltip-content")[0]},set:function(a){a.classList.add("tooltip-content");
this.html.appendChild(a)},enumerable:!0,configurable:!0});return a}();a.complexModify=function(a,d,e){a=b[a];e&&(a.header.parentElement.removeChild(a.header),a.header=e);a.content.parentElement.removeChild(a.content);a.content=d};a.modify=function(a,d,e){a=b[a];e&&(a.header.textContent=e);a.content.textContent=d};a.retrieveContent=function(a){return b[a].content};a.complexCreate=c;a.create=function(a,b,d){var e=document.createElement("div");e.textContent=b;d?(b=document.createElement("div"),b.textContent=
d,c(a,e,b)):c(a,e)}})(tooltip||(tooltip={}));var Inventory;
(function(a){function l(a){Connection.sellItem(h.id,a?a:1)}function f(){var b=document.getElementById("selecteditemquantity"),d=+b.value;Utils.isNumber(d)&&d>a.getSelectedItemQuantity()&&(b.value=a.getSelectedItemQuantity().toString())}function c(){k=document.createElement("DIV");document.getElementById("paneContainer").appendChild(k);g=document.createElement("DIV");g.classList.add("selected-item");g.style.display="none";var d=document.createElement("SPAN");d.textContent="x";d.style.top="0px";d.style.right=
"3px";d.style.position="absolute";d.addEventListener("click",function(){a.selectItem()});g.appendChild(d);e=document.createElement("DIV");e.classList.add("selected-item-image");d=document.createElement("INPUT");d.id="selecteditemquantity";d.type="text";d.style.height="18px";d.classList.add("selected-item-quantity");d.addEventListener("input",function(){f()});var c=Utils.createButton("Sell","");c.classList.add("selected-item-quantity");c.addEventListener("click",function(){var b=+document.getElementById("selecteditemquantity").value;
Utils.isNumber(b)&&a.sellSelectedItem(b);f()});var h=Utils.createButton("Sell all","");h.classList.add("selected-item-quantity");h.addEventListener("click",function(){a.sellAllSelectedItem();f()});g.appendChild(e);g.appendChild(h);g.appendChild(c);g.appendChild(d);k.appendChild(g);d=document.createElement("DIV");d.style.textAlign="center";c=document.createElement("DIV");c.style.display="inline-block";h=Utils.createButton("Sell (...)","");h.addEventListener("click",function(){Connection.sellAllItems()});
var n=Utils.createButton("...","");n.addEventListener("click",function(){});c.appendChild(h);c.appendChild(n);d.appendChild(c);k.appendChild(d);b=document.createElement("DIV");k.appendChild(b);Tabs.registerGameTab(k,"Inventory")}function d(b){var d=document.createElement("DIV");b.container=d;d.classList.add("item");d.addEventListener("click",function(){a.selectItem(b.id)});tooltip.create(d,b.name);var e=document.createElement("DIV");e.classList.add("item-text");var c=document.createElement("DIV");
c.style.verticalAlign="top";c.style.display="inline-block";c.textContent=Utils.formatNumber(b.worth);b.worthElm=c;var k=document.createElement("DIV");k.classList.add("Third-Coins");k.style.display="inline-block";e.appendChild(k);e.appendChild(c);d.appendChild(e);e=document.createElement("DIV");e.style.width="64px";e.style.height="64px";e.style.position="relative";e.style.margin="0 auto";c=document.createElement("DIV");c.classList.add(b.name.replace(" ","_"));e.appendChild(c);d.appendChild(e);e=document.createElement("DIV");
b.quantityElm=e;e.classList.add("item-text");e.textContent=Utils.formatNumber(0);d.appendChild(e);return d}a.items=[];var k,b,g,e,h,n=function(){return function(a,b,d,e){this.id=a;this.name=b;this.worth=d;this.category=e}}();a.Item=n;(function(a){a[a.NFS=0]="NFS";a[a.ORE=1]="ORE";a[a.GEM=2]="GEM";a[a.INGREDIENT=3]="INGREDIENT";a[a.CRAFTING=4]="CRAFTING";a[a.POTION=5]="POTION"})(a.Category||(a.Category={}));a.getSelectedItemQuantity=function(){return h?h.quantity:0};a.selectItem=function(b){b?(null!=
h&&e.classList.remove(Utils.cssifyName(h.name)),h=a.items[b],e.classList.add(Utils.cssifyName(h.name)),f()):(e.classList.remove(Utils.cssifyName(h.name)),h=null);g.style.display=null==h?"none":"block"};a.sellSelectedItem=l;a.sellAllSelectedItem=function(){l(h.quantity)};a.addItem=function(e,g,h,f){a.items[e]||(e=new n(e,g,h,f),a.items[e.id]=e,k||c(),b.appendChild(d(e)))};a.changeQuantity=function(b,d){a.items[b].quantityElm.textContent=Utils.formatNumber(d);a.items[b].quantity=d;a.items[b].container.style.display=
0==d?"none":"inline-block";f()}})(Inventory||(Inventory={}));var Connection;
(function(a){function l(a){if(a.encode64){var c=a.encode64();Chat.log("Sent "+f(c)+" bytes to komodo.");Chat.log("Decoded: ");Chat.log(JSON.stringify(a));Chat.log("Encoded: ");Chat.log(a.encode64());Komodo.send(a.encode64())}else Chat.log("Sent "+f(a)+" bytes to komodo."),Komodo.send(a)}function f(a){var c=[];a=[a];for(var b=0;a.length;){var g=a.pop();if("boolean"===typeof g)b+=4;else if("string"===typeof g)b+=2*g.length;else if("number"===typeof g)b+=8;else if("object"===typeof g&&-1===c.indexOf(g)){c.push(g);
for(var e in g)a.push(g[e])}}return b}Komodo.connection.received(function(a){Chat.log("Recieved "+f(a)+" bytes from komodo.");Chat.log("Encoded: ");Chat.log(a);Chat.log("Decoded: ");Chat.log(JSON.stringify(Komodo.decode(a)));Chat.log(f(JSON.stringify(Komodo.decode(a)))-f(a)+" bytes saved.");a=Komodo.decode(a);null!=a.Message&&Chat.receiveGlobalMessage(a.Message.Sender,a.Message.Text,a.Message.Time,a.Message.Permissions);if(null!=a.GameSchema){for(var c=a.GameSchema,b=0;b<c.Items.length;b++)Inventory.addItem(c.Items[b].Id,
c.Items[b].Name,c.Items[b].Worth,c.Items[b].Category),Statistics.addItem(c.Items[b].Id,c.Items[b].Name);for(b=0;b<c.StoreItems.length;b++){var g=c.StoreItems[b];Store.addItem(g.Id,g.Category,g.Price,g.Factor,g.Name,g.MaxQuantity)}}if(null!=a.Items)for(c=a.Items,b=0;b<c.length;b++)Inventory.changeQuantity(c[b].Id,c[b].Quantity);if(null!=a.StoreItemsUpdate)for(c=a.StoreItemsUpdate,b=0;b<c.length;b++)Store.changeQuantity(c[b].Id,c[b].Quantity);if(null!=a.StatItemsUpdate)for(a=a.StatItemsUpdate,c=0;c<
a.length;c++)Statistics.changeStats(a[c].Id,a[c].PrestigeQuantity,a[c].LifeTimeQuantity)});var c=new Komodo.ClientActions;setInterval(function(){var a=c.encode64();l(a);c=new Komodo.ClientActions},1E3);a.sellItem=function(a,f){var b=new Komodo.ClientActions.InventoryAction,g=new Komodo.ClientActions.InventoryAction.SellAction;g.Id=a;g.Quantity=f;b.Sell=g;c.InventoryActions.push(b)};a.purchaseItem=function(a,f){var b=new Komodo.ClientActions.StoreAction,g=new Komodo.ClientActions.StoreAction.PurchaseAction;
g.Id=a;g.Quantity=f?f:1;b.Purchase=g;c.StoreActions.push(b)};a.sellAllItems=function(){var a=new Komodo.ClientActions.InventoryAction;a.SellAll=!0;c.InventoryActions.push(a)};a.sendGlobalMessage=function(a){var f=new Komodo.ClientActions.SocialAction,b=new Komodo.ClientActions.SocialAction.ChatAction;b.GlobalMessage=a;f.Chat=b;c.SocialActions.push(f)};a.send=l})(Connection||(Connection={}));var Store;
(function(a){function l(){c=document.createElement("div");document.getElementById("paneContainer").appendChild(c);Tabs.registerGameTab(c,"Store");for(var a in b)if(0<=parseInt(a,10)){var d=b[a];if("CRAFTING"!=d){var g=document.createElement("div");g.classList.add("store-category");k[d]=g;var f=document.createElement("div");f.textContent=d;f.classList.add("store-category-header");g.appendChild(f);c.appendChild(g)}}}function f(a){var b=document.createElement("div");b.classList.add("store-item");a.container=
b;var c=document.createElement("div");c.classList.add("store-item-header");c.textContent=1>=a.maxQuantity?a.name:a.name+" ("+a.quantity+"/"+a.maxQuantity+")";a.nameElm=c;b.appendChild(c);c=document.createElement("DIV");c.style.width="64px";c.style.height="64px";c.style.position="relative";c.style.margin="0 auto";var d=document.createElement("DIV");d.classList.add(Utils.cssifyName(a.name));c.appendChild(d);b.appendChild(c);c=document.createElement("div");c.classList.add("store-item-footer");d=document.createElement("div");
d.classList.add("item-text");var g=document.createElement("div");g.textContent=Utils.formatNumber(a.price);g.style.display="inline-block";g.style.verticalAlign="top";a.priceElm=g;var f=document.createElement("div");f.classList.add("Third-Coins");f.style.display="inline-block";d.appendChild(f);d.appendChild(g);var g=document.createElement("div"),f=Utils.createButton("Buy",""),k=a.id;if(5!=a.category)f.addEventListener("click",function(){Connection.purchaseItem(k)});else{var l=document.createElement("INPUT");
l.type="TEXT";l.style.width="40px";l.style.height="15px";g.appendChild(l);f.addEventListener("click",function(){Utils.isNumber(l.value)&&Connection.purchaseItem(k,+l.value)})}g.appendChild(f);c.appendChild(g);c.appendChild(d);b.appendChild(c);return b}var c,d=[],k=[];(function(a){a[a.MINING=1]="MINING";a[a.MACHINES=2]="MACHINES";a[a.GATHERING=3]="GATHERING";a[a.PROCESSING=4]="PROCESSING";a[a.ITEMS=5]="ITEMS";a[a.CRAFTING=6]="CRAFTING"})(a.Category||(a.Category={}));var b=a.Category,g=function(){return function(){}}();
a.tempFix=function(){l()};a.addItem=function(a,h,n,m,r,q){c||l();if(!d[a]){var p=new g;p.id=a;p.category=h;p.price=n;p.factor=m;p.name=r;p.maxQuantity=q?q:0;h=k[b[h]];null==h&&(h=k.MINING);h.appendChild(f(p));d[a]=p}};a.changeQuantity=function(a,b){var c=d[a];c.quantity=b;c.container.style.display=-1==c.quantity||c.quantity>=c.maxQuantity&&0<c.maxQuantity?"none":"inline-block";c.maxQuantity&&1<c.maxQuantity&&(c.nameElm.textContent=c.name+" ("+(c.quantity?c.quantity:0)+"/"+c.maxQuantity+")")}})(Store||
(Store={}));var Statistics;
(function(a){function l(){var a=document.createElement("TABLE"),d=a.createTHead(),e=d.insertRow(0);e.classList.add("table-header");e=e.insertCell(0);e.textContent="Item Statistics";e.setAttribute("colspan","3");d=d.insertRow(1);d.classList.add("table-subheader");e=d.insertCell(0);e.textContent="Lifetime Quantity";e.style.width="40%";e=d.insertCell(0);e.textContent="Prestige Quantity";e.style.width="40%";d=d.insertCell(0);d.textContent="Item";d.style.width="20%";c=a.createTBody();return a}var f,c,
d=[],k=function(){return function(){}}();a.changeStats=function(a,c,e){a=d[a];a.prestigeRow.textContent=c?Utils.formatNumber(c):"0";a.alltimeRow.textContent=e?Utils.formatNumber(e):"0"};a.addItem=function(a,g){f||(f=document.createElement("DIV"),document.getElementById("paneContainer").appendChild(f),Tabs.registerGameTab(f,"Statistics"),f.appendChild(l()));if(!d[a]){var e=new k;d[a]=e;var h=c.insertRow(c.rows.length);h.classList.add("table-row");e.alltimeRow=h.insertCell(0);e.alltimeRow.style.width=
"40%";e.prestigeRow=h.insertCell(0);e.prestigeRow.style.width="40%";e=h.insertCell(0);e.style.width="20%";h=document.createElement("DIV");h.classList.add("Third-"+Utils.cssifyName(g));h.style.display="inline-block";e.appendChild(h)}}})(Statistics||(Statistics={}));
